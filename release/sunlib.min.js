var __extends=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();var suncom;(function(e){var L;(function(e){e[e["ANY"]=1]="ANY";e[e["ENGINE"]=2]="ENGINE";e[e["NATIVE"]=4]="NATIVE";e[e["NETWORK"]=8]="NETWORK";e[e["NETWORK_HEARTBEAT"]=16]="NETWORK_HEARTBEAT";e[e["DEBUG"]=32]="DEBUG";e[e["ENGINEER"]=64]="ENGINEER";e[e["NORMAL"]=128]="NORMAL";e[e["TEST"]=256]="TEST";e[e["TDD"]=512]="TDD";e[e["ATDD"]=1024]="ATDD"})(L=e.DebugMode||(e.DebugMode={}));var t;(function(e){e[e["DEVELOP"]=0]="DEVELOP";e[e["DEBUG"]=1]="DEBUG";e[e["WEB"]=2]="WEB";e[e["NATIVE"]=3]="NATIVE"})(t=e.EnvMode||(e.EnvMode={}));var c;(function(e){e[e["LOWEST"]=0]="LOWEST";e[e["LOW"]=1]="LOW";e[e["MID"]=2]="MID";e[e["HIGH"]=3]="HIGH";e[e["HIGHEST"]=4]="HIGHEST";e[e["FWL"]=5]="FWL";e[e["EGL"]=6]="EGL";e[e["OSL"]=7]="OSL"})(c=e.EventPriorityEnum||(e.EventPriorityEnum={}));var f=function(){function e(){this.type=null;this.caller=null;this.method=null;this.priority=c.MID;this.receiveOnce=false}e.prototype.recover=function(){this.caller=null;this.method=null;h.recover("suncom.EventInfo",this)};return e}();e.EventInfo=f;var r=function(){function e(){this.$var_events={};this.$var_lockers={};this.$var_onceList=[];this.$var_isCanceled=false}e.prototype.addEventListener=function(e,t,r,n,i){if(n===void 0){n=false}if(i===void 0){i=c.MID}if(d.isStringNullOrEmpty(e)===true){throw Error("注册无效事件！！！")}if(t===void 0||t===null){throw Error("注册无效的事件回调！！！")}if(r===void 0){r=null}var o=this.$var_events[e];if(o===void 0){o=this.$var_events[e]=[]}else if(this.$var_lockers[e]===true){this.$var_events[e]=o=o.slice(0);this.$var_lockers[e]=false}var s=-1;for(var a=0;a<o.length;a++){var u=o[a];if(u.method===t&&u.caller===r){return}if(s===-1&&u.priority<i){s=a}}var l=h.getItemByClass("suncom.EventInfo",f);l.type=e;l.caller=r;l.method=t;l.priority=i;l.receiveOnce=n;if(s<0){o.push(l)}else{o.splice(s,0,l)}};e.prototype.removeEventListener=function(e,t,r){if(d.isStringNullOrEmpty(e)===true){throw Error("移除无效的事件！！！")}if(t===void 0||t===null){throw Error("移除无效的事件回调！！！")}if(r===void 0){r=null}var n=this.$var_events[e];if(n===void 0){return}if(this.$var_lockers[e]===true){this.$var_events[e]=n=n.slice(0);this.$var_lockers[e]=false}for(var i=0;i<n.length;i++){var o=n[i];if(o.method===t&&o.caller===r){n.splice(i,1)[0].recover();break}}if(n.length===0){delete this.$var_events[e];delete this.$var_lockers[e]}};e.prototype.dispatchEvent=function(e,t,r){if(r===void 0){r=true}if(d.isStringNullOrEmpty(e)===true){throw Error("派发无效事件！！！")}var n=this.$var_events[e];if(n===void 0){return}this.$var_lockers[e]=true;var i=this.$var_isCanceled;this.$var_isCanceled=false;for(var o=0;o<n.length;o++){var s=n[o];if(s.receiveOnce===true){this.$var_onceList.push(s)}if(t instanceof Array){s.method.apply(s.caller,t)}else{s.method.call(s.caller,t)}if(this.$var_isCanceled){if(r===true){break}console.error("尝试取消不可被取消的事件："+e);this.$var_isCanceled=false}}this.$var_isCanceled=i;this.$var_lockers[e]=false;while(this.$var_onceList.length>0){var a=this.$var_onceList.pop();this.removeEventListener(a.type,a.method,a.caller)}};e.prototype.dispatchCancel=function(){this.$var_isCanceled=true};return e}();e.EventSystem=r;var s=function(){function e(e){if(e===void 0){e=null}this.$var_value=void 0;this.$var_asNot=false;this.$var_interpretation=null;if(R.debugMode&L.TEST){e!==null&&A.log(L.ANY,e)}}e.prototype.expect=function(e){this.$var_value=e;return this};e.prototype.interpret=function(e){this.$var_interpretation=e;return this};e.prototype.test=function(e,t){if(this.$var_asNot===false&&e===false||this.$var_asNot===true&&e===true){a.ASSERT_FAILED=true;t!==null&&A.error(L.ANY,t);this.$var_interpretation!==null&&A.error(L.ANY,this.$var_interpretation);if(a.ASSERT_BREAKPOINT===true){debugger}throw Error("测试失败！")}};e.prototype.anything=function(){if(R.debugMode&L.TEST){var e=this.$var_value!==null&&this.$var_value!==void 0;var t="期望值"+(this.$var_asNot===false?"":"不为")+"：null or undefined, 实际值："+d.toDisplayString(this.$var_value);this.test(e,t)}};e.prototype.arrayContaining=function(e){if(R.debugMode&L.TEST){var t=true;for(var r=0;r<e.length;r++){var n=e[r];if(this.$var_value.indexOf(n)<0){t=false;break}}var i="期望"+(this.$var_asNot===false?"":"不")+"包含："+d.toDisplayString(e)+", 实际值："+d.toDisplayString(this.$var_value);this.test(t,i)}};e.prototype.stringContaining=function(e){if(R.debugMode&L.TEST){var t=this.$var_value.indexOf(e)>-1;var r="期望"+(this.$var_asNot===false?"":"不")+"包含："+e+", 实际值："+this.$var_value;this.test(t,r)}};e.prototype.stringMatching=function(e){if(R.debugMode&L.TEST){var t=e.indexOf(this.$var_value)>-1;var r="期望"+(this.$var_asNot===false?"":"不")+"被包含："+e+", 实际值："+this.$var_value;this.test(t,r)}};e.prototype.toHaveProperty=function(e,t){if(R.debugMode&L.TEST){var r=t===void 0?this.$var_value[e]!==void 0:this.$var_value[e]===t;var n="期望"+(this.$var_asNot===false?"":"不")+"存在属性："+e+", 实际值："+this.$var_value;this.test(r,n)}};e.prototype.toBe=function(e){if(R.debugMode&L.TEST){var t=this.$var_value===e;var r="期望值"+(this.$var_asNot===false?"":"不为")+"："+d.toDisplayString(e)+", 实际值："+d.toDisplayString(this.$var_value);this.test(t,r)}};e.prototype.toBeNull=function(){this.toBe(null)};e.prototype.toBeUndefined=function(){this.toBe(void 0)};e.prototype.toBeBoolean=function(){if(R.debugMode&L.TEST){var e=typeof this.$var_value==="boolean";var t="期望"+(this.$var_asNot===false?"为":"不为")+"：布尔类型, 实际为："+typeof this.$var_value;this.test(e,t)}};e.prototype.toBeInstanceOf=function(e){if(R.debugMode&L.TEST){var t=this.$var_value instanceof e;var r="期望 "+d.getQualifiedClassName(this.$var_value)+" 的类型"+(this.$var_asNot===false?"":"不")+"为 "+d.getClassName(e);this.test(t,r)}};e.prototype.toBeFalsy=function(e){if(R.debugMode&L.TEST){var t=e?false:true;var r="期望 "+d.toDisplayString(e)+" "+(this.$var_asNot===false?"":"不")+"为假, 实际值："+d.toDisplayString(this.$var_value);this.test(t,r)}};e.prototype.toBeTruthy=function(e){if(R.debugMode&L.TEST){var t=e?true:false;var r="期望 "+d.toDisplayString(e)+" "+(this.$var_asNot===false?"":"不")+"为假, 实际值："+d.toDisplayString(this.$var_value);this.test(t,r)}};e.prototype.toBeCloseTo=function(e,t){if(t===void 0){t=0}if(R.debugMode&L.TEST){var r=Math.abs(this.$var_value-e)<=Math.abs(t);var n="期望与"+e+"的误差"+(this.$var_asNot===true?"":"不")+"超过"+t+"，实际值："+this.$var_value;this.test(r,n)}};e.prototype.toBeGreaterThan=function(e){if(R.debugMode&L.TEST){var t=this.$var_value>e;var r="期望"+(this.$var_asNot===true?"":"不")+"大于 "+e+"，实际值："+this.$var_value;this.test(t,r)}};e.prototype.toBeGreaterOrEqualThan=function(e){if(R.debugMode&L.TEST){var t=this.$var_value>=e;var r="期望"+(this.$var_asNot===true?"":"不")+"大于等于 "+e+"，实际值："+this.$var_value;this.test(t,r)}};e.prototype.toBeLessThan=function(e){if(R.debugMode&L.TEST){var t=this.$var_value<e;var r="期望"+(this.$var_asNot===true?"":"不")+"小于 "+e+"，实际值："+this.$var_value;this.test(t,r)}};e.prototype.toBeLessOrEqualThan=function(e){if(R.debugMode&L.TEST){var t=this.$var_value<=e;var r="期望"+(this.$var_asNot===true?"":"不")+"小于等于 "+e+"，实际值："+this.$var_value;this.test(t,r)}};e.prototype.toEqual=function(e){if(R.debugMode&L.TEST){var t=d.isEqual(this.$var_value,e,false);var r="期望相等："+d.toDisplayString(e)+"，实际值："+d.toDisplayString(this.$var_value);this.test(t,r)}};e.prototype.toStrictEqual=function(e){if(R.debugMode&L.TEST){var t=d.isEqual(this.$var_value,e,true);var r="期望相等："+d.toDisplayString(e)+"，实际值："+d.toDisplayString(this.$var_value);this.test(t,r)}};Object.defineProperty(e.prototype,"not",{get:function(){this.$var_asNot=true;return this},enumerable:false,configurable:true});return e}();e.Expect=s;var n=function(){function o(){this.$var_id=0;this.$var_args=null;this.$var_caller=null;this.$var_method=null;this.$var_once=false}o.prototype.setTo=function(e,t,r,n){if(r===void 0){r=null}if(n===void 0){n=true}if(this.$var_id===-1){throw Error("Handler己被回收！！！")}this.$var_id=d.createHashId();this.$var_caller=e||null;this.$var_method=t||null;this.$var_args=r;this.$var_once=n;return this};o.prototype.run=function(){var e=this.$var_id;var t=this.$var_method.apply(this.$var_caller,this.$var_args);e===this.$var_id&&this.$var_once===true&&this.recover();return t};o.prototype.runWith=function(e){var t=this.$var_id;var r;if(this.$var_args!==null){r=this.$var_method.apply(this.$var_caller,this.$var_args.concat(e))}else if(e instanceof Array){r=this.$var_method.apply(this.$var_caller,e)}else{r=this.$var_method.call(this.$var_caller,e)}t===this.$var_id&&this.$var_once===true&&this.recover();return r};o.prototype.recover=function(){if(h.recover("suncom.Handler",this)===true){this.$var_id=-1;this.$var_args=null;this.$var_caller=null;this.$var_method=null}};Object.defineProperty(o.prototype,"caller",{get:function(){return this.$var_caller},enumerable:false,configurable:true});Object.defineProperty(o.prototype,"method",{get:function(){return this.$var_method},enumerable:false,configurable:true});o.create=function(e,t,r,n){var i=h.getItemByClass("suncom.Handler",o);i.$var_id=0;return i.setTo(e,t,r,n)};return o}();e.Handler=n;var i=function(){function e(e){this.$var_primaryKey=null;this.$var_dataMap={};this.source=[];if(typeof e==="number"){e=e+""}if(typeof e!=="string"){throw Error("非法的主键字段名："+e)}if(e.length===0){throw Error("无效的主键字段名字长度："+e.length)}this.$var_primaryKey=e}e.prototype.$func_removeByIndex=function(e){var t=this.source[e];this.source.splice(e,1);var r=t[this.$var_primaryKey];delete this.$var_dataMap[r];return t};e.prototype.$func_getIndexByValue=function(e,t){if(t===void 0){return-1}for(var r=0;r<this.source.length;r++){var n=this.source[r];if(n[e]===t){return r}}return-1};e.prototype.put=function(e){var t=e[this.$var_primaryKey];if(d.isStringNullOrEmpty(t)===true){throw Error("无效的主键的值，type:"+typeof t+", value:"+t)}if(this.getByPrimaryValue(t)===null){this.source.push(e);this.$var_dataMap[t]=e}else{throw Error("重复的主键值：["+this.$var_primaryKey+"]"+t)}return e};e.prototype.getByValue=function(e,t){if(e===this.$var_primaryKey){return this.getByPrimaryValue(t)}var r=this.$func_getIndexByValue(e,t);if(r===-1){return null}return this.source[r]};e.prototype.getByPrimaryValue=function(e){return this.$var_dataMap[e.toString()]||null};e.prototype.remove=function(e){var t=this.source.indexOf(e);if(t===-1){return e}return this.$func_removeByIndex(t)};e.prototype.removeByValue=function(e,t){if(e===this.$var_primaryKey){return this.removeByPrimaryValue(t)}var r=this.$func_getIndexByValue(e,t);if(r===-1){return null}return this.$func_removeByIndex(r)};e.prototype.removeByPrimaryValue=function(e){var t=this.getByPrimaryValue(e);if(t===null){return null}return this.remove(t)};e.prototype.forEach=function(e){for(var t=0;t<this.source.length;t++){if(e(this.source[t])===true){break}}};return e}();e.HashMap=i;var d;(function(e){var t=0;function r(){t++;return t}e.createHashId=r;function n(e){return e===void 0||e===null}e.isNullOrUndefined=n;function i(e){var t=e.toString().trim();var r=t.indexOf("(");return e.name||t.substring(9,r)}e.getClassName=i;function o(e){var t=typeof e;if(t!=="object"){return t}var r=e.prototype||Object.getPrototypeOf(e)||null;if(r===null){return t}return this.getClassName(r.constructor)}e.getQualifiedClassName=o;function s(e,t){if(t===void 0){t=null}if(t===null){return this.getClassName(e)}for(var r in t){if(t[r]===e){return r}}return null}e.getMethodName=s;function a(e,t){for(var r in t){if(t[r]===e){return r}}return null}e.convertEnumToString=a;function u(e){if(this.isNullOrUndefined(e)===true){return null}var t=["\r","\n","\t"," "];var r=0;while(r<e.length){var n=e.charAt(r);var i=t.indexOf(n);if(i===-1){break}r++}var o=e.length-1;while(o>r){var n=e.charAt(o);var i=t.indexOf(n);if(i===-1){break}o--}return e.substring(r,o+1)}e.trim=u;function l(e){if(typeof e==="number"){return isNaN(e)}if(typeof e==="string"&&e!==""){return false}return true}e.isStringNullOrEmpty=l;function c(e,t){var r=e.length;for(var n=0;n<t.length;n++){var i="{"+n+"}";var o=e.indexOf(i,e.length-r);if(o===-1){break}e=e.substr(0,o)+t[n]+e.substr(o+3)}return e}e.formatString=c;function f(e){if(e instanceof Date){return e}if(b.isNumber(e)===true){return new Date(e)}if(typeof e==="string"){var t=e.split(" ");var r=t.length===1?[]:t.shift().split("-");var n=t[0].split(":");if(n.length===3){if(r.length===0){var i=new Date;r[0]=i.getFullYear().toString();r[1]=(i.getMonth()+1).toString();r[2]=i.getDate().toString()}return new Date(Number(r[0]),Number(r[1])-1,Number(r[2]),Number(n[0]),Number(n[1]),Number(n[2]))}return new Date(e)}throw Error("Convert Date Error:"+e)}e.convertToDate=f;function d(e,t,r){var n=this.convertToDate(r);if(e==="yy"){n.setFullYear(n.getFullYear()+t)}else if(e==="MM"){var i=t%12;var o=(t-i)/12;n.setFullYear(n.getFullYear()+o);var s=n.getMonth()+i;if(s>11){n.setMonth(s-12);n.setFullYear(n.getFullYear()+1)}else if(s<0){n.setMonth(i+11);n.setFullYear(n.getFullYear()-1)}else{n.setMonth(s)}}var a=n.valueOf();if(e==="ww"){a+=t*7*24*3600*1e3}else if(e==="dd"){a+=t*24*3600*1e3}else if(e==="hh"){a+=t*3600*1e3}else if(e==="mm"){a+=t*60*1e3}else if(e==="ss"){a+=t*1e3}else if(e==="ms"){a+=t}return a}e.dateAdd=d;function h(e,t,r){var n=this.convertToDate(t);var i=this.convertToDate(r);var o=n.valueOf();var s=i.valueOf();if(e==="ms"){return s-o}o=Math.floor(o/1e3);s=Math.floor(s/1e3);if(e==="ss"){return s-o}o=Math.floor(o/60);s=Math.floor(s/60);if(e==="mm"){return s-o}o=Math.floor(o/60);s=Math.floor(s/60);if(e==="hh"){return s-o}o=Math.floor(o/24);s=Math.floor(s/24);if(e==="dd"){return s-o}if(e==="ww"){return Math.floor((s-4-(o-4))/7)}if(e==="MM"){return i.getMonth()-n.getMonth()+(i.getFullYear()-n.getFullYear())*12}if(e==="yy"){return i.getFullYear()-n.getFullYear()}return 0}e.dateDiff=h;function p(e,t){var r=this.convertToDate(t);e=e.replace("MS",("00"+r.getMilliseconds().toString()).substr(-3));e=e.replace("ms",r.getMilliseconds().toString());e=e.replace("yyyy",r.getFullYear().toString());e=e.replace("yy",r.getFullYear().toString().substr(2,2));e=e.replace("MM",("0"+(r.getMonth()+1).toString()).substr(-2));e=e.replace("dd",("0"+r.getDate().toString()).substr(-2));e=e.replace("hh",("0"+r.getHours().toString()).substr(-2));e=e.replace("mm",("0"+r.getMinutes().toString()).substr(-2));e=e.replace("ss",("0"+r.getSeconds().toString()).substr(-2));e=e.replace("M",(r.getMonth()+1).toString());e=e.replace("d",r.getDate().toString());e=e.replace("h",r.getHours().toString());e=e.replace("m",r.getMinutes().toString());e=e.replace("s",r.getSeconds().toString());return e}e.formatDate=p;function v(e){throw Error("未实现的接口！！！")}e.md5=v;function m(e,t){var r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i");var n=t||window.location.search;var i=n.substr(1).match(r)||null;return i===null?null:decodeURIComponent(i[2])}e.getQueryString=m;function E(e,t,r){if(r===void 0){r="sign"}var n=[];for(var i in e){if(i!==r){n.push(i+"="+e[i])}}n.push("key="+t);return this.md5(n.join("&"))}e.createHttpSign=E;function _(e){var t=e.lastIndexOf("/");if(t>-1){e=e.substr(t+1)}var r=this.getFileExtension(e);if(r===null){return e}return e.substr(0,e.length-r.length-1)}e.getFileName=_;function g(e){var t=e.lastIndexOf(".");if(t===-1){return null}return e.substr(t+1).toLowerCase()}e.getFileExtension=g;function y(e,t){var r=e.lastIndexOf(".");if(r===-1){return e}return e.substr(0,r+1)+t}e.replacePathExtension=y;function $(e,t,r){if(r===void 0){r=null}for(var n=0;n<e.length;n++){var i=e[n];if(t(i)===true){if(r===null){return i}r.push(i)}}return null}e.findInArray=$;function T(e,t){for(var r=0;r<t.length;r++){if(t[r]===e){t.splice(r,1);break}}}e.removeItemFromArray=T;function S(e,t){for(var r=0;r<e.length;r++){this.removeItemFromArray(e[r],t)}}e.removeItemsFromArray=S;function N(e,t){if(t===void 0){t=false}if(e instanceof Array){if(t===false){return e.slice(0)}else{var r=[];for(var n=0;n<e.length;n++){r.push(this.copy(e[n],t))}return r}}else if(e instanceof Object){var i={};if(t===false){for(var o in e){i[o]=e[o]}}else{for(var o in e){i[o]=this.copy(e[o],t)}}return i}return e}e.copy=N;function M(e){var t={};for(var r in e){var n=e[r];if(typeof n==="number"){t[r]=0}else if(typeof n==="boolean"){t[r]=false}else if(n instanceof Array){t[r]=[]}else if(n instanceof Object){t[r]=null}else{throw Error("克隆意外的数据类型："+n)}}return t}e.clone=M;function O(e,t,r){if(e===t){return true}if(typeof e==="number"&&typeof t==="number"&&isNaN(e)&&isNaN(t)){return true}if(e instanceof Array&&t instanceof Array&&e.length===t.length){if(r===false){e=e.slice();t=t.slice();e.sort();t.sort()}for(var n=0;n<e.length;n++){if(this.isEqual(e[n],t[n],r)===false){return false}}return true}else if(e instanceof Object&&t instanceof Object&&Object.keys(e).length===Object.keys(t).length){if(r===true&&e.constructor!==t.constructor){return false}for(var i in e){if(e.hasOwnProperty(i)===true&&this.isEqual(e[i],t[i],r)===false){return false}}return true}return false}e.isEqual=O;function I(t){if(t===void 0||t===null){return t}if(typeof t==="number"||typeof t==="string"||typeof t==="boolean"){return t.toString()}var r;if(t instanceof Array){var e=[];for(var n=0;n<t.length;n++){e.push(this.toDisplayString(t[n]))}return"["+e.join(",")+"]"}else{try{r=JSON.stringify(t)}catch(e){r="["+this.getQualifiedClassName(t)+"]"}}return r}e.toDisplayString=I;function C(e){if(typeof e!=="string"){A.error(L.ANY,"参数版本号无效");return 0}if(typeof R.VERSION!=="string"){A.error(L.ANY,"版本号未设置");return 0}var t=e.split(".");var r=R.VERSION.split(".");var n=t.length>r.length?t.length:r.length;while(t.length<n){t.push("0")}while(r.length<n){r.push("0")}var i=0;for(var o=0;o<n;o++){var s=t[o];var a=r[o];if(b.isNumber(s)===false){i|=1;t[o]="0"}if(b.isNumber(a)===false){i|=2;r[o]="0"}}if(i&1){A.error(L.ANY,"参数版本号无效 "+("ver:"+e))}if(i&2){A.error(L.ANY,"当前版本号无效 "+("ver:"+R.VERSION))}if(i>0){return 0}for(var o=0;o<n;o++){var u=Number(t[o]);var l=Number(r[o]);if(u<l){return 1}else if(u>l){return-1}}return 0}e.compareVersion=C})(d=e.Common||(e.Common={}));var o;(function(r){var n=0;r.$table={};function e(e){return r.$table[e]}r.get=e;function t(e,t){if(e<0){n++;r.$table["auto_"+n]=t}else{r.$table[e]=t}return t}r.put=t;function i(e){return r.$table[e]!==void 0}r.exist=i;function o(e){var t=r.get(e);delete r.$table[e];return t}r.drop=o})(o=e.DBService||(e.DBService={}));var R;(function(e){e.envMode=0;e.debugMode=0;e.WIDTH=1280;e.HEIGHT=720;e.width=1280;e.height=720;e.VERSION="1.0.0";e.dataMap={}})(R=e.Global||(e.Global={}));var A;(function(a){a.NUM_OF_BLOCK=200;a.LINES_OF_BLOCK=200;var u=[];a.locked=false;function i(e){if(a.locked===false&&u.length>a.NUM_OF_BLOCK){u.shift()}var t=null;var r=u.length;if(r>0){t=u[r-1];if(t.length===a.LINES_OF_BLOCK){t=null}}if(t===null){t=[];u.push(t)}t.push(e)}function e(e,t){if(e<0){t+=e;e=0}var r=e%a.LINES_OF_BLOCK;var n=(e-r)/a.LINES_OF_BLOCK;var i=[];for(var o=0;o<t;o++){if(n<u.length){var s=u[n];if(r<s.length){i.push(s[r])}r++;if(r===s.length){r=0;n++}}else{break}}return i}a.getDebugString=e;function t(){var e=0;for(var t=0;t<u.length;t++){e+=u[t].length}return e}a.getNumOfLines=t;function r(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}if(R.debugMode>0&&(e===L.ANY||(R.debugMode&e)===e)){var n=t.join(" ");console.log(n);i(n)}}a.log=r;function n(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}if(R.debugMode>0&&(e===L.ANY||(R.debugMode&e)===e)){var n=t.join(" ");console.warn(n);i(n)}}a.warn=n;function o(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}if(R.debugMode>0&&(e===L.ANY||(R.debugMode&e)===e)){var n=t.join(" ");console.error(n);i(n)}}a.error=o;function s(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}if(R.debugMode>0&&(e===L.ANY||(R.debugMode&e)===e)){var n=t.join(" ");console.info(n);i(n)}}a.log2f=s;function l(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}if(R.debugMode>0&&(e===L.ANY||(R.debugMode&e)===e)){var n=t.join(" ");console.trace(n)}}a.trace=l})(A=e.Logger||(e.Logger={}));var b;(function(e){e.PI=Math.PI;e.PI2=Math.PI*2;e.MAX_SAFE_INTEGER=9007199254740991;e.MIN_SAFE_INTEGER=-9007199254740991;function t(e){return e*Math.PI/180}e.d2r=t;function r(e){return e*180/Math.PI}e.r2d=r;function n(e,t,r){if(e<t){return t}else if(e>r){return r}return e}e.clamp=n;function i(e,t){if(t===void 0){t=0}var r=e.toString();var n=r.indexOf(".");if(n===-1){return e}var i=n+1;if(r.length-i<=t){return e}var o=r.substr(0,n);var s=r.substr(i,t);var a=r.substr(i+t,2);var u=a.length===1?a:a.charAt(0);var l=a.length===1?"0":a.charAt(1);var c=parseInt(o+s);var f=parseInt(u+l);if(c<0&&f>0){c-=1;f=100-f}var d=f.toString();var h=parseInt(d.charAt(0));var p=parseInt(d.charAt(1));if(h>5){c+=1}else if(h===5){if(p>0){c++}else{var v=c%2;if(v===1||v===-1){c+=1}}}var m=c.toString();var E=m.length-t;var _=m.substr(0,E)+"."+m.substr(E);var g=parseFloat(_);return g}e.round=i;function o(e,t){if(t===void 0){t=0}A.warn(L.ANY,"此接口己弃用：suncom.Common.$round(value: number, n: number = 0);");var r=Math.floor(e*Math.pow(10,t+2));var n=r%100;var i=(r-n)/100;if(n<0&&n>0){i-=1;n+=100}var o=n%10;var s=(n-o)/10;if(s>5){i+=1}else if(s===5){var a=o%2;if(a===1||a===-1){i+=1}}return i/Math.pow(10,t)}e.$round=o;function s(e,t){var r=u.random()*(t-e);return Math.floor(r)+e}e.random=s;function a(e){if(typeof e==="number"){return true}if(typeof e==="string"){if(e===""){return false}return isNaN(+e)===false}return false}e.isNumber=a})(b=e.Mathf||(e.Mathf={}));var h;(function(o){var n={};function e(e){var t=n[e];if(t===void 0||t.length===0){return null}var r=t.pop();delete r["__suncom__$__inPool__"];return r}o.getItem=e;function t(e,t,r){var n=o.getItem(e);if(n===null){if(Laya.Prefab!==void 0&&t===Laya.Prefab){var i=new Laya.Prefab;i.json=r;n=i.create()}else{n={};n.__proto__=t.prototype;if(r instanceof Array){t.apply(n,r)}else{t.call(n,r)}}}return n}o.getItemByClass=t;function r(e,t){if(t["__suncom__$__inPool__"]===true){return false}t["__suncom__$__inPool__"]=true;var r=n[e];if(r===void 0){n[e]=[t]}else{r.push(t)}return true}o.recover=r;function i(e){if(n[e]!==void 0){delete n[e]}}o.clear=i})(h=e.Pool||(e.Pool={}));var u;(function(e){var n=1;var i=1103515245;var o=12345;var s=32767;function t(e){if(e<1){e=1;A.warn(L.ANY,"随机种子不允许小于1")}n=e}e.seed=t;function r(){var e=dcodeIO.Long.fromNumber(n);var t=dcodeIO.Long.fromNumber(i);var r=dcodeIO.Long.fromNumber(o);n=Math.floor(e.mul(t).add(r).low/s);return(n%s+s)/(s*2)}e.random=r})(u=e.Random||(e.Random={}));var a;(function(r){r.ASSERT_FAILED=false;r.ASSERT_BREAKPOINT=true;var n=null;function e(e,t){if(R.debugMode&L.TEST){return new s(t).expect(e)}if(n===null){n=new s}return n}r.expect=e;function t(e){if(R.debugMode&L.TEST){r.expect(true).interpret("Test.notExpected 期望之外的").toBe(false)}}r.notExpected=t;function i(e,t){if(R.debugMode&L.TEST){r.expect(e).interpret(t||"Test.assertTrue error，实际值："+d.toDisplayString(e)).toBe(true)}}r.assertTrue=i;function o(e,t){if(R.debugMode&L.TEST){r.expect(e).interpret(t||"Test.assertFalse error，实际值："+d.toDisplayString(e)).toBe(false)}}r.assertFalse=o})(a=e.Test||(e.Test={}))})(suncom||(suncom={}));var suncore;(function(e){var p;(function(e){e[e["PRIORITY_0"]=0]="PRIORITY_0";e[e["PRIORITY_HIGH"]=1]="PRIORITY_HIGH";e[e["PRIORITY_NOR"]=2]="PRIORITY_NOR";e[e["PRIORITY_LOW"]=3]="PRIORITY_LOW";e[e["PRIORITY_LAZY"]=4]="PRIORITY_LAZY";e[e["PRIORITY_TRIGGER"]=5]="PRIORITY_TRIGGER";e[e["PRIORITY_TASK"]=6]="PRIORITY_TASK";e[e["PRIORITY_PROMISE"]=7]="PRIORITY_PROMISE";e[e["E_MAX"]=8]="E_MAX"})(p=e.MessagePriorityEnum||(e.MessagePriorityEnum={}));var v;(function(e){e[e["SYSTEM"]=0]="SYSTEM";e[e["CUSTOM"]=1]="CUSTOM";e[e["TIMELINE"]=2]="TIMELINE";e[e["MAX"]=3]="MAX"})(v=e.ModuleEnum||(e.ModuleEnum={}));var i;(function(e){e[e["NSL_MSG_ID_BEGIN"]=1]="NSL_MSG_ID_BEGIN";e[e["NSL_MSG_ID_END"]=10]="NSL_MSG_ID_END";e[e["MMI_MSG_ID_BEGIN"]=10]="MMI_MSG_ID_BEGIN";e[e["MMI_MSG_ID_END"]=100]="MMI_MSG_ID_END";e[e["CUI_MSG_ID_BEGIN"]=100]="CUI_MSG_ID_BEGIN";e[e["CUI_MSG_ID_END"]=200]="CUI_MSG_ID_END";e[e["GUI_MSG_ID_BEGIN"]=200]="GUI_MSG_ID_BEGIN";e[e["GUI_MSG_ID_END"]=400]="GUI_MSG_ID_END";e[e["L4C_MSG_ID_BEGIN"]=400]="L4C_MSG_ID_BEGIN";e[e["L4C_MSG_ID_END"]=700]="L4C_MSG_ID_END"})(i=e.MsgQIdEnum||(e.MsgQIdEnum={}));var l;(function(e){e[e["E_NIL"]=-1]="E_NIL";e[e["E_KAL"]=0]="E_KAL";e[e["MMI"]=1]="MMI";e[e["L4C"]=2]="L4C";e[e["CUI"]=3]="CUI";e[e["GUI"]=4]="GUI";e[e["NSL"]=5]="NSL";e[e["E_ANY"]=6]="E_ANY"})(l=e.MsgQModEnum||(e.MsgQModEnum={}));var t=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$var_done=false;e.$var_running=false;return e}e.prototype.cancel=function(){};Object.defineProperty(e.prototype,"done",{get:function(){return this.$var_done},set:function(e){if(this.$var_done!==e){this.$var_done=e;if(e===true){this.cancel()}}},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"running",{get:function(){return this.$var_running},set:function(e){this.$var_running=e},enumerable:false,configurable:true});return e}(puremvc.Notifier);e.AbstractTask=t;var r=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$var_running=false;return e}e.prototype.run=function(){if(this.$var_running===true){suncom.Logger.warn(suncom.DebugMode.ANY,"服务["+suncom.Common.getQualifiedClassName(this)+"]己运行");return}this.$var_running=true;this.$onRun()};e.prototype.stop=function(){if(this.$var_running===false){suncom.Logger.warn(suncom.DebugMode.ANY,"服务["+suncom.Common.getQualifiedClassName(this)+"]未运行");return}this.$var_running=false;this.$onStop()};Object.defineProperty(e.prototype,"running",{get:function(){return this.$var_running},enumerable:false,configurable:true});return e}(puremvc.Notifier);e.BaseService=r;var n=function(t){__extends(e,t);function e(){var e=t.call(this,l.E_KAL)||this;e.$delta=0;e.$runTime=0;e.$localTime=Date.now();Laya.timer.frameLoop(1,e,e.$onFrameLoop);return e}e.prototype.destroy=function(){if(this.$destroyed===true){return}t.prototype.destroy.call(this);Laya.timer.clear(this,this.$onFrameLoop)};e.prototype.$onFrameLoop=function(){var e=this.$localTime;this.$localTime=Date.now();this.$delta=this.$localTime-e;if(this.$delta>0){this.$runTime+=this.$delta;this.$lapse(this.$delta)}};e.prototype.$lapse=function(e){if(S.isModulePaused(v.CUSTOM)===false){g.timeStamp.lapse(e)}if(S.isModulePaused(v.TIMELINE)===false){g.timeline.lapse(e)}this.facade.sendNotification($.MSG_Q_BUSINESS,l.NSL);this.facade.sendNotification($.PHYSICS_PREPARE);this.facade.sendNotification($.PHYSICS_FRAME);g.timerManager.executeTimer();this.facade.sendNotification($.ENTER_FRAME);g.messageManager!==null&&g.messageManager.dealMessage();g.messageManager!==null&&g.messageManager.classifyMessages0();this.facade.sendNotification($.LATER_FRAME);this.facade.sendNotification($.MSG_Q_BUSINESS)};e.prototype.getTime=function(){return this.$runTime};e.prototype.getDelta=function(){return this.$delta};return e}(puremvc.Notifier);e.Engine=n;var m=function(){function e(){this.mod=v.SYSTEM;this.priority=p.PRIORITY_0;this.weights=0;this.task=null;this.groupId=0;this.args=null;this.method=null;this.caller=null;this.timeout=0}e.prototype.recover=function(){this.task=null;this.args=null;this.method=null;this.caller=null;suncom.Pool.recover("suncore.Message",this)};return e}();e.Message=m;var o=function(){function e(){this.$queues=[];for(var e=0;e<v.MAX;e++){this.$queues[e]=new s(e)}}e.prototype.putMessage=function(e){this.$queues[e.mod].putMessage(e)};e.prototype.dealMessage=function(){for(var e=0;e<v.MAX;e++){if(S.isModulePaused(e)===false){this.$queues[e].dealMessage()}}};e.prototype.classifyMessages0=function(){for(var e=0;e<v.MAX;e++){if(S.isModuleStopped(e)===false){this.$queues[e].classifyMessages0()}}};e.prototype.clearMessages=function(e){this.$queues[e].clearMessages()};e.prototype.cancelTaskByGroupId=function(e,t){this.$queues[e].cancelTaskByGroupId(e,t)};return e}();e.MessageManager=o;var s=function(){function e(e){this.$tasks=[];this.$queues=[];this.$messages0=[];this.$canceled=false;this.$weights=0;this.$mod=e;for(var t=0;t<p.E_MAX;t++){this.$queues[t]=[]}}e.prototype.putMessage=function(e){this.$messages0.push(e);if(e.priority===p.PRIORITY_PROMISE){this.$initPromiseWeights(e)}};e.prototype.$initPromiseWeights=function(e){var t=this.$queues[p.PRIORITY_PROMISE];if(t.length===0){e.weights=this.$weights}else{var r=t[0];if(r.task.running===false){e.weights=this.$weights}else{e.weights=this.$weights=t[0].weights+1}}};e.prototype.dealMessage=function(){var e=0;var t=0;for(var r=0;r<p.E_MAX;r++){var n=void 0;if(r===p.PRIORITY_TASK){n=this.$tasks}else{n=this.$queues[r]}if(n.length===0||r===p.PRIORITY_LAZY){continue}if(r===p.PRIORITY_TASK){for(var i=this.$tasks.length-1;i>-1;i--){var o=this.$tasks[i];if(o.length>0&&this.$dealTaskMessage(o[0])===true){o.shift().recover();e++}if(o.length>1){t+=o.length-1}else if(o.length===0){this.$tasks.splice(i,1)}}}else if(r===p.PRIORITY_PROMISE){while(n.length>0){e++;var s=n[0];if(this.$dealTaskMessage(s)===false){break}n.shift().recover();if(this.$weights>s.weights){break}}}else if(r===p.PRIORITY_TRIGGER){while(n.length>0&&this.$dealTriggerMessage(n[0])===true){n.shift().recover();if(this.$canceled===false){e++}}}else{var a=0;var u=this.$getDealCountByPriority(r);for(;n.length>0&&(u===0||a<u);a++){var l=n.shift();if(this.$dealCustomMessage(l)===false){a--}l.recover()}e+=a}t+=n.length}if(t===0&&e===0&&this.$messages0.length===0){var n=this.$queues[p.PRIORITY_LAZY];if(n.length>0){var l=n.shift();this.$dealCustomMessage(l);e++;l.recover()}}};e.prototype.$dealTaskMessage=function(e){var t=e.task;if(t.running===false){t.running=true;if(t.run()===true){t.done=true}}return t.done===true};e.prototype.$dealTriggerMessage=function(e){if(e.timeout>S.getModuleTimestamp(this.$mod)){return false}this.$canceled=e.method.apply(e.caller,e.args)===false;return true};e.prototype.$dealCustomMessage=function(e){return e.method.apply(e.caller,e.args)!==false};e.prototype.$getDealCountByPriority=function(e){if(e===p.PRIORITY_0){return 0}if(e===p.PRIORITY_HIGH){return 10}if(e===p.PRIORITY_NOR){return 3}if(e===p.PRIORITY_LOW){return 1}throw Error("错误的消息优先级")};e.prototype.classifyMessages0=function(){while(this.$messages0.length>0){var e=this.$messages0.shift();if(e.priority===p.PRIORITY_TASK){this.$addTaskMessage(e)}else if(e.priority===p.PRIORITY_TRIGGER){this.$addTriggerMessage(e)}else if(e.priority===p.PRIORITY_PROMISE){this.$addPromiseMessage(e)}else{this.$queues[e.priority].push(e)}}};e.prototype.$addPromiseMessage=function(e){var t=this.$queues[p.PRIORITY_PROMISE];var r=-1;for(var n=0;n<t.length;n++){var i=t[n];if(i.task.running===true){continue}if(i.weights<e.weights){r=n;break}}if(r===-1){t.push(e)}else{t.splice(r,0,e)}};e.prototype.$addTriggerMessage=function(e){var t=this.$queues[p.PRIORITY_TRIGGER];var r=0;var n=0;var i=t.length-1;var o=-1;while(i-r>1){n=Math.floor((r+i)*.5);if(t[n].timeout<=e.timeout){r=n}else if(t[n].timeout>e.timeout){i=n}else{break}}for(var s=r;s<=i;s++){if(t[s].timeout>e.timeout){o=s;break}}if(o<0){t.push(e)}else{t.splice(o,0,e)}};e.prototype.$addTaskMessage=function(e){var t=-1;for(var r=0;r<this.$tasks.length;r++){var n=this.$tasks[r];if(n.length>0&&n[0].groupId===e.groupId){t=r;break}}if(t===-1){this.$tasks.unshift([e])}else{this.$tasks[t].push(e)}};e.prototype.clearMessages=function(){while(this.$messages0.length>0){this.$cancelMessage(this.$messages0.shift())}for(var e=0;e<this.$tasks.length;e++){var t=this.$tasks[e];while(t.length>0){this.$cancelMessage(t.shift())}}for(var r=0;r<p.E_MAX;r++){var n=this.$queues[r];while(n.length>0){this.$cancelMessage(n.shift())}}};e.prototype.$cancelMessage=function(e){if(e.priority===p.PRIORITY_TASK){e.task.done=true}e.recover()};e.prototype.cancelTaskByGroupId=function(e,t){for(var r=0;r<this.$tasks.length;r++){var n=this.$tasks[r];if(n.length>0&&n[0].groupId===t){while(n.length>0){var i=n.shift();i.task.done=true;i.recover()}break}}};return e}();e.MessageQueue=s;var c=function(){function e(){this.dst=l.E_ANY;this.id=0;this.data=null;this.batchIndex=0}e.prototype.setTo=function(e,t,r,n){this.id=t;this.dst=e;this.data=r;this.batchIndex=n;return this};e.prototype.recover=function(){this.data=null;suncom.Pool.recover("suncore.MsgQMsg",this)};return e}();e.MsgQMsg=c;var a=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$onRun=function(){y.setModuleActive(this.msgQMod,true);this.facade.registerObserver($.MSG_Q_BUSINESS,this.$func_onMsgQBusiness,this)};t.prototype.$onStop=function(){y.setModuleActive(this.msgQMod,false);this.facade.removeObserver($.MSG_Q_BUSINESS,this.$func_onMsgQBusiness,this)};t.prototype.$func_onMsgQBusiness=function(e){var t=null;if(e===void 0||e===this.msgQMod){while(true){if(e===l.NSL){t=y.fetch(l.NSL,2)}else if(this.msgQMod===l.NSL){t=y.fetch(l.NSL,1)}else{t=y.fetch(this.msgQMod)}if(t===null){break}this.$dealMsgQMsg(t.id,t.data);t.recover()}y.batchIndex++}};return t}(r);e.MsgQService=a;var u=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t){if(t!==true&&t!==false){throw Error("参数stop应当为布尔值")}if(t===true){if(S.isModuleStopped(e)===true){suncom.Logger.error(suncom.DebugMode.ANY,"模块 "+v[e]+" 己经停止！！！");return}}else if(S.isModulePaused(e)===true){suncom.Logger.error(suncom.DebugMode.ANY,"模块 "+v[e]+" 己经暂停！！！");return}else if(e===v.SYSTEM){suncom.Logger.error(suncom.DebugMode.ANY,"无法暂停 "+v[e]+" 模块！！！");return}if(e===v.TIMELINE){g.timeline.pause(t)}else if(e===v.CUSTOM){g.timeStamp.pause(t)}if(t===false){return}if(e===v.SYSTEM){if(S.isModuleStopped(v.TIMELINE)===false||S.isModuleStopped(v.CUSTOM)===false){suncom.Logger.error(suncom.DebugMode.ANY,"SYSTEM 不能停止因为 CUSTOM 或 TIMELINE 依然在运行")}}g.timerManager.clearTimer(e);g.messageManager.clearMessages(e);if(e===v.TIMELINE){g.timeline=null}else if(e===v.CUSTOM){g.timeStamp=null}else{g.engine.destroy();g.engine=null}if(e===v.SYSTEM){g.timerManager=null;g.messageManager=null}};return t}(puremvc.SimpleCommand);e.PauseTimelineCommand=u;var f=function(i){__extends(e,i);function e(e,t,r){if(r===void 0){r=null}var n=i.call(this)||this;n.$var_args=null;n.$var_caller=null;n.$var_method=null;n.$var_args=r;n.$var_caller=e;n.$var_method=t;return n}e.prototype.run=function(){this.$var_method.apply(this.$var_caller,this.$var_args);return true};return e}(t);e.SimpleTask=f;var d=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t){if(t!==true&&t!==false){throw Error("参数pause应当为布尔值")}if(S.isModulePaused(e)===false){suncom.Logger.error(suncom.DebugMode.ANY,"模块 "+v[e]+" 己经启动！！！");return}if(e===v.SYSTEM&&g.engine===null){g.timerManager=new E;g.messageManager=new o}if(e===v.TIMELINE){if(g.timeline===null){g.timeline=new h}g.timeline.resume(t)}else if(e===v.CUSTOM){if(g.timeStamp===null){g.timeStamp=new h}g.timeStamp.resume(t)}else if(e===v.SYSTEM){if(g.engine===null){g.engine=new n}}};return t}(puremvc.SimpleCommand);e.StartTimelineCommand=d;var h=function(){function e(){this.$runTime=0;this.$paused=true;this.$stopped=true}e.prototype.lapse=function(e){this.$runTime+=e};e.prototype.pause=function(e){this.$paused=true;this.$stopped=e};e.prototype.resume=function(e){this.$paused=e;this.$stopped=false};e.prototype.getTime=function(){return this.$runTime};Object.defineProperty(e.prototype,"paused",{get:function(){return this.$paused},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"stopped",{get:function(){return this.$stopped},enumerable:false,configurable:true});return e}();e.Timeline=h;var T=function(){function e(){this.mod=v.SYSTEM;this.active=false;this.delay=0;this.method=null;this.caller=null;this.args=null;this.real=false;this.count=0;this.loops=1;this.timerId=0;this.timestamp=-1;this.timeout=0}e.prototype.recover=function(){this.method=null;this.caller=null;this.args=null;suncom.Pool.recover("suncore.Timer",this)};return e}();e.Timer=T;var E=function(){function e(){this.$timers=[];this.$timerMap={};for(var e=0;e<v.MAX;e++){this.$timers[e]=[]}}e.prototype.executeTimer=function(){for(var e=0;e<v.MAX;e++){if(S.isModulePaused(e)===false){var t=this.$timers[e];var r=S.getModuleTimestamp(e);while(t.length>0){var n=t[0];if(n.active===true){if(n.timeout>r){break}if(n.real===true){n.count++}else{n.count=Math.min(Math.floor((r-n.timestamp)/n.delay),n.loops)}}var i=false;if(n.active===false||n.loops>0&&n.count>=n.loops){delete this.$timerMap[n.timerId]}else{this.addTimer(n.mod,n.delay,n.method,n.caller,n.args,n.loops,n.real,n.timerId,n.timestamp,n.timeout,n.count)}t.shift();if(n.active===true){if(n.args===null){n.method.call(n.caller,n.count,n.loops)}else{n.method.apply(n.caller,n.args.concat(n.count,n.loops))}}n.recover()}}}};e.prototype.addTimer=function(e,t,r,n,i,o,s,a,u,l,c){if(i===void 0){i=null}if(o===void 0){o=1}if(s===void 0){s=false}if(a===void 0){a=0}if(u===void 0){u=-1}if(l===void 0){l=-1}if(c===void 0){c=0}var f=S.getModuleTimestamp(e);if(a===0){a=suncom.Common.createHashId()}if(u===-1){u=f}if(l===-1){l=f}var d;if(typeof t==="number"){d=t}else{d=t[1]||0;t=t[0]}if(t<1){t=1}var h=0;if(s===true){h=(f-l)%t}else{h=(f-u)%t}l=f+t-h;if(d===0){if(i===null){r.call(n,0,o)}else{r.apply(n,i.concat(0,o))}}else if(d<t){var p=t-d;l=suncom.Mathf.clamp(l-p,f+1,l)}var v=suncom.Pool.getItemByClass("suncore.Timer",T);v.mod=e;v.active=true;v.delay=t;v.method=r;v.caller=n;v.args=i;v.real=s;v.count=c;v.loops=o;v.timerId=a;v.timestamp=u;v.timeout=l;var m=this.$timers[e];var E=-1;var _=0;var g=0;var y=m.length-1;while(y-_>1){g=Math.floor((_+y)*.5);if(m[g].timeout<=l){_=g}else if(m[g].timeout>l){y=g}else{break}}for(var $=_;$<=y;$++){if(m[$].timeout>l){E=$;break}}if(E<0){m.push(v)}else{m.splice(E,0,v)}this.$timerMap[a]=v;return a};e.prototype.removeTimer=function(e){if(e>0&&this.$timerMap[e]!==void 0){this.$timerMap[e].active=false}return 0};e.prototype.clearTimer=function(e){var t=this.$timers[e];while(t.length>0){var r=t.pop();delete this.$timerMap[r.timerId];r.recover()}};return e}();e.TimerManager=E;var _=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.run=function(){var e=this.$resolve.bind(this);this.$var_method.apply(this.$var_caller,this.$var_args===null?[e]:[e].concat(this.$var_args));return this.done};t.prototype.$resolve=function(){this.done=true};return t}(f);e.PromiseTask=_;var g;(function(e){e.engine=null;e.timeline=null;e.timeStamp=null;e.timerManager=null;e.messageManager=null})(g=e.M||(e.M={}));var y;(function(o){var s={};var n={};o.batchIndex=1;function e(e,t,r){if(u(e)===false){suncom.Logger.warn(suncom.DebugMode.ANY,"消息发送失败，模块己暂停 mod:"+l[e]);return}if(a(e,t)===false){suncom.Logger.warn(suncom.DebugMode.ANY,"消息发送失败，消息ID非法 mod:"+e+", id:"+t);return}var n=s[e];if(n===void 0){n=s[e]=[]}var i=suncom.Pool.getItemByClass("suncore.MsgQMsg",c);n.push(i.setTo(e,t,r,o.batchIndex))}o.send=e;function t(e,t){var r=s[e];if(r===void 0||r.length===0){return null}for(var n=0;n<r.length;n++){var i=r[n];if(e===l.NSL||i.batchIndex<o.batchIndex){if(t===void 0||i.id===t){r.splice(n,1);return i}}}return null}o.fetch=t;function a(e,t){var r=suncom.Mathf.MIN_SAFE_INTEGER;var n=suncom.Mathf.MAX_SAFE_INTEGER;if(e===l.MMI){r=i.MMI_MSG_ID_BEGIN;n=i.MMI_MSG_ID_END}else if(e===l.CUI){r=i.CUI_MSG_ID_BEGIN;n=i.CUI_MSG_ID_END}else if(e===l.GUI){r=i.GUI_MSG_ID_BEGIN;n=i.GUI_MSG_ID_END}else if(e===l.L4C){r=i.L4C_MSG_ID_BEGIN;n=i.L4C_MSG_ID_END}else if(e===l.NSL){r=i.NSL_MSG_ID_BEGIN;n=i.NSL_MSG_ID_END}else{throw Error("未知的消息范围 mod:"+e)}return t>=r&&t<n}function u(e){return n[e]===true}o.isModuleActive=u;function r(e,t){n[e]=t;if(t===false){var r=s[e]||[];while(r.length>0){r.pop().recover()}delete s[e]}}o.setModuleActive=r})(y=e.MsgQ||(e.MsgQ={}));var $;(function(e){e.STARTUP="suncore.NotifyKey.STARTUP";e.SHUTDOWN="suncore.NotifyKey.SHUTDOWN";e.START_TIMELINE="suncore.NotifyKey.START_TIMELINE";e.PAUSE_TIMELINE="suncore.NotifyKey.PAUSE_TIMELINE";e.PHYSICS_FRAME="suncore.NotifyKey.PHYSICS_FRAME";e.PHYSICS_PREPARE="suncore.NotifyKey.PHYSICS_PREPARE";e.ENTER_FRAME="suncore.NotifyKey.ENTER_FRAME";e.LATER_FRAME="suncore.NotifyKey.LATER_FRAME";e.MSG_Q_BUSINESS="suncore.NotifyKey.MSG_Q_BUSINESS"})($=e.NotifyKey||(e.NotifyKey={}));var S;(function(a){var e=1e3;function i(){e++;return e}function t(e){if(e===v.TIMELINE){if(g.timeline===null||g.timeline.stopped===true){return true}}else if(e===v.CUSTOM){if(g.timeStamp===null||g.timeStamp.stopped===true){return true}}else if(g.engine===null){return true}return false}a.isModuleStopped=t;function r(e){if(t(e)===true){return true}if(e===v.TIMELINE){return g.timeline.paused}else if(e===v.CUSTOM){return g.timeStamp.paused}return false}a.isModulePaused=r;function n(){if(t(v.SYSTEM)===false){return g.engine.getDelta()}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试获取帧时间间隔，但系统模块己停止！！！")}}a.getDelta=n;function o(e){if(t(e)===false){if(e===v.TIMELINE){return g.timeline.getTime()}else if(e===v.CUSTOM){return g.timeStamp.getTime()}return g.engine.getTime()}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试获取时间戳，但模块 "+v[e]+" 己停止！！！")}}a.getModuleTimestamp=o;function s(e,t,r){if(r===void 0){r=0}if(a.isModuleStopped(e)===false){if(r===-1){r=i()}else if(r>1e3){throw Error("自定义的Task GroupId不允许超过1000")}var n=suncom.Pool.getItemByClass("suncore.Message",m);n.mod=e;n.task=t;n.groupId=r;n.priority=p.PRIORITY_TASK;g.messageManager.putMessage(n)}else{r=-1;suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加任务，但模块 "+v[e]+" 己停止！！！")}return r}a.addTask=s;function u(e,t){g.messageManager.cancelTaskByGroupId(e,t)}a.cancelTaskByGroupId=u;function l(e,t,r,n,i){if(i===void 0){i=null}if(a.isModuleStopped(e)===false){var o=suncom.Pool.getItemByClass("suncore.Message",m);o.mod=e;o.args=i;o.caller=r;o.method=n;o.timeout=a.getModuleTimestamp(e)+t;o.priority=p.PRIORITY_TRIGGER;g.messageManager.putMessage(o)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加触发器，但模块 "+v[e]+" 己停止！！！")}}a.addTrigger=l;function c(e,t,r,n){if(n===void 0){n=null}if(a.isModuleStopped(e)===false){var i=suncom.Pool.getItemByClass("suncore.Message",m);i.mod=e;i.task=new _(t,r,n);i.priority=p.PRIORITY_PROMISE;g.messageManager.putMessage(i)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加Promise消息，但模块 "+v[e]+" 己停止！！！")}}a.addPromise=c;function f(e,t,r,n,i){if(i===void 0){i=null}if(a.isModuleStopped(e)===false){var o=suncom.Pool.getItemByClass("suncore.Message",m);o.mod=e;o.args=i;o.caller=r;o.method=n;o.priority=t;g.messageManager.putMessage(o)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加Message消息，但模块 "+v[e]+" 己停止！！！")}}a.addMessage=f;function d(e,t,r,n,i,o,s){if(o===void 0){o=1}if(s===void 0){s=false}if(a.isModuleStopped(e)===false){return g.timerManager.addTimer(e,t,r,n,i,o,s)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加定时器，但模块 "+v[e]+" 己停止！！！")}}a.addTimer=d;function h(e){return g.timerManager.removeTimer(e)}a.removeTimer=h})(S=e.System||(e.System={}))})(suncore||(suncore={}));var suntdd;(function(e){var r;(function(e){e[e["CONNECTED"]=0]="CONNECTED";e[e["CONNECTING"]=1]="CONNECTING";e[e["DISCONNECTED"]=2]="DISCONNECTED"})(r=e.MSWSConnectionStateEnum||(e.MSWSConnectionStateEnum={}));var n;(function(e){e[e["CONNECTED"]=0]="CONNECTED";e[e["CLOSE"]=1]="CLOSE";e[e["ERROR"]=2]="ERROR"})(n=e.MSWSStateEnum||(e.MSWSStateEnum={}));var s;(function(e){e[e["NONE"]=0]="NONE";e[e["BUTTON_CLICK"]=1]="BUTTON_CLICK";e[e["SIGNAL_EMIT"]=2]="SIGNAL_EMIT";e[e["SIGNAL_WAIT"]=3]="SIGNAL_WAIT";e[e["WS_STATE"]=4]="WS_STATE";e[e["WS_PROTOCAL"]=5]="WS_PROTOCAL"})(s=e.TestActionKindEnum||(e.TestActionKindEnum={}));var a;(function(e){e[e["NONE"]=1]="NONE";e[e["NOT_YET"]=2]="NOT_YET";e[e["COMPLETE"]=4]="COMPLETE";e[e["SUSPEND"]=8]="SUSPEND"})(a=e.TestActionResultEnum||(e.TestActionResultEnum={}));var i;(function(e){e[e["INSERT"]=0]="INSERT";e[e["APPEND"]=1]="APPEND"})(i=e.TestCaseRegOptionEnum||(e.TestCaseRegOptionEnum={}));var u;(function(e){e[e["PREPARE"]=0]="PREPARE";e[e["EXECUTE"]=1]="EXECUTE";e[e["FINISH"]=2]="FINISH"})(u=e.TestCaseStatusEnum||(e.TestCaseStatusEnum={}));var o=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){delete y.buttonMap[e];var t=y.waitMap[e]||null;if(t===null){return}for(var r=0;r<t.length;r++){var n=t[r];if(n.line===true){continue}n.canceled=true}};return t}(puremvc.SimpleCommand);e.CancelCommand=o;var l=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){var t={id:e};this.facade.sendNotification($.ADD_ACTION,[s.BUTTON_CLICK,t])};return t}(puremvc.SimpleCommand);e.ClickCommand=l;var c=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$click=null;e.$button=null;return e}e.prototype.execute=function(e){this.$click=e;this.$button=y.buttonMap[e.id]||null;suncom.Test.expect(this.$button).not.toBeNull();if(this.$button.once===true){delete y.buttonMap[e.id]}suncore.System.addTimer(suncore.ModuleEnum.SYSTEM,500,this.$doClick,this)};e.prototype.$doClick=function(){var e=new Laya.Event;e.setTo(Laya.Event.CLICK,this.$button.button,this.$button.button);this.$button.button.event(Laya.Event.CLICK,e);this.$click.done=true};return e}(puremvc.SimpleCommand);e.DoClickCommand=c;var f=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$cfg=null;return e}e.prototype.execute=function(e){this.$cfg=e;suncom.Test.expect(e.id).toBeGreaterThan(0);if(e.delay<=0){this.$doEmit()}else{suncore.System.addTimer(suncore.ModuleEnum.SYSTEM,e.delay,this.$doEmit,this)}};e.prototype.$doEmit=function(){suncom.Test.expect(y.currentSignalId).interpret("信号发射干扰").toBe(0);y.currentSignalId=this.$cfg.id;var e=y.waitMap[this.$cfg.id]||null;if(e!==null){for(var t=0;t<e.length;t++){var r=e[t];if(r.once===true&&r.done===true){continue}if(r.once===true){r.done=true}if(r.canceled===true){continue}var n=r.handler||null;if(n===null){continue}n.runWith(this.$cfg.args)}}this.$cfg.done=true;y.currentSignalId=0};return e}(puremvc.SimpleCommand);e.DoEmitCommand=f;var d=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,r,n){var i={id:e,args:t,line:r,delay:n};if(r===false){this.facade.sendNotification($.DO_EMIT,i)}else{this.facade.sendNotification($.ADD_ACTION,[s.SIGNAL_EMIT,i])}};return t}(puremvc.SimpleCommand);e.EmitCommand=d;var t=function(t){__extends(e,t);function e(){var e=t.call(this,0)||this;e.$actions=[];y.timeDiff=suncom.Mathf.random(-8e3,8e3);if(suncore.System.isModuleStopped(suncore.ModuleEnum.SYSTEM)===true){throw Error("微服务器未运行，因为SYSTEM时间轴未开启")}return e}e.prototype.$onRun=function(){this.facade.registerCommand($.EMIT,d);this.facade.registerCommand($.WAIT,g);this.facade.registerCommand($.CLICK,l);this.facade.registerCommand($.CANCEL,o);this.facade.registerCommand($.DO_EMIT,f);this.facade.registerCommand($.DO_CLICK,c);this.facade.registerCommand($.REG_BUTTON,p);this.facade.registerCommand($.PREPARE_PROTOCAL_PACKET,h);this.facade.registerCommand($.SERIALIZE_WEBSOCKET_STATE_PACKET,E);this.facade.registerCommand($.SERIALIZE_WEBSOCKET_PROTOCAL_PACKET,m);this.facade.registerObserver($.ADD_WAIT,this.$addWait,this);this.facade.registerObserver($.ADD_ACTION,this.$addAction,this);this.facade.registerObserver($.TEST_WEBSOCKET_SEND_DATA,this.$onWebSocketSendData,this);this.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)};e.prototype.$onStop=function(){this.facade.removeCommand($.EMIT);this.facade.removeCommand($.WAIT);this.facade.removeCommand($.CLICK);this.facade.removeCommand($.CANCEL);this.facade.removeCommand($.DO_EMIT);this.facade.removeCommand($.DO_CLICK);this.facade.removeCommand($.REG_BUTTON);this.facade.removeCommand($.PREPARE_PROTOCAL_PACKET);this.facade.removeCommand($.SERIALIZE_WEBSOCKET_STATE_PACKET);this.facade.removeCommand($.SERIALIZE_WEBSOCKET_PROTOCAL_PACKET);this.facade.removeObserver($.ADD_WAIT,this.$addWait,this);this.facade.removeObserver($.ADD_ACTION,this.$addAction,this);this.facade.removeObserver($.TEST_WEBSOCKET_SEND_DATA,this.$onWebSocketSendData,this);this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)};e.prototype.$onEnterFrame=function(){var e=false;while(this.$actions.length>0){var t=this.$actions[0];var r=a.NONE;switch(t.kind){case s.SIGNAL_WAIT:r=this.$doWait(t.cfg);break;case s.SIGNAL_EMIT:r=this.$doEmit(t.cfg);break;case s.BUTTON_CLICK:r=this.$doClick(t.cfg);break;case s.WS_STATE:r=this.$notifyStatePacket(t.cfg);break;case s.WS_PROTOCAL:r=this.$notifyProtocalPacket(t.cfg);break;default:suncom.Test.notExpected();break}if(r&a.NOT_YET){break}if(r&a.COMPLETE){this.$actions.shift()}if(r&a.SUSPEND){break}if(t.kind===s.WS_PROTOCAL){e=true}if(e===true&&this.$actions.length>0){var n=this.$actions[0];if(n.kind===s.WS_PROTOCAL){var i=n.cfg;if(i.asNewMsg===true){break}}}}if(this.$actions.length>0){return}if(y.currentTestCase===null){var o=y.tccQueue.shift()||null;y.currentTestCase=o===null?null:new o.taskCls(o.tcId)}else if(y.currentTestCase.status===u.EXECUTE){y.currentTestCase.done()}else if(y.currentTestCase.status===u.FINISH){suncom.Test.expect(this.$actions.length).toBe(0);y.currentTestCase=null}};e.prototype.$onWebSocketSendData=function(e){for(var t=0;t<this.$actions.length;t++){var r=this.$actions[t];if(r.kind===s.WS_PROTOCAL){var n=r.cfg;if(n.waitName===e&&n.waitTimes>0&&n.waitCount<n.waitTimes){n.waitCount++}break}}};e.prototype.$addAction=function(e,t){var r={kind:e,cfg:t};this.$actions.push(r)};e.prototype.$addWait=function(e){var t=y.waitMap[e.id]||null;if(t===null){t=y.waitMap[e.id]=[]}var r=-1;for(var n=0;n<t.length;n++){if(t[n]===e){r=n;break}}if(r===-1){t.push(e)}};e.prototype.$notifyProtocalPacket=function(e){if(this.$notYet(e)===true){return a.NOT_YET}this.facade.sendNotification($.PREPARE_PROTOCAL_PACKET,e);this.facade.sendNotification($.TEST_WEBSOCKET_PROTOCAL,[e.replyName,e.data]);if(e.repeatTimes===1){return a.COMPLETE}e.repeatTimes--;e.waitCount=0;delete e.createTime;return a.SUSPEND};e.prototype.$notifyStatePacket=function(e){var t={name:e.connName,state:r.DISCONNECTED};this.facade.sendNotification($.GET_WEBSOCKET_INFO,t);if(t.state===r.DISCONNECTED){return a.NOT_YET}if(this.$notYet(e)===true){return a.NOT_YET}if(t.state===r.CONNECTING){suncom.Test.assertTrue(e.state===n.CONNECTED||e.state===n.ERROR,"当前网络正在连接，仅允许下行CONNECTED或ERROR状态")}else if(t.state===r.CONNECTED){suncom.Test.assertTrue(e.state===n.CLOSE||e.state===n.ERROR,"当前网络己连接，仅允许下行CLOSE或ERROR状态")}this.facade.sendNotification($.TEST_WEBSOCKET_STATE,e.state);return a.COMPLETE|a.SUSPEND};e.prototype.$notYet=function(e){if(e.waitName!==null&&e.waitCount<e.waitTimes){return true}if(e.createTime===void 0){e.createTime=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM)}if(e.createTime+e.delay>suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM)){return true}if(e.asNewMsg===true&&e.createTime===suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM)){return true}return false};e.prototype.$doClick=function(e){if(e.actTime===void 0){if(y.buttonMap[e.id]===void 0){return a.NOT_YET}e.actTime=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM);this.facade.sendNotification($.DO_CLICK,e);return a.NONE}else if(e.done===true){return a.COMPLETE}else{return a.NOT_YET}};e.prototype.$doEmit=function(e){if(e.done===true){return a.COMPLETE}if(e.actTime===void 0){e.actTime=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM);this.facade.sendNotification($.DO_EMIT,e)}else{return a.NOT_YET}return a.NONE};e.prototype.$doWait=function(e){if(e.done===true){return a.COMPLETE}if(e.actTime===void 0){e.actTime=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM);this.$addWait(e)}else{return a.NOT_YET}return a.NONE};return e}(suncore.BaseService);e.MicroService=t;var h=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){if(e.data===null){return}for(var t=0;t<e.hashFileds.length;t++){this.$setFieldValue(e.data,e.hashFileds[t],suncom.Common.createHashId())}for(var t=0;t<e.timeFields.length;t++){var r=e.timeFields[t];var n=(new Date).valueOf()+y.timeDiff+r.arg1;this.$setFieldValue(e.data,r.arg2,dcodeIO.Long.fromNumber(n))}};t.prototype.$setFieldValue=function(e,t,r){var n=t.split(".");while(n.length>1){e=e[n.shift()]}e[n.shift()]=r};return t}(puremvc.SimpleCommand);e.PrepareProtocalPacketCommand=h;var p=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,r){suncom.Test.expect(t).anything();suncom.Test.expect(y.buttonMap[e]).toBeUndefined();var n={button:t,once:r};y.buttonMap[e]=n};return t}(puremvc.SimpleCommand);e.RegButtonCommand=p;var v=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$initializePacket=function(e){if(e.delay===void 0){e.delay=0}if(e.connName===void 0){e.connName="default"}if(e.asNewMsg===void 0){e.asNewMsg=true}if(e.waitName===void 0){e.waitName=null}if(e.waitTimes===void 0){e.waitTimes=1}e.waitCount=0;suncom.Test.expect(e.delay).interpret("消息下行延时必须大于或等于0").toBeGreaterOrEqualThan(0);suncom.Test.expect(e.waitTimes).interpret("消息上行等待次数必须大于0").toBeGreaterThan(0)};t.prototype.$initializePacketDefaultValue=function(e,t,r){if(t===void 0){t=[]}if(r===void 0){r=[]}if(e.data===null){return}e.hashFileds=r;e.timeFields=[];for(var n=0;n<t.length;n++){var i=this.$getFieldValue(e.data,t[n],0);e.timeFields.push({arg1:i,arg2:t[n]})}};t.prototype.$getFieldValue=function(e,t,r){var n=t.split(".");while(n.length>0){e=e[n.shift()]}return e===void 0?r:e};return t}(puremvc.SimpleCommand);e.SerializeWebSocketPacketCommand=v;var m=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,r){this.$initializePacket(e);if(e.data===void 0){e.data=null}if(e.replyName===void 0){e.replyName=null}if(e.repeatTimes===void 0){e.repeatTimes=1}this.$initializePacketDefaultValue(e,t,r);suncom.Test.expect(e.repeatTimes).interpret("消息的下行次数必须大于或等于1").toBeGreaterOrEqualThan(1);this.facade.sendNotification($.ADD_ACTION,[s.WS_PROTOCAL,e])};return t}(v);e.SerializeWebSocketProtocalPacketCommand=m;var E=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){this.$initializePacket(e);suncom.Test.expect(e.state).interpret("必须指定WebSocket状态包的状态值").not.toBeUndefined();this.facade.sendNotification($.ADD_ACTION,[s.WS_STATE,e])};return t}(v);e.SerializeWebSocketStatePacketCommand=E;var _=function(r){__extends(e,r);function e(e){var t=r.call(this,0)||this;t.$status=u.PREPARE;t.$caseId=e;y.currentTestCase=t;suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,t,t.$doPrepare);return t}e.prototype.done=function(){this.$afterAll();this.$status=u.FINISH};e.prototype.$doPrepare=function(){this.$status=u.EXECUTE;this.$beforeAll()};e.prototype.$addTest=function(e,t,r){if(r===void 0){r=i.APPEND}var n={tcId:e,taskCls:t};if(r===i.APPEND){y.tccQueue.push(n)}else{y.tccQueue.unshift(n)}};e.prototype.$describe=function(e){suncom.Logger.log(suncom.DebugMode.TDD,e)};e.prototype.$beforeAll=function(){};e.prototype.$afterAll=function(){};e.prototype.$emit=function(e,t,r){if(r===void 0){r=0}this.facade.sendNotification($.EMIT,[e,t,true,r])};e.prototype.$wait=function(e,t,r,n){if(t===void 0){t=null}if(r===void 0){r=true}if(n===void 0){n=true}if(r===true){n=true}else{suncom.Test.expect(t).interpret("当参数line为false时必须指定handler").toBeInstanceOf(suncom.Handler)}this.facade.sendNotification($.WAIT,[e,t,r,n])};e.prototype.$click=function(e){this.facade.sendNotification($.CLICK,e)};e.prototype.$cancel=function(e){this.facade.sendNotification($.CANCEL,e)};e.prototype.$serializeWebSocketStatePacket=function(e){this.facade.sendNotification($.SERIALIZE_WEBSOCKET_STATE_PACKET,e)};e.prototype.$serializeWebSocketProtocalPacket=function(e,t,r,n){e.data=t;this.facade.sendNotification($.SERIALIZE_WEBSOCKET_PROTOCAL_PACKET,[e,r,n])};Object.defineProperty(e.prototype,"status",{get:function(){return this.$status},enumerable:false,configurable:true});return e}(puremvc.Notifier);e.TestCase=_;var g=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,r,n){var i={id:e,handler:t,line:r,once:n};if(r===true){this.facade.sendNotification($.ADD_ACTION,[s.SIGNAL_WAIT,i])}else{this.facade.sendNotification($.ADD_WAIT,i)}};return t}(puremvc.SimpleCommand);e.WaitCommand=g;var y;(function(e){e.timeDiff=0;e.currentSignalId=0;e.currentTestCase=null;e.tccQueue=[];e.waitMap={};e.buttonMap={}})(y=e.M||(e.M={}));var $;(function(e){e.EMIT="suntdd.NotifyKey.EMIT";e.WAIT="suntdd.NotifyKey.WAIT";e.DO_EMIT="suntdd.NotifyKey.DO_EMIT";e.CANCEL="suntdd.NotifyKey.CANCEL";e.CLICK="suntdd.NotifyKey.CLICK";e.DO_CLICK="suntdd.NotifyKey.DO_CLICK";e.REG_BUTTON="suntdd.NotifyKey.REG_BUTTON";e.ADD_WAIT="suntdd.NotifyKey.ADD_WAIT";e.ADD_ACTION="suntdd.NotifyKey.ADD_ACTION";e.GET_WEBSOCKET_INFO="suntdd.NotifyKey.GET_WEBSOCKET_INFO";e.TEST_WEBSOCKET_STATE="suntdd.NotifyKey.TEST_WEBSOCKET_STATE";e.TEST_WEBSOCKET_PROTOCAL="suntdd.NotifyKey.TEST_WEBSOCKET_PROTOCAL";e.TEST_WEBSOCKET_SEND_DATA="suntdd.NotifyKey.TEST_WEBSOCKET_SEND_DATA";e.PREPARE_PROTOCAL_PACKET="suntdd.NotifyKey.PREPARE_PROTOCAL_PACKET";e.SERIALIZE_WEBSOCKET_STATE_PACKET="suntdd.NotifyKey.SERIALIZE_WEBSOCKET_STATE_PACKET";e.SERIALIZE_WEBSOCKET_PROTOCAL_PACKET="suntdd.NotifyKey.SERIALIZE_WEBSOCKET_PROTOCAL_PACKET"})($=e.NotifyKey||(e.NotifyKey={}));var T;(function(e){function t(e,t,r){if(r===void 0){r=0}puremvc.Facade.getInstance().sendNotification($.EMIT,[e,t,false,r])}e.emit=t;function r(e,t,r){if(r===void 0){r=true}puremvc.Facade.getInstance().sendNotification($.REG_BUTTON,[e,t,r])}e.regButton=r})(T=e.Test||(e.Test={}))})(suntdd||(suntdd={}));var sunui;(function(r){var i;(function(e){e[e["NONE"]=0]="NONE";e[e["YES"]=1]="YES";e[e["NO"]=2]="NO";e[e["CANCEL"]=3]="CANCEL"})(i=r.ConfirmOptionValueEnum||(r.ConfirmOptionValueEnum={}));var u;(function(e){e[e["NONE"]=0]="NONE";e[e["SIMPLY"]=1]="SIMPLY";e[e["TRANSPARENT"]=2]="TRANSPARENT";e[e["MOUSE_THROUGH"]=4]="MOUSE_THROUGH";e[e["SYNC_FADE_TIME"]=8]="SYNC_FADE_TIME"})(u=r.PopupFlagEnum||(r.PopupFlagEnum={}));var t;(function(e){e[e["NONE"]=0]="NONE";e[e["HIGH"]=131072]="HIGH";e[e["MID"]=32768]="MID";e[e["LOW"]=8192]="LOW"})(t=r.ResourceDownloadSpeedEnum||(r.ResourceDownloadSpeedEnum={}));var l;(function(e){e[e["AUTO"]=16]="AUTO";e[e["CONFIRM"]=32]="CONFIRM";e[e["TERMINATE"]=64]="TERMINATE"})(l=r.RetryMethodEnum||(r.RetryMethodEnum={}));var c;(function(e){e[e["NONE"]=0]="NONE";e[e["BACKGROUND"]=1]="BACKGROUND";e[e["SCENE"]=2]="SCENE";e[e["PANEL"]=3]="PANEL";e[e["FLOAT"]=4]="FLOAT";e[e["GOLD_TIPS"]=5]="GOLD_TIPS";e[e["HIGH_GOLD_TIPS"]=6]="HIGH_GOLD_TIPS";e[e["NOTICE"]=7]="NOTICE";e[e["BIGWINNER"]=8]="BIGWINNER";e[e["MINI_GAME"]=9]="MINI_GAME";e[e["POPUP"]=10]="POPUP";e[e["WAITINGBOX"]=11]="WAITINGBOX";e[e["LOADING"]=12]="LOADING";e[e["LAMP_TIPS"]=13]="LAMP_TIPS";e[e["TIPS"]=14]="TIPS";e[e["TOP"]=15]="TOP";e[e["DEBUG"]=16]="DEBUG"})(c=r.UILevel||(r.UILevel={}));var e=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$makeProps=function(e){if(e.x===void 0&&e.left===void 0&&e.right===void 0){e.centerX=0}if(e.y===void 0&&e.top===void 0&&e.bottom===void 0){e.centerY=0}};t.prototype.$applyShowProps=function(e,t,r){if(t.x!==void 0){e.x=t.x}if(t.y!==void 0){e.y=t.y}if(t.centerX!==void 0){e.centerX=t.centerX}if(t.centerY!==void 0){e.centerY=t.centerY}if(r===0||t.flags&u.SIMPLY){if(t.left!==void 0){e.left=t.left}if(t.right!==void 0){e.right=t.right}if(t.top!==void 0){e.top=t.top}if(t.bottom!==void 0){e.bottom=t.bottom}if(t.scaleX!==void 0){e.scaleX=t.scaleX}if(t.scaleY!==void 0){e.scaleY=t.scaleY}}else{if(t.left!==void 0){e.left=-e.width}if(t.right!==void 0){e.right=-e.width}if(t.top!==void 0){e.top=-e.height}if(t.bottom!==void 0){e.bottom=-e.height}if(t.left===void 0&&t.right===void 0&&t.top===void 0&&t.bottom===void 0){e.alpha=0;e.scaleX=0;e.scaleY=0;t.alpha=1;if(t.scaleX===void 0){t.scaleX=1}if(t.scaleY===void 0){t.scaleY=1}}S.get(e,t.mod).to(t,r,t.ease)}};t.prototype.$applyCloseProps=function(e,t,r){if(r>0&&(t.flags&u.SIMPLY)===u.NONE){if(t.left!==void 0){t.left=-e.width}if(t.right!==void 0){t.right=-e.width}if(t.top!==void 0){t.top=-e.height}if(t.bottom!==void 0){t.bottom=-e.height}if(t.left===void 0&&t.right===void 0&&t.top===void 0&&t.bottom===void 0){t.alpha=0;t.scaleX=0;t.scaleY=0}S.get(e,t.mod).to(t,r)}};return t}(puremvc.SimpleCommand);r.AbstractPopupCommand=e;var n=function(n){__extends(e,n);function e(e,t){var r=n.call(this)||this;r.$info=null;r.$info=e;r.$data=t;return r}return e}(suncore.AbstractTask);r.AbstractSceneTask=n;var o=function(n){__extends(e,n);function e(e,t){var r=n.call(this)||this;r.$loading=false;r.$complete=null;r.$url=null;r.$loaders=[];r.$doneCount=0;r.$url=e;r.$complete=t;x.lock(r.$url);return r}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);for(var e=0;e<this.$loaders.length;e++){this.$loaders[e].destroy()}x.unlock(this.$url)};e.prototype.load=function(){if(this.$loading===false&&this.$destroyed===false){this.$loading=true;this.$doLoad()}};e.prototype.$loadAssets=function(e){this.$doneCount=this.$loaders.length;for(var t=0;t<e.length;t++){this.$loaders.push(new R(e[t],suncom.Handler.create(this,this.$onLoadAsset)))}};e.prototype.$onLoadAsset=function(e){if(e===false){this.$onAssetsLoaded(false)}else{this.$doneCount++;if(this.$doneCount===this.$loaders.length){this.$onAssetsLoaded(true)}}};e.prototype.$onComplete=function(e){if(this.$destroyed===false){this.$complete.runWith(e)}this.destroy();this.$loading=false};return e}(puremvc.Notifier);r.AssetLoader=o;var f=function(n){__extends(e,n);function e(e,t){var r=n.call(this)||this;r.$url=null;r.$complete=null;r.$loader=null;r.$retryer=new m(l.TERMINATE,suncom.Handler.create(r,r.$onRetryConfirmed),"资源加载失败，点击确定重新尝试！");x.lock(e);r.$url=e;r.$complete=t;r.$doLoad();return r}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);this.$retryer.cancel();this.$loader!==null&&this.$loader.destroy();x.unlock(this.$url)};e.prototype.$doLoad=function(){var e=suncom.Handler.create(this,this.$onLoad);if(x.isRes3dUrl(this.$url)===true){this.$loader=new p(this.$url,e)}else if(suncom.Common.getFileExtension(this.$url)==="sk"){this.$loader=new $(this.$url,e)}else{this.$loader=new L(this.$url,e)}this.$loader.load()};e.prototype.$onLoad=function(e){if(e===true){this.$complete.runWith(this.$url)}else{this.$retryer.run(1e3,suncom.Handler.create(this,this.$doLoad),2)}this.$loader=null};e.prototype.$onRetryConfirmed=function(e){if(e===i.NO){this.$retryer.reset();suncom.Logger.warn(suncom.DebugMode.ANY,"失败："+this.$url);this.facade.sendNotification(B.ON_ASSET_SAFETY_LOADER_FAILED);this.facade.registerObserver(B.ASSET_SAFETY_LOADER_RETRY,this.$onAssetSafetyLoaderRetry,this,true)}else{this.facade.sendNotification(suncore.NotifyKey.SHUTDOWN)}};e.prototype.$onAssetSafetyLoaderRetry=function(){if(this.$destroyed===false){suncom.Logger.warn(suncom.DebugMode.ANY,"重试："+this.$url);this.$doLoad()}};Object.defineProperty(e.prototype,"complete",{get:function(){return this.$complete},enumerable:false,configurable:true});return e}(puremvc.Notifier);r.AssetSafetyLoader=f;var s=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,r){var n=U.viewLayer.getInfoByView(e);if(n===null){suncom.Logger.error(suncom.DebugMode.ANY,e+"["+(e&&e.name)+"]'s infomation is not exist.");return}if(r!==void 0){n.keepNode=!r}if(n.closed===true){return}n.closed=true;U.viewLayer.onViewClose(e);this.facade.sendNotification(B.ON_POPUP_CLOSED,e);if((n.props.flags&u.TRANSPARENT)===u.NONE){var i=S.get(n.mask,n.props.mod);if(t>200&&(n.props.flags&u.SYNC_FADE_TIME)===u.NONE){i.wait(t-200).to({alpha:0},200)}else{i.to({alpha:0},t)}}this.$applyCloseProps(e,n.props,t);suncore.System.addTrigger(n.props.mod,t,this,this.$onCloseFinish,[e])};t.prototype.$onCloseFinish=function(e){U.viewLayer.removeStackInfoByView(e)};return t}(e);r.ClosePopupCommand=s;var a=function(n){__extends(e,n);function e(e,t){var r=n.call(this)||this;r.$var_relieved=false;r.$var_command=e;r.$var_condition=t;r.facade.registerObserver(e,r.$func_onCommandCallback,r,false,suncom.EventPriorityEnum.HIGHEST);return r}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);this.facade.removeObserver(this.$var_command,this.$func_onCommandCallback,this)};Object.defineProperty(e.prototype,"var_command",{get:function(){return this.$var_command},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"var_relieved",{get:function(){return this.$var_relieved},enumerable:false,configurable:true});return e}(puremvc.Notifier);r.GUILogicInterceptor=a;var d=function(r){__extends(e,r);function e(e){if(e===void 0){e=true}var t=r.call(this)||this;t.$var_hashId=suncom.Common.createHashId();t.$var_timerId=0;t.$var_commands=[];t.$var_autoDestroy=false;t.$var_autoDestroy=e;t.facade.registerObserver(B.NEXT_LOGIC_COMMAND,t.$func_onNextLogicCommand,t);t.facade.registerObserver(B.DESTROY_LOGIC_RUNNABLE,t.$func_onDestroyLogicRunnable,t);t.facade.registerObserver(B.DESTROY_ALL_LOGIC_RUNNABLE,t.$func_onDestroyAllLogicRunnable,t);return t}e.prototype.destroy=function(){if(this.$destroyed===true){return}r.prototype.destroy.call(this);this.facade.removeObserver(B.NEXT_LOGIC_COMMAND,this.$func_onNextLogicCommand,this);this.facade.removeObserver(B.DESTROY_LOGIC_RUNNABLE,this.$func_onDestroyLogicRunnable,this);this.facade.removeObserver(B.DESTROY_ALL_LOGIC_RUNNABLE,this.$func_onDestroyAllLogicRunnable,this);for(var e=0;e<this.$var_commands.length;e++){this.$var_commands[e].destroy()}};e.prototype.$func_onDestroyAllLogicRunnable=function(){this.destroy()};e.prototype.$func_onDestroyLogicRunnable=function(e){if(this.$var_autoDestroy===false&&this.$var_hashId===e){this.destroy()}};e.prototype.$func_onNextLogicCommand=function(e){var t=-1;for(var r=0;r<this.$var_commands.length;r++){if(this.$var_commands[r]===e){t=r;break}}if(t===-1){return}t++;this.facade.notifyCancel();if(t<this.$var_commands.length){var n=this.$var_commands[t];if(n.running===false){n.run()}}else if(this.$var_autoDestroy===true){this.destroy()}};e.prototype.$addCommand=function(e,t,r){this.$var_commands.push(new k(e,t,r));if(this.$var_commands[0].running===false){this.$var_commands[0].run()}};Object.defineProperty(e.prototype,"hashId",{get:function(){return this.$var_hashId},enumerable:false,configurable:true});return e}(puremvc.Notifier);r.GUILogicRunnable=d;var h=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){for(var t=0;t<e.length;t++){var r=e[t];K.regScene(r)}};return t}(puremvc.SimpleCommand);r.RegisterScenesCommand=h;var p=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){var e=x.getRes3dJsonUrl(this.$url);var t=Laya.loader.getRes(this.$url)===void 0?false:true;if(suncom.Common.getFileExtension(this.$url)==="ls"||t===true){this.$loadAssets([e])}else{this.$loaders.push(new R(e,suncom.Handler.create(this,this.$onUrlLoaded)))}};t.prototype.$onUrlLoaded=function(e,t){if(e===true){var r=U.cacheMap[this.$url]||null;if(r===null){this.$loadAssets([this.$url])}else{this.$onAssetsLoaded(true)}}else{this.$onComplete(false)}};t.prototype.$onAssetsLoaded=function(e){if(suncom.Common.getFileExtension(this.$url)==="ls"){this.$onComplete(e)}else{var t=U.cacheMap[this.$url]||null;if(t===null){t=U.cacheMap[this.$url]=Laya.loader.getRes(this.$url)}this.$onComplete(e)}};return t}(o);r.Res3dLoader=p;var v=function(t){__extends(n,t);function n(){var e=t!==null&&t.apply(this,arguments)||this;e.$undoList=[];e.$loadingList=[];e.$isRetryPrompting=false;return e}n.prototype.$onRun=function(){this.facade.registerObserver(B.ON_URL_SAFETY_LOADER_CREATED,this.$onUrlSafetyLoaderCreated,this);this.facade.registerObserver(B.ON_URL_SAFETY_LOADER_COMPLETE,this.$onUrlSafetyLoaderComplete,this);this.facade.registerObserver(B.ON_ASSET_SAFETY_LOADER_FAILED,this.$onAssetSafetyLoaderFailed,this)};n.prototype.$onStop=function(){this.facade.removeObserver(B.ON_URL_SAFETY_LOADER_CREATED,this.$onUrlSafetyLoaderCreated,this);this.facade.removeObserver(B.ON_URL_SAFETY_LOADER_COMPLETE,this.$onUrlSafetyLoaderComplete,this);this.facade.removeObserver(B.ON_ASSET_SAFETY_LOADER_FAILED,this.$onAssetSafetyLoaderFailed,this)};n.prototype.$onUrlSafetyLoaderCreated=function(e){this.$undoList.unshift(e);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"create loader for url "+e.url+", loading list length:"+this.$loadingList.length+", undo list length:"+this.$undoList.length)}this.$next()};n.prototype.$onUrlSafetyLoaderComplete=function(e){var t=this.$loadingList.indexOf(e);suncom.Test.expect(t).toBeGreaterOrEqualThan(0);this.$loadingList.splice(t,1);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"remove loader for url "+e.url+", loading list length:"+this.$loadingList.length+", undo list length:"+this.$undoList.length)}this.$next()};n.prototype.$next=function(){while(this.$undoList.length>0&&this.$loadingList.length<n.MAX_LOAD_COUNT){var e=false;for(var t=this.$undoList.length-1;t>-1;t--){var r=this.$undoList[t];if(r.destroyed===true){this.$undoList.splice(t,1);continue}if(this.$isUrlInLoading(r.url)===true){continue}if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"load next url "+r.url+", loading list length:"+this.$loadingList.length+" + 1")}e=true;r.load();this.$loadingList.push(r);break}if(e===false){break}}};n.prototype.$isUrlInLoading=function(e){for(var t=0;t<this.$loadingList.length;t++){var r=this.$loadingList[t];if(r.url===e){return true}}return false};n.prototype.$onAssetSafetyLoaderFailed=function(){if(this.$isRetryPrompting===false){this.$isRetryPrompting=true;this.facade.sendNotification(B.RETRY_CONFIRM,[suncore.ModuleEnum.SYSTEM,"资源加载失败，点击确定重新尝试！",[i.YES,"确定",i.NO,"取消"],suncom.Handler.create(this,this.$onRetryConfirmed)])}};n.prototype.$onRetryConfirmed=function(e){if(e===i.YES){this.facade.sendNotification(B.ASSET_SAFETY_LOADER_RETRY)}else{this.facade.sendNotification(suncore.NotifyKey.SHUTDOWN)}this.$isRetryPrompting=false};n.MAX_LOAD_COUNT=5;return n}(suncore.BaseService);r.ResourceService=v;var m=function(a){__extends(e,a);function e(e,t,r){if(t===void 0){t=null}if(r===void 0){r=null}var n=[];for(var i=3;i<arguments.length;i++){n[i-3]=arguments[i]}var o=a.call(this,suncore.MsgQModEnum.MMI)||this;o.$var_options=[];o.$var_currentRetries=0;o.$var_retryHandler=null;o.$var_retryTimerId=0;o.$var_prompting=false;if((e&l.CONFIRM)===l.CONFIRM){o.$var_method=l.CONFIRM}else if((e&l.TERMINATE)===l.TERMINATE){o.$var_method=l.TERMINATE}else{o.$var_method=l.AUTO}var s=e&=15;if(e===suncore.ModuleEnum.CUSTOM||e===suncore.ModuleEnum.TIMELINE){o.$var_mod=e}else{o.$var_mod=suncore.ModuleEnum.SYSTEM}o.$var_prompt=r;o.$var_options=n;o.$var_confirmHandler=t;return o}e.prototype.run=function(e,t,r){if(r===void 0){r=2}if(this.$var_method===l.AUTO||this.$var_currentRetries<r){if(this.$var_retryTimerId===0){this.$var_retryHandler=t;this.$var_retryTimerId=suncore.System.addTimer(suncore.ModuleEnum.SYSTEM,e,this.$func_onRetryTimer,this)}else{suncom.Logger.warn(suncom.DebugMode.ANY,"己忽略的重试请求 method:"+suncom.Common.getMethodName(t.method,t.caller)+", caller:"+suncom.Common.getQualifiedClassName(t.caller))}}else{if(this.$var_prompting===false){this.$var_prompting=true;if(this.$var_method===l.TERMINATE){suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,this,this.$func_onConfirmReplied,[i.NO])}else{var n=suncom.Handler.create(this,this.$func_onConfirmReplied);this.facade.sendNotification(B.RETRY_CONFIRM,[this.$var_mod,this.$var_prompt,this.$var_options,n])}}else{suncom.Logger.warn(suncom.DebugMode.ANY,"己忽略的重试的询问请求 prompt:"+this.$var_prompt)}}};e.prototype.$func_onConfirmReplied=function(e){if(this.$var_prompting===true){this.$var_prompting=false;if(this.$var_confirmHandler!==null){this.$var_confirmHandler.runWith(e)}}};e.prototype.$func_onRetryTimer=function(){this.$var_retryTimerId=0;this.$var_currentRetries++;this.$var_retryHandler.run()};e.prototype.cancel=function(){this.$var_prompting=false;this.$var_retryTimerId=suncore.System.removeTimer(this.$var_retryTimerId)};e.prototype.reset=function(){this.$var_currentRetries=0};Object.defineProperty(e.prototype,"currentRetries",{get:function(){return this.$var_currentRetries},enumerable:false,configurable:true});return e}(puremvc.Notifier);r.Retryer=m;var E=function(n){__extends(e,n);function e(e,t){var r=n.call(this,e,t)||this;r.facade.registerObserver(B.ENTER_SCENE,r.$onEnterScene,r,true,suncom.EventPriorityEnum.EGL);return r}e.prototype.$onEnterScene=function(){};return e}(n);r.SceneIniClass=E;var _=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$ready=true;e.$sceneName=0;e.$scene2d=null;e.$scene3d=null;e.$data=null;e.facade.registerObserver(B.ENTER_SCENE,e.$onEnterScene,e,false,suncom.EventPriorityEnum.OSL);return e}e.prototype.$enterScene=function(e,t){var r=K.getConfigByName(e);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,this,this.$beforeLoadScene,[r,t]);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,this,this.$loadScene,[r])};e.prototype.$beforeLoadScene=function(e,t){this.$data=t;this.$sceneName=e.name;this.facade.sendNotification(B.BEFORE_LOAD_SCENE);e.iniCls&&suncore.System.addTask(suncore.ModuleEnum.SYSTEM,new e.iniCls(e,t))};e.prototype.$loadScene=function(e){this.facade.sendNotification(suncore.NotifyKey.START_TIMELINE,[suncore.ModuleEnum.CUSTOM,true]);e.scene3d=e.scene3d||null;this.facade.sendNotification(B.LOAD_SCENE,e)};e.prototype.$onEnterScene=function(e,t){this.$ready=true;this.$scene2d=e||null;this.$scene3d=t||null;this.facade.sendNotification(suncore.NotifyKey.START_TIMELINE,[suncore.ModuleEnum.CUSTOM,false])};e.prototype.$exitScene=function(){this.facade.sendNotification(B.EXIT_SCENE,this.$sceneName);this.facade.sendNotification(suncore.NotifyKey.PAUSE_TIMELINE,[suncore.ModuleEnum.CUSTOM,true]);var e=K.getConfigByName(this.$sceneName);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,this,this.$onLeaveScene,[e])};e.prototype.$onLeaveScene=function(e){e.uniCls&&suncore.System.addTask(suncore.ModuleEnum.SYSTEM,new e.uniCls(e,this.$data));this.facade.sendNotification(B.DESTROY_ALL_LOGIC_RUNNABLE);this.facade.sendNotification(B.LEAVE_SCENE);this.facade.sendNotification(B.UNLOAD_SCENE,[this.$scene2d,this.$scene3d]);e.scene2d!==null&&x.clearResByUrl(e.scene2d);suncore.System.addTask(suncore.ModuleEnum.SYSTEM,new suncore.SimpleTask(this,this.$onExitScene))};e.prototype.$onExitScene=function(){this.$sceneName=0};e.prototype.enterScene=function(e,t){if(this.$ready===false){return false}this.$ready=false;this.$sceneName!=0&&this.$exitScene();this.$enterScene(e,t);F.addHistory(e,t);return true};e.prototype.exitScene=function(){if(this.$ready===false){return}this.$ready=false;this.$sceneName!=0&&this.$exitScene();F.removeHistory(this.$sceneName);var e=F.getLastestSceneInfo();e!==null&&this.$enterScene(e.name,e.data)};e.prototype.replaceScene=function(e,t){var r=F.getLastestSceneInfo();if(this.enterScene(e,t)===true){r!==null&&F.removeHistory(r.name)}};e.prototype.deleteHistories=function(e){F.deleteHistories(e)};Object.defineProperty(e.prototype,"scene2d",{get:function(){return this.$scene2d},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"scene3d",{get:function(){return this.$scene3d},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"sceneName",{get:function(){return this.$ready===false?0:this.$sceneName},enumerable:false,configurable:true});return e}(puremvc.Notifier);r.SceneLayer=_;var g=function(n){__extends(e,n);function e(e,t){var r=n.call(this,e,t)||this;r.facade.registerObserver(B.LEAVE_SCENE,r.$onLeaveScene,r,true,suncom.EventPriorityEnum.EGL);return r}e.prototype.$onLeaveScene=function(){};return e}(n);r.SceneUniClass=g;var y=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,r){if(U.viewLayer.getInfoByView(e)!==null){suncom.Logger.error(suncom.DebugMode.ANY,e+"["+e.name+"] is already popup.");return}if(r.mod===void 0){r.mod=suncore.ModuleEnum.CUSTOM}if(r.ease===void 0){r.ease=Laya.Ease.backOut}if(r.flags===void 0){r.flags=u.NONE}if(r.keepNode===void 0){r.keepNode=false}var n=r.args;var i=r.level||e.zOrder||c.POPUP;var o=r.keepNode;delete r.args;delete r.level;delete r.keepNode;this.$makeProps(r);if(r.trans===true&&(r.flags&u.TRANSPARENT)===u.NONE){suncom.Logger.warn(suncom.DebugMode.ANY,"ViewFacade：props的trans属性己弃用，请使用flags代替！！！");r.flags|=u.TRANSPARENT}var s=U.viewLayer.createMask(e,r);s.name="Mask$"+e.name;s.zOrder=e.zOrder=i;var a={view:e,mask:s,props:r,closed:false,keepNode:o,displayed:false,duration:t,cancelAllowed:false};U.viewLayer.addToStack(a);U.viewLayer.addChild(s);U.viewLayer.addChild(e);suncom.Test.expect(e["pivot"]).anything();e["pivot"](e.width*.5,e.height*.5);U.viewLayer.onViewCreate(e,n);if((r.flags&u.TRANSPARENT)===u.NONE){if(r.flags&u.SYNC_FADE_TIME){S.get(s,a.props.mod).from({alpha:0},t)}else{S.get(s,a.props.mod).from({alpha:0},t>200?200:t)}}this.$applyShowProps(e,r,t);suncore.System.addTrigger(a.props.mod,t,this,this.$onPopupFinish,[e])};t.prototype.$onPopupFinish=function(e){var t=U.viewLayer.getInfoByView(e);if(t!==null&&t.closed===false){t.displayed=true;U.viewLayer.onViewOpen(e)}};return t}(e);r.ShowPopupCommand=y;var $=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){this.$loadAssets([this.$url,suncom.Common.replacePathExtension(this.$url,"png")])};t.prototype.$onAssetsLoaded=function(e){if(e===true){var t=U.cacheMap[this.$url]||null;if(t===null){t=U.cacheMap[this.$url]=new Laya.Templet;t.loadAni(this.$url)}suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,this,this.$onTempletCreated);x.lock(this.$url)}else{this.$onComplete(false)}};t.prototype.$onTempletCreated=function(){if(this.destroyed===false){var e=U.cacheMap[this.$url];this.$onComplete(true)}x.unlock(this.$url)};return t}(o);r.SkeletonLoader=$;var T=function(a){__extends(e,a);function e(e,t,r){var n=a.call(this)||this;n.$id=0;n.$handler=null;n.$doneList=[];n.$loaders=[];n.$id=e;n.$handler=r;t=x.checkLoadList(t);suncom.Test.expect(t.length).toBeGreaterThan(0);while(t.length>0){var i=t.shift();var o=suncom.Handler.create(n,n.$onResourceCreated);var s=new f(i,o);n.$loaders.push(s)}return n}e.prototype.destroy=function(){if(this.$destroyed===true){return}a.prototype.destroy.call(this);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,this,this.$releaseAllResources)};e.prototype.$onResourceCreated=function(e){this.$doneList.push(e);if(this.$doneList.length<this.$loaders.length){return}if(this.$destroyed===true){return}this.$handler.runWith([this.$id])};e.prototype.$releaseAllResources=function(){for(var e=0;e<this.$loaders.length;e++){this.$loaders[e].destroy()}};return e}(puremvc.Notifier);r.Templet=T;var S=function(t){__extends(n,t);function n(){var e=t!==null&&t.apply(this,arguments)||this;e.$var_hashId=0;e.$var_mod=suncore.ModuleEnum.SYSTEM;e.$var_target=null;e.$var_props=null;e.$var_actions=[];e.$var_usePool=false;return e}n.prototype.$func_setTo=function(e,t){if(this.$var_hashId===-1){throw Error("Tween己被回收！！！")}this.$var_mod=t;this.$var_target=e;this.$var_hashId=suncom.Common.createHashId();if(suncore.System.isModuleStopped(t)===false){this.facade.sendNotification(B.REGISTER_TWEEN_OBJECT,this)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加缓动，但时间轴己停止，mod:"+suncore.ModuleEnum[t])}return this};n.prototype.cancel=function(){this.$var_props=null;while(this.$var_actions.length>0){this.$var_actions.pop().recover()}return this};n.prototype.recover=function(){if(suncom.Pool.recover("sunui.Tween",this.cancel())===true){this.$var_hashId=-1}};n.prototype.to=function(e,t,r,n){if(r===void 0){r=null}if(n===void 0){n=null}var i=Object.keys(e);var o=this.$var_props===null?this.$var_target:this.$var_props;this.$func_createTweenInfo(i,o,e,t,r,e.update||null,n);return this};n.prototype.from=function(e,t,r,n){if(r===void 0){r=null}if(n===void 0){n=null}var i=Object.keys(e);var o=this.$var_props===null?this.$var_target:this.$var_props;this.$func_createTweenInfo(i,e,o,t,r,e.update||null,n);return this};n.prototype.by=function(e,t,r,n){if(r===void 0){r=null}if(n===void 0){n=null}var i=Object.keys(e);var o=this.$var_props===null?this.$var_target:this.$var_props;for(var s=0;s<i.length;s++){var a=i[s];if(this.$var_props===null||this.$var_props[a]===void 0){e[a]+=this.$var_target[a]}else{e[a]+=o[a]}}this.to(e,t,r,n);return this};n.prototype.$func_createTweenInfo=function(e,t,r,n,i,o,s){this.$var_props=this.$var_props||{};var a=N.create();a.ease=i;a.update=o;a.complete=s;a.time=suncore.System.getModuleTimestamp(this.$var_mod);a.duration=n;this.$func_addAction(a);for(var u=0;u<e.length;u++){var l=e[u];if(l==="update"){continue}var c=M.create();c.to=r[l];c.from=t[l];c.prop=l;if(c.from===void 0){c.from=this.$var_target[l]}this.$var_props[l]=r[l];if(this.$var_actions.length===0){this.$var_target[c.prop]=c.from}a.clips.push(c)}};n.prototype.$func_addAction=function(e){if(this.$var_hashId===-1){throw Error("Tween己被回收！！！")}this.$var_actions.push(e)};n.prototype.wait=function(e,t){if(t===void 0){t=null}var r=N.create();r.complete=t;r.time=suncore.System.getModuleTimestamp(this.$var_mod);r.duration=e;this.$func_addAction(r);return this};n.prototype.func_doAction=function(){var e=suncore.System.getModuleTimestamp(this.$var_mod);var t=this.$var_actions[0];if(this.$var_target.destroyed===true){this.cancel();return 0}var r=false;var n=0;var i=e-t.time;if(i>t.duration){r=true;n=i-t.duration;i=t.duration}var o=t.ease||this.$func_easeNone;for(var s=0;s<t.clips.length;s++){var a=t.clips[s];if(r===true){this.$var_target[a.prop]=a.to}else{this.$var_target[a.prop]=o(i,a.from,a.to-a.from,t.duration)}}if(t.update!==null){t.update.run()}if(r===false){return 0}this.$var_actions.shift().recover();if(this.$var_actions.length>0){this.$var_actions[0].time=suncore.System.getModuleTimestamp(this.$var_mod)}t.complete!==null&&t.complete.run();return n};n.prototype.$func_easeNone=function(e,t,r,n){var i=e/n;if(i>1){i=1}return i*r+t};n.prototype.usePool=function(e){this.$var_usePool=e;return this};n.prototype.func_getUsePool=function(){return this.$var_usePool};Object.defineProperty(n.prototype,"var_mod",{get:function(){return this.$var_mod},enumerable:false,configurable:true});Object.defineProperty(n.prototype,"var_canceled",{get:function(){return this.$var_actions.length===0},enumerable:false,configurable:true});n.get=function(e,t){if(t===void 0){t=suncore.ModuleEnum.CUSTOM}var r=new n;r.$var_hashId=0;return r.usePool(true).$func_setTo(e,t)};return n}(puremvc.Notifier);r.Tween=S;var N=function(){function e(){this.ease=null;this.clips=[];this.update=null;this.complete=null;this.time=0;this.duration=0}e.prototype.recover=function(){this.ease=null;while(this.clips.length>0){this.clips.pop().recover()}this.update=null;this.complete=null;this.time=0;this.duration=0;suncom.Pool.recover("sunui.TweenAction",this)};e.create=function(){return suncom.Pool.getItemByClass("sunui.TweenAction",e)};return e}();r.TweenAction=N;var M=function(){function e(){this.prop=null;this.from=0;this.to=0}e.prototype.recover=function(){this.prop=null;this.from=0;this.to=0;suncom.Pool.recover("sunui.TweenActionClip",this)};e.create=function(){return suncom.Pool.getItemByClass("sunui.TweenActionClip",e)};return e}();r.TweenActionClip=M;var O=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$locker=false;e.$tweens=[];return e}e.prototype.$onRun=function(){this.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this,false,suncom.EventPriorityEnum.EGL);this.facade.registerObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onTimelinePause,this,false,suncom.EventPriorityEnum.EGL);this.facade.registerObserver(B.REGISTER_TWEEN_OBJECT,this.$onRegisterTweenObject,this)};e.prototype.$onStop=function(){this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this);this.facade.removeObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onTimelinePause,this);this.facade.removeObserver(B.REGISTER_TWEEN_OBJECT,this.$onRegisterTweenObject,this)};e.prototype.$onEnterFrame=function(){this.$locker=true;var e=this.$tweens;for(var t=0;t<suncore.ModuleEnum.MAX;t++){if(suncore.System.isModulePaused(t)===false){for(var r=0;r<e.length;r++){var n=e.length[r];if(n.var_mod===t){var i=1;while(i>0&&n.var_canceled===false){i=n.func_doAction()}}}}}for(var r=this.$tweens.length-1;r>-1;r--){var n=this.$tweens[r];if(n.var_canceled===true&&n.func_getUsePool()===true){suncom.Pool.recover("sunui.Tweeen",e.splice(r,1)[0])}}this.$locker=false};e.prototype.$onTimelinePause=function(e,t){if(t===true){for(var r=0;r<this.$tweens.length;r++){var n=this.$tweens[r];if(n.var_mod===e){n.cancel()}}}};e.prototype.$onRegisterTweenObject=function(e){if(this.$locker===true){this.$tweens=this.$tweens.slice(0);this.$locker=false}this.$tweens.push(e)};return e}(suncore.BaseService);r.TweenService=O;var I=function(t){__extends(e,t);function e(){var e=t.call(this)||this;U.sceneLayer=new _;if(Laya.Scene3D===void 0){U.viewLayer=new w}else{U.viewLayer=new Y}suncom.DBService.put(-1,new O).run();suncom.DBService.put(-1,new v).run();e.facade.registerCommand(B.SHOW_POPUP,y,suncom.EventPriorityEnum.OSL);e.facade.registerCommand(B.CLOSE_POPUP,s,suncom.EventPriorityEnum.OSL);return e}e.getInstance=function(){if(e.$inst===null){e.$inst=new e}return e.$inst};e.prototype.enterScene=function(e,t){puremvc.MutexLocker.backup(this);U.sceneLayer.enterScene(e,t);puremvc.MutexLocker.restore()};e.prototype.exitScene=function(){puremvc.MutexLocker.backup(this);U.sceneLayer.exitScene();puremvc.MutexLocker.restore()};e.prototype.replaceScene=function(e,t){puremvc.MutexLocker.backup(this);U.sceneLayer.replaceScene(e,t);puremvc.MutexLocker.restore()};e.prototype.deleteHistories=function(e){U.sceneLayer.deleteHistories(e)};e.prototype.removeView=function(e){U.viewLayer.removeStackInfoByView(e)};Object.defineProperty(e.prototype,"scene2d",{get:function(){return U.sceneLayer.scene2d},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"scene3d",{get:function(){return U.sceneLayer.scene3d},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"sceneName",{get:function(){return U.sceneLayer.sceneName},enumerable:false,configurable:true});e.$inst=null;return e}(puremvc.Notifier);r.UIManager=I;var C=function(n){__extends(e,n);function e(e,t){var r=n.call(this)||this;r.$url=null;r.$data=null;r.$handler=null;r.$totalSize=0;r.$currentSize=0;r.$priority=0;r.$url=e;r.$handler=t;r.$priority=suncom.Mathf.random(0,6);if(Laya.loader.getRes(e)!==void 0){r.$totalSize=-1}U.downloadLimiters.push(r);return r}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);var e=U.downloadLimiters.indexOf(this);if(e<0){throw Error("加载限制器不存在：index:"+e)}U.downloadLimiters.splice(e,1);this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)};e.prototype.updateDownloadSize=function(e){if(e===null||this.$totalSize===-1){this.$totalSize=1}else if(suncom.Common.getFileExtension(this.$url)==="atlas"){var t=Laya.loader.getRes(suncom.Common.replacePathExtension(this.$url,"png"))||null;var r=(t===null?0:t["gpuMemory"])||1;this.$totalSize=r+this.$getStringSize(Laya.loader.getRes(this.$url)||null)}else if(suncom.Common.getFileExtension(this.$url)==="png"||suncom.Common.getFileExtension(this.$url)==="jpg"){var t=Laya.loader.getRes(suncom.Common.replacePathExtension(this.$url,"png"))||null;this.$totalSize=(t===null?0:t.bitmap["gpuMemory"])||1}else if(suncom.Common.getFileExtension(this.$url)==="json"){this.$totalSize=this.$getStringSize(Laya.loader.getRes(this.$url)||null)}else if(suncom.Common.getFileExtension(this.$url)==="sk"){var n=e;this.$totalSize=n.byteLength}else if(suncom.Common.getFileExtension(this.$url)==="lh"){var i=Laya.loader.getRes(suncom.Common.replacePathExtension(this.$url,"json"));var o=x.getAssetUrlsByRes3dJson(i);for(var s=0;s<o.length;s++){var a=o[s];var u=Laya.loader.getRes(a)||null;if(u["gpuMemory"]>0){this.$totalSize+=u["gpuMemory"]}else{try{this.$totalSize+=this.$getStringSize(u)}catch(e){this.$totalSize+=1}}}}else{this.$totalSize=1}this.$data=e;this.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)};e.prototype.$onEnterFrame=function(){this.$currentSize+=this.$getDowloadSpeed()*(10-this.$priority)/10;if(this.$totalSize>0&&this.$currentSize>this.$totalSize){suncom.Logger.log(suncom.DebugMode.DEBUG,"[100%] "+this.$url+":{"+this.$currentSize+":"+this.$totalSize+"}");this.$handler.runWith(this.$data);this.destroy()}else{if(this.$totalSize>0){suncom.Logger.log(suncom.DebugMode.DEBUG,"["+Math.floor(this.$currentSize/this.$totalSize*100)+"%] "+this.$url+":{"+this.$currentSize+":"+this.$totalSize+"}")}else{suncom.Logger.log(suncom.DebugMode.DEBUG,"[0%] "+this.$url+":{"+this.$currentSize+":"+this.$totalSize+"}")}}};e.prototype.$getDowloadSpeed=function(){if(U.downloadLimiters.length<=1){return U.downloadSpeed}else{return U.downloadSpeed/U.downloadLimiters.length}};e.prototype.$getStringSize=function(e){var t=null;var r=0;if(e===null){return 1}if(typeof e==="number"||typeof e==="string"){t=e.toString()}else{t=JSON.stringify(e)}for(var n=0;n<t.length;n++){if(t.charCodeAt(n)<=255){r++}else{r+=2}}return r};return e}(puremvc.Notifier);r.UrlDownloadLimiter=C;var L=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){this.$loadAssets([this.$url])};t.prototype.$onAssetsLoaded=function(e){this.$onComplete(e)};return t}(o);r.UrlLoader=L;var R=function(n){__extends(e,n);function e(e,t){var r=n.call(this)||this;r.$url=null;r.$limiter=null;r.$complete=null;r.$loading=false;r.$url=e;r.$complete=t;r.facade.sendNotification(B.ON_URL_SAFETY_LOADER_CREATED,r);return r}e.prototype.load=function(){if(this.$loading===false&&this.$destroyed===false){this.$loading=true;W.lock(this.$url);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"load "+this.$url)}if(x.isRes3dUrl(this.$url)===false||x.getRes3dJsonUrl(this.$url)===this.$url){Laya.loader.load(this.$url,Laya.Handler.create(this,this.$onComplete))}else{Laya.loader.create(this.$url,Laya.Handler.create(this,this.$onComplete))}if(U.downloadSpeed!==t.NONE){this.$limiter=new C(this.$url,suncom.Handler.create(this,this.$onDownloaded))}}};e.prototype.$onComplete=function(e){if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"load "+this.$url+" complete")}if(this.$limiter===null){if(this.$destroyed===false){this.$destroyed=true;this.$complete.runWith([e===null?false:true,this.$url])}this.facade.sendNotification(B.ON_URL_SAFETY_LOADER_COMPLETE,this);W.unlock(this.$url);this.$loading=false}else{this.$limiter.updateDownloadSize(e)}};e.prototype.$onDownloaded=function(e){this.$limiter=null;this.$onComplete(e)};Object.defineProperty(e.prototype,"url",{get:function(){return this.$url},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"destroyed",{get:function(){return this.$destroyed},enumerable:false,configurable:true});return e}(puremvc.Notifier);r.UrlSafetyLoader=R;var A=function(n){__extends(e,n);function e(e,t){var r=n.call(this)||this;r.$var_closedHandler=null;r.$var_removedHandler=null;r.$var_popup=e||null;r.$var_caller=t||null;if(U.viewLayer.getInfoByView(e)===null){throw Error("找不到"+e.name+"的弹出信息，请确认其为弹出对象")}r.facade.registerObserver(B.ON_POPUP_CLOSED,r.$func_onPopupClosed,r,false,suncom.EventPriorityEnum.FWL);r.facade.registerObserver(B.ON_POPUP_REMOVED,r.$func_onPopupRemoved,r,false,suncom.EventPriorityEnum.FWL);if(U.viewLayer.getInfoByView(t)!==null){r.facade.registerObserver(B.ON_POPUP_REMOVED,r.$func_onCallerDestroy,r,false,suncom.EventPriorityEnum.FWL)}else{r.facade.registerObserver(B.ON_CALLER_DESTROYED,r.$func_onCallerDestroy,r,false,suncom.EventPriorityEnum.FWL)}r.facade.registerObserver(B.LEAVE_SCENE,r.$func_onLeaveScene,r,false,suncom.EventPriorityEnum.OSL);return r}e.prototype.$func_onLeaveScene=function(){this.facade.removeObserver(B.ON_POPUP_CLOSED,this.$func_onPopupClosed,this);this.facade.removeObserver(B.ON_POPUP_REMOVED,this.$func_onPopupRemoved,this);this.facade.removeObserver(B.LEAVE_SCENE,this.$func_onLeaveScene,this);this.facade.removeObserver(B.ON_POPUP_REMOVED,this.$func_onCallerDestroy,this);this.facade.removeObserver(B.ON_CALLER_DESTROYED,this.$func_onCallerDestroy,this)};e.prototype.$func_onCallerDestroy=function(e){if(e===this.$var_caller){this.$func_onLeaveScene()}};e.prototype.$func_onPopupClosed=function(e){if(e===this.$var_popup){if(this.$var_closedHandler!==null){this.$var_closedHandler.run();this.$var_closedHandler=null}}};e.prototype.$func_onPopupRemoved=function(e){if(e===this.$var_popup){if(this.$var_removedHandler!==null){this.$var_removedHandler.run();this.$var_removedHandler=null}this.$func_onCallerDestroy(this.$var_caller)}};e.prototype.onPopupClosed=function(e,t,r){if(this.$var_caller!==t){throw Error("caller与执行者不一致")}if(this.$var_closedHandler===null){this.$var_closedHandler=suncom.Handler.create(t,e,r)}else{throw Error("重复注册弹框关闭事件")}return this};e.prototype.onPopupRemoved=function(e,t,r){if(this.$var_caller!==t){throw Error("caller与执行者不一致")}if(this.$var_removedHandler===null){this.$var_removedHandler=suncom.Handler.create(t,e,r)}else{throw Error("重复注册弹框移除事件")}return this};return e}(puremvc.Notifier);r.ViewContact=A;var b=function(n){__extends(e,n);function e(e,t){var r=n.call(this)||this;r.$var_info=null;r.$var_view=e;if(r.var_info!==null){r.$var_duration=r.var_info.duration}else if(t===void 0){r.$var_duration=200}else{r.$var_duration=t}return r}e.prototype.popup=function(e){if(e===void 0){e={}}this.facade.sendNotification(B.SHOW_POPUP,[this.$var_view,this.$var_duration,e]);return this};e.prototype.close=function(e){this.facade.sendNotification(B.CLOSE_POPUP,[this.$var_view,this.$var_duration,e])};Object.defineProperty(e.prototype,"cancelAllowed",{get:function(){return this.var_info.cancelAllowed},set:function(e){this.var_info.cancelAllowed=e},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"var_info",{get:function(){if(this.$var_info===null){this.$var_info=U.viewLayer.getInfoByView(this.$var_view)}return this.$var_info},enumerable:false,configurable:true});return e}(puremvc.Notifier);r.ViewFacade=b;var P=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$stack=[];e.facade.registerObserver(B.UNLOAD_SCENE,e.$onUnloadScene,e,false,suncom.EventPriorityEnum.EGL);return e}e.prototype.$onUnloadScene=function(){var e=this.$stack.concat();for(var t=e.length-1;t>-1;t--){var r=e[t];if(r.props.mod!==suncore.ModuleEnum.SYSTEM){this.removeStackInfo(r)}}};e.prototype.getInfoByView=function(e){for(var t=0;t<this.$stack.length;t++){var r=this.$stack[t];if(r.view===e){return r}}return null};e.prototype.addToStack=function(e){this.$stack.push(e)};e.prototype.removeStackInfo=function(e){var t=this.$stack.indexOf(e);if(t<0){return}this.$stack.splice(t,1);this.onViewRemove(e.view);this.removeChild(e.view);this.removeChild(e.mask);if(e.keepNode===false){this.destroyView(e.view);this.destroyMask(e.mask)}this.facade.sendNotification(B.ON_POPUP_REMOVED,e.view)};e.prototype.removeStackInfoByView=function(e){for(var t=0;t<this.$stack.length;t++){var r=this.$stack[t];if(r.view===e){this.removeStackInfo(r);break}}};return e}(puremvc.Notifier);r.ViewLayer=P;var D=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.addChild=function(e){var t=e;if(U.sceneLayer.scene2d===null||e.zOrder>=r.UILevel.LOADING){Laya.stage.addChild(t)}else{U.sceneLayer.scene2d.addChild(t)}};t.prototype.removeChild=function(e){var t=e;var r=t.parent||null;if(r===null){throw Error("无法移除显示对象，因为父节点不存在 "+t.name)}r.removeChild(t)};t.prototype.createMask=function(e,t){var r=new Laya.Image("common/mask_b.png");r.left=r.right=r.top=r.bottom=0;r.sizeGrid="1,1,1,1";if(t.flags&u.TRANSPARENT){r.alpha=0}else{r.alpha=1}if((t.flags&u.MOUSE_THROUGH)===u.NONE){r.mouseThrough=false;r.on(Laya.Event.CLICK,this,this.$onMaskClick,[e])}return r};t.prototype.$onMaskClick=function(e){var t=U.viewLayer.getInfoByView(e);if(t!==null&&t.closed===false&&t.cancelAllowed===true){new b(e).close()}};t.prototype.destroyMask=function(e){e.off(Laya.Event.CLICK,this,this.$onMaskClick);e.destroy()};t.prototype.destroyView=function(e){var t=e;t.destroy()};return t}(P);r.ViewLayerLaya=D;var w=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onViewCreate=function(e,t){var r=e;if(r.$onCreate){if(t instanceof Array===false){r.$onCreate.call(r,t)}else{r.$onCreate.apply(r,t)}}};t.prototype.onViewOpen=function(e){var t=e;if(t.$onOpen){t.$onOpen.call(t)}};t.prototype.onViewClose=function(e){var t=e;if(t.$onClose){t.$onClose.call(t)}};t.prototype.onViewRemove=function(e){var t=e;if(t.$onRemove){t.$onRemove.call(t)}};return t}(D);r.ViewLayerLaya2D=w;var Y=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onViewCreate=function(e,t){var r=e.getComponents(Laya.Component)||[];for(var n=0;n<r.length;n++){var i=r[n];if(i.$onCreate){if(t instanceof Array===false){i.$onCreate.call(i,t)}else{i.$onCreate.apply(i,t)}}}};t.prototype.onViewOpen=function(e){var t=e.getComponents(Laya.Component)||[];for(var r=0;r<t.length;r++){var n=t[r];if(n.$onOpen){n.$onOpen.call(n)}}};t.prototype.onViewClose=function(e){var t=e.getComponents(Laya.Component)||[];for(var r=0;r<t.length;r++){var n=t[r];if(n.$onClose){n.$onClose.call(n)}}};t.prototype.onViewRemove=function(e){var t=e.getComponents(Laya.Component)||[];for(var r=0;r<t.length;r++){var n=t[r];if(n.$onRemove){n.$onRemove.call(n)}}};return t}(D);r.ViewLayerLaya3D=Y;var k=function(i){__extends(e,i);function e(e,t,r){var n=i.call(this,e,t)||this;n.$dataList=[];n.$running=false;n.$dependencies=r;suncom.Test.expect(r.length).toBeGreaterThan(0);n.facade.registerObserver(B.ON_INTERCEPTOR_RELIEVED,n.$onInterceptorRelieved,n);return n}e.prototype.destroy=function(){if(this.$destroyed===true){return}i.prototype.destroy.call(this);this.facade.removeObserver(B.ON_INTERCEPTOR_RELIEVED,this.$onInterceptorRelieved,this)};e.prototype.run=function(){suncom.Test.expect(this.$running).toBe(false);for(var e=0;e<this.$dependencies.length;e++){this.$dependencies[e].var_active=true}this.$running=true};e.prototype.$onInterceptorRelieved=function(e){if(this.$var_relieved===true){return}if(this.$dependencies.indexOf(e)<0){return}this.facade.notifyCancel();var t=true;for(var r=0;r<this.$dependencies.length;r++){if(this.$dependencies[r].var_relieved===false){t=false;break}}if(t===true){suncore.System.addMessage(suncore.ModuleEnum.TIMELINE,suncore.MessagePriorityEnum.PRIORITY_0,this,this.$onCommandRelieved)}};e.prototype.$onCommandRelieved=function(){if(this.$destroyed===false&&this.$var_relieved===false){this.$var_relieved=true;this.facade.sendNotification(B.NEXT_LOGIC_COMMAND,this,true);for(var e=0;e<this.$dataList.length;e++){this.facade.sendNotification(this.$var_command,this.$dataList[e])}}};e.prototype.$func_onCommandCallback=function(){if(this.$var_relieved===true){return}var e=[];for(var t=0;t<arguments.length;t++){e.push(arguments[t])}if(this.$var_condition.runWith(e)===false){return}this.$var_relieved=true;for(var t=0;t<this.$dependencies.length;t++){if(this.$dependencies[t].var_relieved===false){this.$var_relieved=false;break}}if(this.$var_relieved===false){this.$dataList.push(e);this.facade.notifyCancel()}};Object.defineProperty(e.prototype,"running",{get:function(){return this.$running},enumerable:false,configurable:true});return e}(a);r.GUILogicCommand=k;var G=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$var_active=false;return e}e.prototype.$func_onCommandCallback=function(){if(this.$var_active===true&&this.$var_relieved===false){var e=[];for(var t=0;t<arguments.length;t++){e.push(arguments[t])}if(this.$var_condition.runWith(e)===true){this.$var_relieved=true;this.facade.sendNotification(B.ON_INTERCEPTOR_RELIEVED,this,true)}}};Object.defineProperty(e.prototype,"var_active",{get:function(){return this.$var_active},set:function(e){this.$var_active=e},enumerable:false,configurable:true});return e}(a);r.GUILogicDependence=G;var U;(function(e){e.downloadSpeed=t.NONE;e.cacheMap={};e.templets={};e.references={};e.downloadLimiters=[]})(U=r.M||(r.M={}));var B;(function(e){e.RETRY_CONFIRM="sunui.NotifyKey.RETRY_CONFIRM";e.REGISTER_SCENES="sunui.NotifyKey.REGISTER_SCENES";e.BEFORE_LOAD_SCENE="sunui.NotifyKey.BEFORE_LOAD_SCENE";e.LOAD_SCENE="sunui.NotifyKey.LOAD_SCENE";e.UNLOAD_SCENE="sunui.NotifyKey.UNLOAD_SCENE";e.ENTER_SCENE="sunui.NotifyKey.ENTER_SCENE";e.EXIT_SCENE="sunui.NotifyKey.EXIT_SCENE";e.LEAVE_SCENE="sunui.NotifyKey.LEAVE_SCENE";e.SHOW_POPUP="sunui.NotifyKey.SHOW_POPUP";e.CLOSE_POPUP="sunui.NotifyKey.CLOSE_POPUP";e.ON_POPUP_CLOSED="sunui.NotifyKey.ON_POPUP_CLOSED";e.ON_POPUP_REMOVED="sunui.NotifyKey.ON_POPUP_REMOVED";e.ON_CALLER_DESTROYED="sunui.NotifyKey.ON_CALLER_DESTROYED";e.ON_ASSET_SAFETY_LOADER_FAILED="sunui.NotifyKey.ON_ASSET_SAFETY_LOADER_FAILED";e.ON_URL_SAFETY_LOADER_CREATED="sunui.NotifyKey.ON_URL_SAFETY_LOADER_CREATED";e.ON_URL_SAFETY_LOADER_COMPLETE="sunui.NotifyKey.ON_URL_SAFETY_LOADER_COMPLETE";e.ASSET_SAFETY_LOADER_RETRY="sunui.NotifyKey.ASSET_SAFETY_LOADER_RETRY";e.REGISTER_TWEEN_OBJECT="sunui.NotifyKey.REGISTER_TWEEN_OBJECT";e.NEXT_LOGIC_COMMAND="sunui.NotifyKey.NEXT_LOGIC_COMMAND";e.ON_INTERCEPTOR_RELIEVED="sunui.NotifyKey.ON_INTERCEPTOR_RELIEVED";e.DESTROY_LOGIC_RUNNABLE="sunui.NotifyKey.DESTROY_LOGIC_RUNNABLE";e.DESTROY_ALL_LOGIC_RUNNABLE="sunui.NotifyKey.DESTROY_ALL_LOGIC_RUNNABLE"})(B=r.NotifyKey||(r.NotifyKey={}));var x;(function(o){o.res3dRoot=null;function e(e){U.downloadSpeed=e}o.setDownloadSpeed=e;function t(e){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){if(o.isRes3dUrl(e)===true&&o.getRes3dJsonUrl(e)===e){return}}var t=suncom.Common.getFileExtension(e);var r=e.substr(0,e.length-t.length);var n=[e];if(t==="sk"||t==="atlas"){n.push(r+"png")}else if(o.isRes3dUrl(e)===true){n.push(r+"json")}for(var i=0;i<n.length;i++){W.lock(n[i])}}o.lock=t;function r(e){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){if(o.isRes3dUrl(e)===true&&o.getRes3dJsonUrl(e)===e){return}}var t=suncom.Common.getFileExtension(e);var r=e.substr(0,e.length-t.length);var n=[e];if(t==="sk"||t==="atlas"){n.push(r+"png")}else if(o.isRes3dUrl(e)===true){n.push(r+"json")}for(var i=0;i<n.length;i++){W.unlock(n[i])}}o.unlock=r;function n(e,t,r){var n=null;if(t===null){n=suncom.Handler.create(null,function(e){})}else{n=suncom.Handler.create(r,t)}var i=suncom.Common.createHashId();U.templets[i]=new T(i,e,n);return i}o.prepare=n;function i(e){var t=U.templets[e]||null;if(t!==null){delete U.templets[e];t.destroy()}return 0}o.release=i;function s(e,t){var r=U.cacheMap[e]||null;if(suncom.Common.getFileExtension(e)==="sk"){return r.buildArmature(t)}else if(o.isRes3dUrl(e)===true){if(r===null){r=U.cacheMap[e]=Laya.loader.getRes(e)}return Laya.Sprite3D.instantiate(r)}else{return Laya.loader.getRes(e)}}o.createSync=s;function a(e){return o.createSync(o.getRes3dUrlByName(e))}o.createRes3dSync=a;function u(e){var t=new Laya.Prefab;t.json=Laya.loader.getRes(e);return t.create()}o.createPrefab=u;function l(e){W.clearResByUrl(e)}o.clearResByUrl=l;function c(e){if(o.res3dRoot===null){throw Error("请先指定3D资源目录：sunui.Resource.res3dRoot=")}return o.res3dRoot+"/LayaScene_"+e+"/Conventional/"}o.getRes3dPackRoot=c;function f(e){return e.indexOf(o.res3dRoot)===0}o.isRes3dUrl=f;function d(e){return suncom.Common.replacePathExtension(e,"json")}o.getRes3dJsonUrl=d;function h(e){if(suncom.Common.getFileExtension(e)===null){e+=".lh"}return o.getRes3dPackRoot(suncom.Common.getFileName(e))+e}o.getRes3dUrlByName=h;function p(e){var t=[];var r=o.getRes3dPackRoot(e.pack);for(var n=0;n<e.files.length;n++){t.push(r+e.files[n])}for(var n=0;n<e.resources.length;n++){t.push(r+e.resources[n])}return t}o.getAssetUrlsByRes3dJson=p;function v(e){o.removeUnnecessaryResources(e,"sk","png","龙骨预加载无需指定PNG资源");o.removeUnnecessaryResources(e,"atlas","png","图集预加载无需指定PNG资源");return o.removeDuplicateResources(e)}o.checkLoadList=v;function m(e){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){var t=[];for(var r=0;r<e.length;r++){var n=e[r];if(t.indexOf(n)===-1){t.push(n)}else{suncom.Logger.error(suncom.DebugMode.ANY,"重复的预加载资源文件 "+n)}}return t}return e}o.removeDuplicateResources=m;function E(e,t,r,n){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){var i=[];for(var o=0;o<e.length;o++){var s=e[o];if(suncom.Common.getFileExtension(s)===t){i.push(s)}}for(var o=0;o<i.length;o++){var s=i[o];var a=s.substring(0,s.length-t.length)+r;do{var u=e.indexOf(a);if(u===-1){break}e.splice(u,1);suncom.Logger.error(suncom.DebugMode.ANY,n+" "+s)}while(true)}}}o.removeUnnecessaryResources=E})(x=r.Resource||(r.Resource={}));var F;(function(e){var n=[];function r(e){for(var t=n.length-1;t>-1;t--){if(n[t].name===e){return t}}return-1}function t(e,t){var r={name:e,data:t};n.push(r)}e.addHistory=t;function i(e){var t=r(e);if(t>-1){n.splice(t,1)}return t>-1}e.removeHistory=i;function o(e){return r(e)>-1}e.hasHistory=o;function s(){if(n.length>0){return n[n.length-1]}return null}e.getLastestSceneInfo=s;function a(e){var t=r(e);if(t>-1){return n[t]}return null}e.getLastestSceneInfoByName=a;function u(e){while(n.length>1&&e>0){n.pop();e--}}e.deleteHistories=u})(F=r.SceneHeap||(r.SceneHeap={}));var K;(function(e){var n=[];function t(e){for(var t=0;t<n.length;t++){if(n[t].name===e.name){throw Error("重复注册场景")}}n.push(e)}e.regScene=t;function r(e){for(var t=0;t<n.length;t++){var r=n[t];if(r.name===e){return r}}throw Error("场景配置不存在")}e.getConfigByName=r})(K=r.SceneManager||(r.SceneManager={}));var W;(function(n){function e(e){var t=U.references[e]||0;if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"reference:"+t+", lock:"+e)}U.references[e]=t+1}n.lock=e;function t(e){var t=U.references[e]||0;if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"reference:"+t+", unlock:"+e)}suncom.Test.expect(t).interpret("尝试解锁不存在的资源 url："+e).toBeGreaterThan(0);if(t>1){U.references[e]=t-1}else{delete U.references[e];i(e)}}n.unlock=t;function r(e){if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"clearResUrl:"+e)}var t=U.cacheMap[e]||null;if(t!==null){t.dispose&&t.dispose();t.destroy&&t.destroy();delete U.cacheMap[e]}var r=Laya.loader.getRes(e)||null;if(r===null){Laya.loader.cancelLoadByUrl(e)}else{r.dispose&&r.dispose();r.destroy&&r.destroy();Laya.loader.clearRes(e)}var n=suncom.Common.getFileExtension(e);if(n==="ani"){Laya.Animation.clearCache(e)}else if(n==="sk"){Laya.Templet.TEMPLET_DICTIONARY[e]&&Laya.Templet.TEMPLET_DICTIONARY[e].destroy();delete Laya.Templet.TEMPLET_DICTIONARY[e]}}n.clearResByUrl=r;function i(e){if(x.isRes3dUrl(e)===true&&x.getRes3dJsonUrl(e)===e){var t=x.getAssetUrlsByRes3dJson(Laya.loader.getRes(e));for(var r=0;r<t.length;r++){n.clearResByUrl(t[r])}}n.clearResByUrl(e)}})(W=r.UrlLocker||(r.UrlLocker={}));function H(e,t){var r=e.split("/");while(t!=null&&r.length>0){var n=r.shift();t=t.getChildByName(n)}return t}r.find=H})(sunui||(sunui={}));