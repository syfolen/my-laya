var __extends=this&&this.__extends||function(){var r=function(e,t){r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return r(e,t)};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();var suncom;(function(u){var L;(function(e){e[e["ANY"]=1]="ANY";e[e["ENGINE"]=2]="ENGINE";e[e["NATIVE"]=4]="NATIVE";e[e["NETWORK"]=8]="NETWORK";e[e["NETWORK_HEARTBEAT"]=16]="NETWORK_HEARTBEAT";e[e["DEBUG"]=32]="DEBUG";e[e["ENGINEER"]=64]="ENGINEER";e[e["NORMAL"]=128]="NORMAL";e[e["TEST"]=256]="TEST";e[e["TDD"]=512]="TDD";e[e["ATDD"]=1024]="ATDD"})(L=u.DebugMode||(u.DebugMode={}));var e;(function(e){e[e["DEVELOP"]=0]="DEVELOP";e[e["DEBUG"]=1]="DEBUG";e[e["WEB"]=2]="WEB"})(e=u.EnvMode||(u.EnvMode={}));var c;(function(e){e[e["LOWEST"]=0]="LOWEST";e[e["LOW"]=1]="LOW";e[e["MID"]=2]="MID";e[e["HIGH"]=3]="HIGH";e[e["HIGHEST"]=4]="HIGHEST";e[e["FWL"]=5]="FWL";e[e["EGL"]=6]="EGL";e[e["OSL"]=7]="OSL"})(c=u.EventPriorityEnum||(u.EventPriorityEnum={}));var t=function(){function e(){this.$events={};this.$onceList=[];this.$isCanceled=false}e.prototype.dispatchCancel=function(){this.$isCanceled=true};e.prototype.dispatchEvent=function(e,t,n){if(n===void 0){n=false}if(f.isStringInvalidOrEmpty(e)===true){throw Error("派发无效事件！！！")}var r=this.$events[e]||null;if(r===null){return}r[0]=true;var o=this.$isCanceled;this.$isCanceled=false;for(var i=1;i<r.length;i++){var s=r[i];if(s.receiveOnce===true){this.$onceList.push(s)}if(t===void 0){s.method.call(s.caller)}else if(t instanceof Array){s.method.apply(s.caller,t)}else{s.method.call(s.caller,t)}if(this.$isCanceled){if(n===true){break}u.Test.notExpected("尝试取消不可被取消的事件："+name)}}this.$isCanceled=o;r[0]=false;while(this.$onceList.length>0){var a=this.$onceList.pop();this.removeEventListener(a.type,a.method,a.caller)}};e.prototype.addEventListener=function(e,t,n,r,o){if(r===void 0){r=false}if(o===void 0){o=c.MID}if(f.isStringInvalidOrEmpty(e)===true){throw Error("注册无效事件！！！")}if(t===void 0||t===null){throw Error("注册无效的事件回调！！！")}var i=this.$events[e]||null;if(i===null){i=this.$events[e]=[false]}else if(i[0]===true){i=this.$events[e]=i.slice(0);i[0]=false}var s=-1;for(var a=1;a<i.length;a++){var u=i[a];if(u.method===t&&u.caller===n){return}if(s===-1&&u.priority<o){s=a}}var l={type:e,method:t,caller:n,priority:o,receiveOnce:r};if(s<0){i.push(l)}else{i.splice(s,0,l)}};e.prototype.removeEventListener=function(e,t,n){if(f.isStringInvalidOrEmpty(e)===true){throw Error("移除无效的事件！！！")}if(t===void 0||t===null){throw Error("移除无效的事件回调！！！")}var r=this.$events[e]||null;if(r===null){return}if(r[0]===true){r=this.$events[e]=r.slice(0);r[0]=false}for(var o=0;o<r.length;o++){var i=r[o];if(i.method===t&&i.caller===n){r.splice(o,1);break}}if(r.length===1){delete this.$events[e]}};return e}();u.EventSystem=t;var s=function(){function e(e){if(e===void 0){e=null}this.$asNot=false;this.$interpretation=null;if(b.debugMode&L.TEST){e!==null&&I.log(L.ANY,e)}}e.prototype.expect=function(e){this.$value=e;return this};e.prototype.interpret=function(e){this.$interpretation=e;return this};e.prototype.test=function(e,t){if(this.$asNot===false&&e===false||this.$asNot===true&&e===true){a.ASSERT_FAILED=true;t!==null&&I.error(L.ANY,t);this.$interpretation!==null&&I.error(L.ANY,this.$interpretation);if(a.ASSERT_BREAKPOINT===true){debugger}throw Error("测试失败！")}};e.prototype.anything=function(){if(b.debugMode&L.TEST){var e=this.$value!==null&&this.$value!==void 0;var t="期望值"+(this.$asNot===false?"":"不为")+"：null or undefined, 实际值："+f.toDisplayString(this.$value);this.test(e,t)}};e.prototype.arrayContaining=function(e){if(b.debugMode&L.TEST){var t=true;for(var n=0;n<e.length;n++){var r=e[n];if(this.$value.indexOf(r)<0){t=false;break}}var o="期望"+(this.$asNot===false?"":"不")+"包含："+f.toDisplayString(e)+", 实际值："+f.toDisplayString(this.$value);this.test(t,o)}};e.prototype.stringContaining=function(e){if(b.debugMode&L.TEST){var t=this.$value.indexOf(e)>-1;var n="期望"+(this.$asNot===false?"":"不")+"包含："+e+", 实际值："+this.$value;this.test(t,n)}};e.prototype.stringMatching=function(e){if(b.debugMode&L.TEST){var t=e.indexOf(this.$value)>-1;var n="期望"+(this.$asNot===false?"":"不")+"被包含："+e+", 实际值："+this.$value;this.test(t,n)}};e.prototype.toHaveProperty=function(e,t){if(b.debugMode&L.TEST){var n=t===void 0?this.$value[e]!==void 0:this.$value[e]===t;var r="期望"+(this.$asNot===false?"":"不")+"存在属性："+e+", 实际值："+this.$value;this.test(n,r)}};e.prototype.toBe=function(e){if(b.debugMode&L.TEST){var t=this.$value===e;var n="期望值"+(this.$asNot===false?"":"不为")+"："+f.toDisplayString(e)+", 实际值："+f.toDisplayString(this.$value);this.test(t,n)}};e.prototype.toBeNull=function(){this.toBe(null)};e.prototype.toBeUndefined=function(){this.toBe(void 0)};e.prototype.toBeBoolean=function(){if(b.debugMode&L.TEST){var e=typeof this.$value==="boolean";var t="期望"+(this.$asNot===false?"为":"不为")+"：布尔类型, 实际为："+typeof this.$value;this.test(e,t)}};e.prototype.toBeInstanceOf=function(e){if(b.debugMode&L.TEST){var t=this.$value instanceof e;var n="期望 "+f.getQualifiedClassName(this.$value)+" 的类型"+(this.$asNot===false?"":"不")+"为 "+f.getClassName(e);this.test(t,n)}};e.prototype.toBeFalsy=function(e){if(b.debugMode&L.TEST){var t=e?false:true;var n="期望 "+f.toDisplayString(e)+" "+(this.$asNot===false?"":"不")+"为假, 实际值："+f.toDisplayString(this.$value);this.test(t,n)}};e.prototype.toBeTruthy=function(e){if(b.debugMode&L.TEST){var t=e?true:false;var n="期望 "+f.toDisplayString(e)+" "+(this.$asNot===false?"":"不")+"为假, 实际值："+f.toDisplayString(this.$value);this.test(t,n)}};e.prototype.toBeCloseTo=function(e,t){if(t===void 0){t=0}if(b.debugMode&L.TEST){var n=Math.abs(this.$value-e)<=Math.abs(t);var r="期望与"+e+"的误差"+(this.$asNot===true?"":"不")+"超过"+t+"，实际值："+this.$value;this.test(n,r)}};e.prototype.toBeGreaterThan=function(e){if(b.debugMode&L.TEST){var t=this.$value>e;var n="期望"+(this.$asNot===true?"":"不")+"大于 "+e+"，实际值："+this.$value;this.test(t,n)}};e.prototype.toBeGreaterOrEqualThan=function(e){if(b.debugMode&L.TEST){var t=this.$value>=e;var n="期望"+(this.$asNot===true?"":"不")+"大于等于 "+e+"，实际值："+this.$value;this.test(t,n)}};e.prototype.toBeLessThan=function(e){if(b.debugMode&L.TEST){var t=this.$value<e;var n="期望"+(this.$asNot===true?"":"不")+"小于 "+e+"，实际值："+this.$value;this.test(t,n)}};e.prototype.toBeLessOrEqualThan=function(e){if(b.debugMode&L.TEST){var t=this.$value<=e;var n="期望"+(this.$asNot===true?"":"不")+"小于等于 "+e+"，实际值："+this.$value;this.test(t,n)}};e.prototype.toEqual=function(e){if(b.debugMode&L.TEST){var t=f.isEqual(this.$value,e,false);var n="期望相等："+f.toDisplayString(e)+"，实际值："+f.toDisplayString(this.$value);this.test(t,n)}};e.prototype.toStrictEqual=function(e){if(b.debugMode&L.TEST){var t=f.isEqual(this.$value,e,true);var n="期望相等："+f.toDisplayString(e)+"，实际值："+f.toDisplayString(this.$value);this.test(t,n)}};Object.defineProperty(e.prototype,"not",{get:function(){this.$asNot=true;return this},enumerable:true,configurable:true});return e}();u.Expect=s;var n=function(){function r(e,t,n){this.$args=n;this.$caller=e;this.$method=t}r.prototype.run=function(){if(this.$args===void 0){return this.$method.call(this.$caller)}return this.$method.apply(this.$caller,this.$args)};r.prototype.runWith=function(e){if(this.$args===void 0){if(e instanceof Array){return this.$method.apply(this.$caller,e)}return this.$method.call(this.$caller,e)}return this.$method.apply(this.$caller,this.$args.concat(e))};Object.defineProperty(r.prototype,"caller",{get:function(){return this.$caller},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"method",{get:function(){return this.$method},enumerable:true,configurable:true});r.create=function(e,t,n){return new r(e,t,n)};return r}();u.Handler=n;var r=function(){function e(e){this.source=[];this.dataMap={};if(typeof e!=="string"){throw Error("非法的主键字段名："+e)}if(e.length===0){throw Error("无效的主键字段名字长度："+e.length)}this.$primaryKey=e}e.prototype.$removeByIndex=function(e){var t=this.source[e];this.source.splice(e,1);var n=t[this.$primaryKey];delete this.dataMap[n];return t};e.prototype.$getIndexByValue=function(e,t){if(t===void 0){return-1}for(var n=0;n<this.source.length;n++){var r=this.source[n];if(r[e]===t){return n}}return-1};e.prototype.put=function(e){var t=e[this.$primaryKey];if(f.isStringInvalidOrEmpty(t)===true){throw Error("无效的主键的值，type:"+typeof t+", value:"+t)}if(this.getByPrimaryValue(t)===null){this.source.push(e);this.dataMap[t]=e}else{throw Error("重复的主键值：["+this.$primaryKey+"]"+t)}return e};e.prototype.getByValue=function(e,t){if(e===this.$primaryKey){return this.getByPrimaryValue(t)}var n=this.$getIndexByValue(e,t);if(n===-1){return null}return this.source[n]};e.prototype.getByPrimaryValue=function(e){return this.dataMap[e.toString()]||null};e.prototype.remove=function(e){var t=this.source.indexOf(e);if(t===-1){return e}return this.$removeByIndex(t)};e.prototype.removeByValue=function(e,t){if(e===this.$primaryKey){return this.removeByPrimaryValue(t)}var n=this.$getIndexByValue(e,t);if(n===-1){return null}return this.$removeByIndex(n)};e.prototype.removeByPrimaryValue=function(e){var t=this.getByPrimaryValue(e);if(t===null){return null}return this.remove(t)};e.prototype.forEach=function(e){for(var t=0;t<this.source.length;t++){if(e(this.source[t])===true){break}}};return e}();u.HashMap=r;var f;(function(u){var e=0;function t(){e++;return e}u.createHashId=t;function n(e){var t=e.toString().trim();var n=t.indexOf("(");return e.name||t.substring(9,n)}u.getClassName=n;function r(e){var t=typeof e;if(t!=="object"){return t}var n=e.prototype||Object.getPrototypeOf(e)||null;if(n===null){return t}return u.getClassName(n.constructor)}u.getQualifiedClassName=r;function o(e,t){if(t===void 0){t=null}if(t===null){return u.getClassName(e)}for(var n in t){if(t[n]===e){return n}}return null}u.getMethodName=o;function i(e,t){for(var n in t){if(t[n]===e){return n}}return null}u.convertEnumToString=i;function s(e){if(e===void 0){e=null}if(e===null){return null}var t=["\r","\n","\t"," "];while(e.length>0){var n=e.length;for(var r=0;r<t.length;r++){var o=t[r];if(e.charAt(0)===o){e=e.substr(1);break}var i=e.length-1;if(e.charAt(i)===o){e=e.substr(0,i);break}}if(e.length===n){break}}return e}u.trim=s;function a(e){if(typeof e==="number"){return false}if(typeof e==="string"&&e!==""){return false}return true}u.isStringInvalidOrEmpty=a;function l(e,t){var n=["%d","%s"];var r=0;while(t.length>0){var o=null;var i=-1;for(var s=0;s<n.length;s++){var a=n[s];var u=e.indexOf(a,r);if(u===-1){continue}if(i===-1||u<i){o=a;i=u}}if(i===-1){I.warn(L.ANY,"字符串替换未完成 str:"+e);break}var l=e.substr(i+o.length);e=e.substr(0,i)+t.shift()+l;r=e.length-l.length}return e}u.formatString=l;function c(e,t){var n=0;while(t.length>0){var r=e.indexOf("{$}",n);if(n===-1){I.warn(L.ANY,"字符串替换未完成 str:"+e);break}var o=e.substr(r+3);e=e.substr(0,r)+t.shift()+o;n=e.length-o.length}return e}u.formatString$=c;function f(e){if(e instanceof Date){return e}if(R.isNumber(e)===true){return new Date(e)}if(typeof e==="string"){var t=e.split(" ");var n=t.length===1?[]:t.shift().split("-");var r=t[0].split(":");if(r.length===3){if(n.length===0){var o=new Date;n[0]=o.getFullYear().toString();n[1]=(o.getMonth()+1).toString();n[2]=o.getDate().toString()}return new Date(Number(n[0]),Number(n[1])-1,Number(n[2]),Number(r[0]),Number(r[1]),Number(r[2]))}return new Date(e)}throw Error("Convert Date Error:"+e)}u.convertToDate=f;function d(e,t,n){var r=u.convertToDate(n);if(e==="yy"){r.setFullYear(r.getFullYear()+t)}else if(e==="MM"){var o=t%12;var i=(t-o)/12;r.setFullYear(r.getFullYear()+i);var s=r.getMonth()+o;if(s>11){r.setMonth(s-12);r.setFullYear(r.getFullYear()+1)}else if(s<0){r.setMonth(o+11);r.setFullYear(r.getFullYear()-1)}else{r.setMonth(s)}}var a=r.valueOf();if(e==="ww"){a+=t*7*24*3600*1e3}else if(e==="dd"){a+=t*24*3600*1e3}else if(e==="hh"){a+=t*3600*1e3}else if(e==="mm"){a+=t*60*1e3}else if(e==="ss"){a+=t*1e3}else if(e==="ms"){a+=t}return a}u.dateAdd=d;function h(e,t,n){var r=u.convertToDate(t);var o=u.convertToDate(n);var i=r.valueOf();var s=o.valueOf();if(e==="ms"){return s-i}i=Math.floor(i/1e3);s=Math.floor(s/1e3);if(e==="ss"){return s-i}i=Math.floor(i/60);s=Math.floor(s/60);if(e==="mm"){return s-i}i=Math.floor(i/60);s=Math.floor(s/60);if(e==="hh"){return s-i}i=Math.floor(i/24);s=Math.floor(s/24);if(e==="dd"){return s-i}if(e==="ww"){return Math.floor((s-4-(i-4))/7)}if(e==="MM"){return o.getMonth()-r.getMonth()+(o.getFullYear()-r.getFullYear())*12}if(e==="yy"){return o.getFullYear()-r.getFullYear()}return 0}u.dateDiff=h;function p(e,t){var n=u.convertToDate(t);e=e.replace("MS",("00"+n.getMilliseconds().toString()).substr(-3));e=e.replace("ms",n.getMilliseconds().toString());e=e.replace("yyyy",n.getFullYear().toString());e=e.replace("yy",n.getFullYear().toString().substr(2,2));e=e.replace("MM",("0"+(n.getMonth()+1).toString()).substr(-2));e=e.replace("dd",("0"+n.getDate().toString()).substr(-2));e=e.replace("hh",("0"+n.getHours().toString()).substr(-2));e=e.replace("mm",("0"+n.getMinutes().toString()).substr(-2));e=e.replace("ss",("0"+n.getSeconds().toString()).substr(-2));e=e.replace("M",(n.getMonth()+1).toString());e=e.replace("d",n.getDate().toString());e=e.replace("h",n.getHours().toString());e=e.replace("m",n.getMinutes().toString());e=e.replace("s",n.getSeconds().toString());return e}u.formatDate=p;function m(e){throw Error("未实现的接口！！！")}u.md5=m;function E(e,t,n){if(n===void 0){n="sign"}var r=[];for(var o in e){if(o!==n){r.push(o+"="+e[o])}}r.push("key="+t);return u.md5(r.join("&"))}u.createHttpSign=E;function y(e){var t=e.lastIndexOf("/");if(t>-1){e=e.substr(t+1)}var n=u.getFileExtension(e);if(n===null){return e}return e.substr(0,e.length-n.length-1)}u.getFileName=y;function v(e){var t=e.lastIndexOf(".");if(t===-1){return null}return e.substr(t+1).toLowerCase()}u.getFileExtension=v;function g(e,t){var n=e.lastIndexOf(".");if(n===-1){return e}return e.substr(0,n+1)+t}u.replacePathExtension=g;function $(e,t,n){if(n===void 0){n=null}for(var r=0;r<e.length;r++){var o=e[r];if(t(o)===true){if(n===null){return o}n.push(o)}}return null}u.findFromArray=$;function T(e,t){for(var n=0;n<t.length;n++){if(t[n]===e){t.splice(n,1);break}}}u.removeItemFromArray=T;function S(e,t){for(var n=0;n<e.length;n++){u.removeItemFromArray(e[n],t)}}u.removeItemsFromArray=S;function N(e,t){if(t===void 0){t=false}if(e instanceof Array){if(t===false){return e.slice(0)}else{var n=[];for(var r=0;r<e.length;r++){n.push(u.copy(e[r],t))}return n}}else if(e instanceof Object){var o={};if(t===false){for(var i in e){o[i]=e[i]}}else{for(var i in e){o[i]=u.copy(e[i],t)}}return o}return e}u.copy=N;function C(e){var t={};for(var n in e){var r=e[n];if(typeof r==="number"){t[n]=0}else if(typeof r==="boolean"){t[n]=false}else if(r instanceof Array){t[n]=[]}else if(r instanceof Object){t[n]=null}else{throw Error("克隆意外的数据类型："+r)}}return t}u.clone=C;function _(e,t,n){if(e===t){return true}if(typeof e==="number"&&typeof t==="number"&&isNaN(e)&&isNaN(t)){return true}if(e instanceof Array&&t instanceof Array&&e.length===t.length){if(n===false){e=e.slice();t=t.slice();e.sort();t.sort()}for(var r=0;r<e.length;r++){if(u.isEqual(e[r],t[r],n)===false){return false}}return true}else if(e instanceof Object&&t instanceof Object&&Object.keys(e).length===Object.keys(t).length){if(n===true&&e.constructor!==t.constructor){return false}for(var o in e){if(e.hasOwnProperty(o)===true&&u.isEqual(e[o],t[o],n)===false){return false}}return true}return false}u.isEqual=_;function O(t){if(t===void 0||t===null){return t}if(typeof t==="number"||typeof t==="string"||typeof t==="boolean"){return t.toString()}var n;if(t instanceof Array){var e=[];for(var r=0;r<t.length;r++){e.push(u.toDisplayString(t[r]))}return"["+e.join(",")+"]"}else{try{n=JSON.stringify(t)}catch(e){n="["+u.getQualifiedClassName(t)+"]"}}return n}u.toDisplayString=O;function M(e){if(typeof e!=="string"){I.error(L.ANY,"参数版本号无效");return 0}if(typeof b.VERSION!=="string"){I.error(L.ANY,"版本号未设置");return 0}var t=e.split(".");var n=b.VERSION.split(".");var r=t.length>n.length?t.length:n.length;while(t.length<r){t.push("0")}while(n.length<r){n.push("0")}var o=0;for(var i=0;i<r;i++){var s=t[i];var a=n[i];if(R.isNumber(s)===false){o|=1;t[i]="0"}if(R.isNumber(a)===false){o|=2;n[i]="0"}}if(o&1){I.error(L.ANY,"参数版本号无效 ver:"+e)}if(o&2){I.error(L.ANY,"当前版本号无效 ver:"+b.VERSION)}if(o>0){return 0}for(var i=0;i<r;i++){var u=Number(t[i]);var l=Number(n[i]);if(u<l){return 1}else if(u>l){return-1}}return 0}u.compareVersion=M})(f=u.Common||(u.Common={}));var o;(function(n){var r=0;n.$table={};function e(e){return n.$table[e.toString()]}n.get=e;function t(e,t){if(e<0){r++;n.$table["auto_"+r]=t}else{n.$table[e.toString()]=t}return t}n.put=t;function o(e){return n.$table[e.toString()]!==void 0}n.exist=o;function i(e){var t=n.get(e);delete n.$table[e.toString()];return t}n.drop=i})(o=u.DBService||(u.DBService={}));var b;(function(e){e.envMode=0;e.debugMode=0;e.WIDTH=1280;e.HEIGHT=720;e.width=1280;e.height=720;e.VERSION="1.0.0"})(b=u.Global||(u.Global={}));var I;(function(a){a.NUM_OF_BLOCK=200;a.LINES_OF_BLOCK=200;var u=[];a.locked=false;function o(e){if(a.locked===false&&u.length>a.NUM_OF_BLOCK){u.shift()}var t=null;var n=u.length;if(n>0){t=u[n-1];if(t.length===a.LINES_OF_BLOCK){t=null}}if(t===null){t=[];u.push(t)}t.push(e)}function e(e,t){if(e<0){t+=e;e=0}var n=e%a.LINES_OF_BLOCK;var r=(e-n)/a.LINES_OF_BLOCK;var o=[];for(var i=0;i<t;i++){if(r<u.length){var s=u[r];if(n<s.length){o.push(s[n])}n++;if(n===s.length){n=0;r++}}else{break}}return o}a.getDebugString=e;function t(){var e=0;for(var t=0;t<u.length;t++){e+=u[t].length}return e}a.getNumOfLines=t;function n(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}if(b.debugMode>0&&(e===L.ANY||(b.debugMode&e)===e)){var r=t.join(" ");console.log(r);o(r)}}a.log=n;function r(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}if(b.debugMode>0&&(e===L.ANY||(b.debugMode&e)===e)){var r=t.join(" ");console.warn(r);o(r)}}a.warn=r;function i(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}if(b.debugMode>0&&(e===L.ANY||(b.debugMode&e)===e)){var r=t.join(" ");console.error(r);o(r)}}a.error=i;function s(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}if(b.debugMode>0&&(e===L.ANY||(b.debugMode&e)===e)){var r=t.join(" ");console.info(r);o(r)}}a.log2f=s;function l(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}if(b.debugMode>0&&(e===L.ANY||(b.debugMode&e)===e)){var r=t.join(" ");console.trace(r)}}a.trace=l})(I=u.Logger||(u.Logger={}));var R;(function(e){e.PI=Math.PI;e.PI2=Math.PI*2;e.MAX_SAFE_INTEGER=9007199254740991;e.MIN_SAFE_INTEGER=-9007199254740991;function t(e){return e*Math.PI/180}e.d2r=t;function n(e){return e*180/Math.PI}e.r2d=n;function r(e){if(e<0){return-e}else{return e}}e.abs=r;function o(e,t){if(e<t){return e}else{return t}}e.min=o;function i(e,t){if(e>t){return e}else{return t}}e.max=i;function s(e,t,n){if(e<t){return t}else if(e>n){return n}return e}e.clamp=s;function a(e,t){if(t===void 0){t=0}var n=e.toString();var r=n.indexOf(".");if(r===-1){return e}var o=r+1;if(n.length-o<=t){return e}var i=n.substr(0,r);var s=n.substr(o,t);var a=n.substr(o+t,2);var u=a.length===1?a:a.charAt(0);var l=a.length===1?"0":a.charAt(1);var c=parseInt(i+s);var f=parseInt(u+l);if(c<0&&f>0){c-=1;f=100-f}var d=f.toString();var h=parseInt(d.charAt(0));var p=parseInt(d.charAt(1));if(h>5){c+=1}else if(h===5){if(p>0){c++}else{var m=c%2;if(m===1||m===-1){c+=1}}}var E=c.toString();var y=E.length-t;var v=E.substr(0,y)+"."+E.substr(y);var g=parseFloat(v);return g}e.round=a;function u(e,t){if(t===void 0){t=0}I.warn(L.ANY,"此接口己弃用：suncom.Common.$round(value: number, n: number = 0);");var n=Math.floor(e*Math.pow(10,t+2));var r=n%100;var o=(n-r)/100;if(r<0&&r>0){o-=1;r+=100}var i=r%10;var s=(r-i)/10;if(s>5){o+=1}else if(s===5){var a=i%2;if(a===1||a===-1){o+=1}}return o/Math.pow(10,t)}e.$round=u;function l(e,t){var n=d.random()*(t-e);return Math.floor(n)+e}e.random=l;function c(e){if(typeof e==="number"){return true}if(typeof e==="string"&&isNaN(Number(e))===false){return true}return false}e.isNumber=c})(R=u.Mathf||(u.Mathf={}));var i;(function(i){var r={};function e(e){var t=r[e]||null;if(t===null||t.length===0){return null}var n=t.pop();delete n["__suncom__$__inPool__"];return n}i.getItem=e;function t(e,t,n){var r=i.getItem(e);if(r===null){if(Laya.Prefab!==void 0&&t===Laya.Prefab){var o=new Laya.Prefab;o.json=n;r=o.create()}else{r={};r.__proto__=t.prototype;if(n instanceof Array){t.apply(r,n)}else{t.call(r,n)}}}return r}i.getItemByClass=t;function n(e,t){if(t["__suncom__$__inPool__"]===true){return}t["__suncom__$__inPool__"]=true;var n=r[e]||null;if(n===null){r[e]=[t]}else{n.push(t)}}i.recover=n;function o(e){if(r[e]!==void 0){delete r[e]}}i.clear=o})(i=u.Pool||(u.Pool={}));var d;(function(e){var r=1;var o=1103515245;var i=12345;var s=32767;function t(e){if(e<1){e=1;I.warn(L.ANY,"随机种子不允许小于1")}r=e}e.seed=t;function n(){var e=dcodeIO.Long.fromNumber(r);var t=dcodeIO.Long.fromNumber(o);var n=dcodeIO.Long.fromNumber(i);r=Math.floor(e.mul(t).add(n).low/s);return(r%s+s)/(s*2)}e.random=n})(d=u.Random||(u.Random={}));var a;(function(e){e.ASSERT_FAILED=false;e.ASSERT_BREAKPOINT=true;var n=null;function t(e,t){if(b.debugMode&L.TEST){return new s(t).expect(e)}if(n===null){n=new s}return n}e.expect=t;function r(e){if(b.debugMode&L.TEST){u.Test.expect(true).interpret("Test.notExpected 期望之外的").toBe(false)}}e.notExpected=r;function o(e,t){if(b.debugMode&L.TEST){u.Test.expect(e).interpret(t||"Test.assertTrue error，实际值："+f.toDisplayString(e)).toBe(true)}}e.assertTrue=o;function i(e,t){if(b.debugMode&L.TEST){u.Test.expect(e).interpret(t||"Test.assertFalse error，实际值："+f.toDisplayString(e)).toBe(false)}}e.assertFalse=i})(a=u.Test||(u.Test={}))})(suncom||(suncom={}));var suncore;(function(e){var h;(function(e){e[e["MIN"]=0]="MIN";e[e["PRIORITY_0"]=1]="PRIORITY_0";e[e["PRIORITY_HIGH"]=2]="PRIORITY_HIGH";e[e["PRIORITY_NOR"]=3]="PRIORITY_NOR";e[e["PRIORITY_LOW"]=4]="PRIORITY_LOW";e[e["PRIORITY_LAZY"]=5]="PRIORITY_LAZY";e[e["PRIORITY_TRIGGER"]=6]="PRIORITY_TRIGGER";e[e["PRIORITY_TASK"]=7]="PRIORITY_TASK";e[e["MAX"]=8]="MAX"})(h=e.MessagePriorityEnum||(e.MessagePriorityEnum={}));var p;(function(e){e[e["MIN"]=0]="MIN";e[e["SYSTEM"]=0]="SYSTEM";e[e["CUSTOM"]=1]="CUSTOM";e[e["TIMELINE"]=2]="TIMELINE";e[e["MAX"]=3]="MAX"})(p=e.ModuleEnum||(e.ModuleEnum={}));var o;(function(e){e[e["NSL_MSG_ID_BEGIN"]=1]="NSL_MSG_ID_BEGIN";e[e["NSL_MSG_ID_END"]=10]="NSL_MSG_ID_END";e[e["MMI_MSG_ID_BEGIN"]=10]="MMI_MSG_ID_BEGIN";e[e["MMI_MSG_ID_END"]=100]="MMI_MSG_ID_END";e[e["CUI_MSG_ID_BEGIN"]=100]="CUI_MSG_ID_BEGIN";e[e["CUI_MSG_ID_END"]=200]="CUI_MSG_ID_END";e[e["GUI_MSG_ID_BEGIN"]=200]="GUI_MSG_ID_BEGIN";e[e["GUI_MSG_ID_END"]=400]="GUI_MSG_ID_END";e[e["L4C_MSG_ID_BEGIN"]=400]="L4C_MSG_ID_BEGIN";e[e["L4C_MSG_ID_END"]=700]="L4C_MSG_ID_END"})(o=e.MsgQIdEnum||(e.MsgQIdEnum={}));var l;(function(e){e[e["NIL"]=-1]="NIL";e[e["KAL"]=0]="KAL";e[e["MMI"]=1]="MMI";e[e["L4C"]=2]="L4C";e[e["CUI"]=3]="CUI";e[e["GUI"]=4]="GUI";e[e["NSL"]=5]="NSL";e[e["ANY"]=6]="ANY"})(l=e.MsgQModEnum||(e.MsgQModEnum={}));var t=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$done=false;e.$running=false;return e}e.prototype.cancel=function(){};Object.defineProperty(e.prototype,"done",{get:function(){return this.$done},set:function(e){if(this.$done!==e){this.$done=e;if(e===true){this.cancel()}}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"running",{get:function(){return this.$running},set:function(e){this.$running=e},enumerable:true,configurable:true});return e}(puremvc.Notifier);e.AbstractTask=t;var n=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$running=false;return e}e.prototype.run=function(){if(this.$running===true){suncom.Logger.warn(suncom.DebugMode.ANY,"服务["+suncom.Common.getQualifiedClassName(this)+"]己运行");return}this.$running=true;this.$onRun()};e.prototype.stop=function(){if(this.$running===false){suncom.Logger.warn(suncom.DebugMode.ANY,"服务["+suncom.Common.getQualifiedClassName(this)+"]未运行");return}this.$running=false;this.$onStop()};Object.defineProperty(e.prototype,"running",{get:function(){return this.$running},enumerable:true,configurable:true});return e}(puremvc.Notifier);e.BaseService=n;var r=function(t){__extends(e,t);function e(){var e=t.call(this,l.KAL)||this;e.$delta=0;e.$runTime=0;e.$localTime=(new Date).valueOf();Laya.timer.frameLoop(1,e,e.$onFrameLoop);return e}e.prototype.destroy=function(){if(this.$destroyed===true){return}t.prototype.destroy.call(this);Laya.timer.clear(this,this.$onFrameLoop)};e.prototype.$onFrameLoop=function(){var e=this.$localTime;this.$localTime=(new Date).valueOf();this.$delta=this.$localTime-e;if(this.$delta>0){this.$runTime+=this.$delta;this.$lapse(this.$delta)}};e.prototype.$lapse=function(e){if(S.isModulePaused(p.CUSTOM)===false){E.timeStamp.lapse(e)}if(S.isModulePaused(p.TIMELINE)===false){E.timeline.lapse(e)}this.facade.sendNotification(v.MSG_Q_BUSINESS,l.NSL);this.facade.sendNotification(v.PHYSICS_PREPARE);this.facade.sendNotification(v.PHYSICS_FRAME);E.timerManager.executeTimer();this.facade.sendNotification(v.ENTER_FRAME);E.messageManager!==null&&E.messageManager.dealMessage();E.messageManager!==null&&E.messageManager.classifyMessages0();this.facade.sendNotification(v.LATER_FRAME);this.facade.sendNotification(v.MSG_Q_BUSINESS)};e.prototype.getTime=function(){return this.$runTime};e.prototype.getDelta=function(){return this.$delta};return e}(puremvc.Notifier);e.Engine=r;var i=function(){function e(){this.$queues=[];for(var e=p.MIN;e<p.MAX;e++){this.$queues[e]=new s(e)}}e.prototype.putMessage=function(e){this.$queues[e.mod].putMessage(e)};e.prototype.dealMessage=function(){for(var e=p.MIN;e<p.MAX;e++){if(S.isModulePaused(e)===false){this.$queues[e].dealMessage()}}};e.prototype.classifyMessages0=function(){for(var e=p.MIN;e<p.MAX;e++){if(S.isModuleStopped(e)===false){this.$queues[e].classifyMessages0()}}};e.prototype.clearMessages=function(e){this.$queues[e].clearMessages()};e.prototype.cancelTaskByGroupId=function(e,t){this.$queues[e].cancelTaskByGroupId(e,t)};return e}();e.MessageManager=i;var s=function(){function e(e){this.$tasks=[];this.$queues=[];this.$messages0=[];this.$mod=e;for(var t=h.MIN;t<h.MAX;t++){this.$queues[t]=[]}}e.prototype.putMessage=function(e){this.$messages0.push(e)};e.prototype.dealMessage=function(){var e=0;var t=0;for(var n=h.MIN;n<h.MAX;n++){var r=void 0;if(n===h.PRIORITY_TASK){r=this.$tasks}else{r=this.$queues[n]}if(r.length===0||n===h.PRIORITY_LAZY){continue}if(n===h.PRIORITY_TASK){for(var o=this.$tasks.length-1;o>-1;o--){var i=this.$tasks[o];if(i.length>0&&this.$dealTaskMessage(i[0])===true){i.shift();e++}if(i.length>1){t+=i.length-1}else if(i.length===0){this.$tasks.splice(o,1)}}}else if(n===h.PRIORITY_TRIGGER){var s={canceled:false};while(r.length>0&&this.$dealTriggerMessage(r[0],s)===true){r.shift();if(s.canceled===false){e++}}}else{var a=0;var u=this.$getDealCountByPriority(n);for(;r.length>0&&(u===0||a<u);a++){if(this.$dealCustomMessage(r.shift())===false){a--}}e+=a}t+=r.length}if(t===0&&e===0&&this.$messages0.length===0){var r=this.$queues[h.PRIORITY_LAZY];if(r.length>0){this.$dealCustomMessage(r.shift());e++}}};e.prototype.$dealTaskMessage=function(e){var t=e.task;if(t.running===false){t.running=true;if(t.run()===true){t.done=true}}return t.done===true};e.prototype.$dealTriggerMessage=function(e,t){if(e.timeout>S.getModuleTimestamp(this.$mod)){return false}t.canceled=e.handler.run()===false;return true};e.prototype.$dealCustomMessage=function(e){return e.handler.run()!==false};e.prototype.$getDealCountByPriority=function(e){if(e===h.PRIORITY_0){return 0}if(e===h.PRIORITY_HIGH){return 10}if(e===h.PRIORITY_NOR){return 3}if(e===h.PRIORITY_LOW){return 1}throw Error("错误的消息优先级")};e.prototype.classifyMessages0=function(){while(this.$messages0.length>0){var e=this.$messages0.shift();if(e.priority===h.PRIORITY_TASK){this.$addTaskMessage(e)}else if(e.priority===h.PRIORITY_TRIGGER){this.$addTriggerMessage(e)}else{this.$queues[e.priority].push(e)}}};e.prototype.$addTriggerMessage=function(e){var t=this.$queues[h.PRIORITY_TRIGGER];var n=0;var r=0;var o=t.length-1;var i=-1;while(o-n>1){r=Math.floor((n+o)*.5);if(t[r].timeout<=e.timeout){n=r}else if(t[r].timeout>e.timeout){o=r}else{break}}for(var s=n;s<=o;s++){if(t[s].timeout>e.timeout){i=s;break}}if(i<0){t.push(e)}else{t.splice(i,0,e)}};e.prototype.$addTaskMessage=function(e){var t=-1;for(var n=0;n<this.$tasks.length;n++){var r=this.$tasks[n];if(r.length>0&&r[0].groupId===e.groupId){t=n;break}}if(t===-1){this.$tasks.unshift([e])}else{this.$tasks[t].push(e)}};e.prototype.clearMessages=function(){while(this.$messages0.length>0){this.$cancelMessage(this.$messages0.shift())}for(var e=0;e<this.$tasks.length;e++){var t=this.$tasks[e];while(t.length>0){this.$cancelMessage(t.shift())}}for(var n=h.MIN;n<h.MAX;n++){var r=this.$queues[n];while(r.length>0){this.$cancelMessage(r.shift())}}};e.prototype.$cancelMessage=function(e){if(e.priority===h.PRIORITY_TASK){e.task.done=true}};e.prototype.cancelTaskByGroupId=function(e,t){for(var n=0;n<this.$tasks.length;n++){var r=this.$tasks[n];if(r.length>0&&r[0].groupId===t){while(r.length>0){r.shift().task.done=true}break}}};return e}();e.MessageQueue=s;var a=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$onRun=function(){y.setModuleActive(this.msgQMod,true);this.facade.registerObserver(v.MSG_Q_BUSINESS,this.$onMsgQBusiness,this)};t.prototype.$onStop=function(){y.setModuleActive(this.msgQMod,false);this.facade.removeObserver(v.MSG_Q_BUSINESS,this.$onMsgQBusiness,this)};t.prototype.$onMsgQBusiness=function(e){var t=null;if(e===void 0||e===this.msgQMod){while(true){if(e===l.NSL){t=y.fetch(l.NSL,2)}else if(this.msgQMod===l.NSL){t=y.fetch(l.NSL,1)}else{t=y.fetch(this.msgQMod)}if(t===null){break}this.$dealMsgQMsg(t)}y.seqId++}};return t}(n);e.MsgQService=a;var u=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t){suncom.Test.expect(t).interpret("应当为参数 stop 指定有效值").toBeBoolean();if(t===true){if(S.isModuleStopped(e)===true){suncom.Logger.error(suncom.DebugMode.ANY,"模块 "+p[e]+" 己经停止！！！");return}}else if(S.isModulePaused(e)===true){suncom.Logger.error(suncom.DebugMode.ANY,"模块 "+p[e]+" 己经暂停！！！");return}else if(e===p.SYSTEM){suncom.Logger.error(suncom.DebugMode.ANY,"无法暂停 "+p[e]+" 模块！！！");return}if(e===p.TIMELINE){E.timeline.pause(t)}else if(e===p.CUSTOM){E.timeStamp.pause(t)}if(t===false){return}if(e===p.SYSTEM){if(S.isModuleStopped(p.TIMELINE)===false||S.isModuleStopped(p.CUSTOM)===false){suncom.Test.notExpected("SYSTEM 不能停止因为 CUSTOM 或 TIMELINE 依然在运行");return}}E.timerManager.clearTimer(e);E.messageManager.clearMessages(e);if(e===p.TIMELINE){E.timeline=null}else if(e===p.CUSTOM){E.timeStamp=null}else{E.engine.destroy();E.engine=null}if(e===p.SYSTEM){E.timerManager=null;E.messageManager=null}};return t}(puremvc.SimpleCommand);e.PauseTimelineCommand=u;var c=function(n){__extends(e,n);function e(e){var t=n.call(this)||this;t.$handler=e;return t}e.prototype.run=function(){this.$handler.run();return true};return e}(t);e.SimpleTask=c;var f=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t){suncom.Test.expect(t).interpret("应当为参数 pause 指定有效值").toBeBoolean();if(S.isModulePaused(e)===false){suncom.Logger.error(suncom.DebugMode.ANY,"模块 "+p[e]+" 己经启动！！！");return}if(e===p.SYSTEM&&E.engine===null){E.timerManager=new m;E.messageManager=new i}if(e===p.TIMELINE){if(E.timeline===null){E.timeline=new d}E.timeline.resume(t)}else if(e===p.CUSTOM){if(E.timeStamp===null){E.timeStamp=new d}E.timeStamp.resume(t)}else if(e===p.SYSTEM){if(E.engine===null){E.engine=new r}}};return t}(puremvc.SimpleCommand);e.StartTimelineCommand=f;var d=function(){function e(){this.$runTime=0;this.$paused=true;this.$stopped=true}e.prototype.lapse=function(e){this.$runTime+=e};e.prototype.pause=function(e){this.$paused=true;this.$stopped=e};e.prototype.resume=function(e){this.$paused=e;this.$stopped=false};e.prototype.getTime=function(){return this.$runTime};Object.defineProperty(e.prototype,"paused",{get:function(){return this.$paused},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"stopped",{get:function(){return this.$stopped},enumerable:true,configurable:true});return e}();e.Timeline=d;var m=function(){function e(){this.$seedId=0;this.$timers=[];this.$timerMap={};for(var e=p.MIN;e<p.MAX;e++){this.$timers[e]=[]}}e.prototype.$createNewTimerId=function(){this.$seedId++;return this.$seedId};e.prototype.executeTimer=function(){for(var e=p.MIN;e<p.MAX;e++){if(S.isModulePaused(e)===false){var t=this.$timers[e];var n=S.getModuleTimestamp(e);while(t.length>0){var r=t[0];if(r.active===true){if(r.timeout>n){break}if(r.real===true){r.count++}else{r.count=suncom.Mathf.min(Math.floor((n-r.timestamp)/r.delay),r.loops)}}if(r.active===false||r.loops>0&&r.count>=r.loops){delete this.$timerMap[r.timerId]}else{this.addTimer(r.mod,r.delay,r.method,r.caller,r.args,r.loops,r.real,r.timerId,r.timestamp,r.timeout,r.count)}t.shift();if(r.active===true){if(r.args===null){r.method.call(r.caller,r.count,r.loops)}else{r.method.apply(r.caller,r.args.concat(r.count,r.loops))}}}}}};e.prototype.addTimer=function(e,t,n,r,o,i,s,a,u,l,c){if(o===void 0){o=null}if(i===void 0){i=1}if(s===void 0){s=false}if(a===void 0){a=0}if(u===void 0){u=-1}if(l===void 0){l=-1}if(c===void 0){c=0}var f=S.getModuleTimestamp(e);if(a===0){a=this.$createNewTimerId()}if(u===-1){u=f}if(l===-1){l=f}var d;if(typeof t==="number"){d=t}else{d=t[1]||0;t=t[0]}if(t<1){t=1}var h=0;if(s===true){h=(f-l)%t}else{h=(f-u)%t}l=f+t-h;if(d===0){if(o===null){n.call(r,0,i)}else{n.apply(r,o.concat(0,i))}}else if(d<t){var p=t-d;l=suncom.Mathf.clamp(l-p,f+1,l)}var m={mod:e,active:true,delay:t,method:n,caller:r,args:o,real:s,count:c,loops:i,timerId:a,timestamp:u,timeout:l};var E=this.$timers[e];var y=-1;var v=0;var g=0;var $=E.length-1;while($-v>1){g=Math.floor((v+$)*.5);if(E[g].timeout<=l){v=g}else if(E[g].timeout>l){$=g}else{break}}for(var T=v;T<=$;T++){if(E[T].timeout>l){y=T;break}}if(y<0){E.push(m)}else{E.splice(y,0,m)}this.$timerMap[a]=m;return a};e.prototype.removeTimer=function(e){if(e>0&&this.$timerMap[e]!==void 0){this.$timerMap[e].active=false}return 0};e.prototype.clearTimer=function(e){var t=this.$timers[e];while(t.length>0){var n=t.pop();delete this.$timerMap[n.timerId]}};return e}();e.TimerManager=m;var E;(function(e){e.engine=null;e.timeline=null;e.timeStamp=null;e.timerManager=null;e.messageManager=null})(E=e.M||(e.M={}));var y;(function(i){var s={};var n={};i.seqId=1;function e(e,t,n){if(u(e)===false){suncom.Logger.warn(suncom.DebugMode.ANY,"消息发送失败，模块己暂停 mod:"+l[e]);return}if(a(e,t)===false){suncom.Logger.warn(suncom.DebugMode.ANY,"消息发送失败，消息ID非法 mod:"+e+", id:"+t);return}var r=s[e]||null;if(r===null){r=s[e]=[]}var o={dst:e,seqId:i.seqId,id:t,data:n};r.push(o)}i.send=e;function t(e,t){var n=s[e]||null;if(n===null||n.length===0){return null}for(var r=0;r<n.length;r++){var o=n[r];if(e===l.NSL||o.seqId<i.seqId){if(t===void 0||o.id===t){n.splice(r,1);return o}}}return null}i.fetch=t;function a(e,t){var n=suncom.Mathf.MIN_SAFE_INTEGER;var r=suncom.Mathf.MAX_SAFE_INTEGER;if(e===l.MMI){n=o.MMI_MSG_ID_BEGIN;r=o.MMI_MSG_ID_END}else if(e===l.CUI){n=o.CUI_MSG_ID_BEGIN;r=o.CUI_MSG_ID_END}else if(e===l.GUI){n=o.GUI_MSG_ID_BEGIN;r=o.GUI_MSG_ID_END}else if(e===l.L4C){n=o.L4C_MSG_ID_BEGIN;r=o.L4C_MSG_ID_END}else if(e===l.NSL){n=o.NSL_MSG_ID_BEGIN;r=o.NSL_MSG_ID_END}else{suncom.Test.notExpected("未知的消息范围 mod:"+e)}return t>=n&&t<r}function u(e){return n[e]===true}i.isModuleActive=u;function r(e,t){n[e]=t;if(t===false){delete s[e]}}i.setModuleActive=r})(y=e.MsgQ||(e.MsgQ={}));var v;(function(e){e.STARTUP="suncore.NotifyKey.STARTUP";e.SHUTDOWN="suncore.NotifyKey.SHUTDOWN";e.START_TIMELINE="suncore.NotifyKey.START_TIMELINE";e.PAUSE_TIMELINE="suncore.NotifyKey.PAUSE_TIMELINE";e.PHYSICS_FRAME="suncore.NotifyKey.PHYSICS_FRAME";e.PHYSICS_PREPARE="suncore.NotifyKey.PHYSICS_PREPARE";e.ENTER_FRAME="suncore.NotifyKey.ENTER_FRAME";e.LATER_FRAME="suncore.NotifyKey.LATER_FRAME";e.MSG_Q_BUSINESS="suncore.NotifyKey.MSG_Q_BUSINESS"})(v=e.NotifyKey||(e.NotifyKey={}));var S;(function(a){var e=1e3;function o(){e++;return e}function t(e){if(e===p.TIMELINE){if(E.timeline===null||E.timeline.stopped===true){return true}}else if(e===p.CUSTOM){if(E.timeStamp===null||E.timeStamp.stopped===true){return true}}else if(E.engine===null){return true}return false}a.isModuleStopped=t;function n(e){if(t(e)===true){return true}if(e===p.TIMELINE){return E.timeline.paused}else if(e===p.CUSTOM){return E.timeStamp.paused}return false}a.isModulePaused=n;function r(){if(t(p.SYSTEM)===false){return E.engine.getDelta()}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试获取帧时间间隔，但系统模块己停止！！！")}}a.getDelta=r;function i(e){if(t(e)===false){if(e===p.TIMELINE){return E.timeline.getTime()}else if(e===p.CUSTOM){return E.timeStamp.getTime()}return E.engine.getTime()}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试获取时间戳，但模块 "+p[e]+" 己停止！！！")}}a.getModuleTimestamp=i;function s(e,t,n){if(a.isModuleStopped(e)===false){if(t===-1){t=o()}else if(t>1e3){suncom.Test.notExpected("自定义的Task GroupId不允许超过1000")}var r={mod:e,task:n,groupId:t,priority:h.PRIORITY_TASK};E.messageManager.putMessage(r)}else{t=-1;suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加任务，但模块 "+p[e]+" 己停止！！！")}return t}a.addTask=s;function u(e,t){E.messageManager.cancelTaskByGroupId(e,t)}a.cancelTaskByGroupId=u;function l(e,t,n){if(a.isModuleStopped(e)===false){var r={mod:e,handler:n,timeout:a.getModuleTimestamp(e)+t,priority:h.PRIORITY_TRIGGER};E.messageManager.putMessage(r)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加触发器，但模块 "+p[e]+" 己停止！！！")}}a.addTrigger=l;function c(e,t,n){if(a.isModuleStopped(e)===false){var r={mod:e,handler:n,priority:t};E.messageManager.putMessage(r)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加Message消息，但模块 "+p[e]+" 己停止！！！")}}a.addMessage=c;function f(e,t,n,r,o,i,s){if(i===void 0){i=1}if(s===void 0){s=false}if(a.isModuleStopped(e)===false){return E.timerManager.addTimer(e,t,n,r,o,i,s)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加定时器，但模块 "+p[e]+" 己停止！！！")}}a.addTimer=f;function d(e){return E.timerManager.removeTimer(e)}a.removeTimer=d})(S=e.System||(e.System={}))})(suncore||(suncore={}));var suntdd;(function(e){var n;(function(e){e[e["CONNECTED"]=0]="CONNECTED";e[e["CONNECTING"]=1]="CONNECTING";e[e["DISCONNECTED"]=2]="DISCONNECTED"})(n=e.MSWSConnectionStateEnum||(e.MSWSConnectionStateEnum={}));var r;(function(e){e[e["CONNECTED"]=0]="CONNECTED";e[e["CLOSE"]=1]="CLOSE";e[e["ERROR"]=2]="ERROR"})(r=e.MSWSStateEnum||(e.MSWSStateEnum={}));var s;(function(e){e[e["NONE"]=0]="NONE";e[e["BUTTON_CLICK"]=1]="BUTTON_CLICK";e[e["SIGNAL_EMIT"]=2]="SIGNAL_EMIT";e[e["SIGNAL_WAIT"]=3]="SIGNAL_WAIT";e[e["WS_STATE"]=4]="WS_STATE";e[e["WS_PROTOCAL"]=5]="WS_PROTOCAL"})(s=e.TestActionKindEnum||(e.TestActionKindEnum={}));var a;(function(e){e[e["NONE"]=1]="NONE";e[e["NOT_YET"]=2]="NOT_YET";e[e["COMPLETE"]=4]="COMPLETE";e[e["SUSPEND"]=8]="SUSPEND"})(a=e.TestActionResultEnum||(e.TestActionResultEnum={}));var o;(function(e){e[e["INSERT"]=0]="INSERT";e[e["APPEND"]=1]="APPEND"})(o=e.TestCaseRegOptionEnum||(e.TestCaseRegOptionEnum={}));var u;(function(e){e[e["PREPARE"]=0]="PREPARE";e[e["EXECUTE"]=1]="EXECUTE";e[e["FINISH"]=2]="FINISH"})(u=e.TestCaseStatusEnum||(e.TestCaseStatusEnum={}));var i=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){delete $.buttonMap[e];var t=$.waitMap[e]||null;if(t===null){return}for(var n=0;n<t.length;n++){var r=t[n];if(r.line===true){continue}r.canceled=true}};return t}(puremvc.SimpleCommand);e.CancelCommand=i;var l=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){var t={id:e};this.facade.sendNotification(T.ADD_ACTION,[s.BUTTON_CLICK,t])};return t}(puremvc.SimpleCommand);e.ClickCommand=l;var c=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$click=null;e.$button=null;return e}e.prototype.execute=function(e){this.$click=e;this.$button=$.buttonMap[e.id]||null;suncom.Test.expect(this.$button).not.toBeNull();if(this.$button.once===true){delete $.buttonMap[e.id]}suncore.System.addTimer(suncore.ModuleEnum.SYSTEM,500,this.$doClick,this)};e.prototype.$doClick=function(){var e=new Laya.Event;e.setTo(Laya.Event.CLICK,this.$button.button,this.$button.button);this.$button.button.event(Laya.Event.CLICK,e);this.$click.done=true};return e}(puremvc.SimpleCommand);e.DoClickCommand=c;var f=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$cfg=null;return e}e.prototype.execute=function(e){this.$cfg=e;suncom.Test.expect(e.id).toBeGreaterThan(0);if(e.delay<=0){this.$doEmit()}else{suncore.System.addTimer(suncore.ModuleEnum.SYSTEM,e.delay,this.$doEmit,this)}};e.prototype.$doEmit=function(){suncom.Test.expect($.currentSignalId).interpret("信号发射干扰").toBe(0);$.currentSignalId=this.$cfg.id;var e=$.waitMap[this.$cfg.id]||null;if(e!==null){for(var t=0;t<e.length;t++){var n=e[t];if(n.once===true&&n.done===true){continue}if(n.once===true){n.done=true}if(n.canceled===true){continue}var r=n.handler||null;if(r===null){continue}r.runWith(this.$cfg.args)}}this.$cfg.done=true;$.currentSignalId=0};return e}(puremvc.SimpleCommand);e.DoEmitCommand=f;var d=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,n,r){var o={id:e,args:t,line:n,delay:r};if(n===false){this.facade.sendNotification(T.DO_EMIT,o)}else{this.facade.sendNotification(T.ADD_ACTION,[s.SIGNAL_EMIT,o])}};return t}(puremvc.SimpleCommand);e.EmitCommand=d;var t=function(t){__extends(e,t);function e(){var e=t.call(this,0)||this;e.$actions=[];$.timeDiff=suncom.Mathf.random(-8e3,8e3);if(suncore.System.isModuleStopped(suncore.ModuleEnum.SYSTEM)===true){throw Error("微服务器未运行，因为SYSTEM时间轴未开启")}return e}e.prototype.$onRun=function(){this.facade.registerCommand(T.EMIT,d);this.facade.registerCommand(T.WAIT,g);this.facade.registerCommand(T.CLICK,l);this.facade.registerCommand(T.CANCEL,i);this.facade.registerCommand(T.DO_EMIT,f);this.facade.registerCommand(T.DO_CLICK,c);this.facade.registerCommand(T.REG_BUTTON,p);this.facade.registerCommand(T.PREPARE_PROTOCAL_PACKET,h);this.facade.registerCommand(T.SERIALIZE_WEBSOCKET_STATE_PACKET,y);this.facade.registerCommand(T.SERIALIZE_WEBSOCKET_PROTOCAL_PACKET,E);this.facade.registerObserver(T.ADD_WAIT,this.$addWait,this);this.facade.registerObserver(T.ADD_ACTION,this.$addAction,this);this.facade.registerObserver(T.TEST_WEBSOCKET_SEND_DATA,this.$onWebSocketSendData,this);this.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)};e.prototype.$onStop=function(){this.facade.removeCommand(T.EMIT);this.facade.removeCommand(T.WAIT);this.facade.removeCommand(T.CLICK);this.facade.removeCommand(T.CANCEL);this.facade.removeCommand(T.DO_EMIT);this.facade.removeCommand(T.DO_CLICK);this.facade.removeCommand(T.REG_BUTTON);this.facade.removeCommand(T.PREPARE_PROTOCAL_PACKET);this.facade.removeCommand(T.SERIALIZE_WEBSOCKET_STATE_PACKET);this.facade.removeCommand(T.SERIALIZE_WEBSOCKET_PROTOCAL_PACKET);this.facade.removeObserver(T.ADD_WAIT,this.$addWait,this);this.facade.removeObserver(T.ADD_ACTION,this.$addAction,this);this.facade.removeObserver(T.TEST_WEBSOCKET_SEND_DATA,this.$onWebSocketSendData,this);this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)};e.prototype.$onEnterFrame=function(){var e=false;while(this.$actions.length>0){var t=this.$actions[0];var n=a.NONE;switch(t.kind){case s.SIGNAL_WAIT:n=this.$doWait(t.cfg);break;case s.SIGNAL_EMIT:n=this.$doEmit(t.cfg);break;case s.BUTTON_CLICK:n=this.$doClick(t.cfg);break;case s.WS_STATE:n=this.$notifyStatePacket(t.cfg);break;case s.WS_PROTOCAL:n=this.$notifyProtocalPacket(t.cfg);break;default:suncom.Test.notExpected();break}if(n&a.NOT_YET){break}if(n&a.COMPLETE){this.$actions.shift()}if(n&a.SUSPEND){break}if(t.kind===s.WS_PROTOCAL){e=true}if(e===true&&this.$actions.length>0){var r=this.$actions[0];if(r.kind===s.WS_PROTOCAL){var o=r.cfg;if(o.asNewMsg===true){break}}}}if(this.$actions.length>0){return}if($.currentTestCase===null){var i=$.tccQueue.shift()||null;$.currentTestCase=i===null?null:new i.taskCls(i.tcId)}else if($.currentTestCase.status===u.EXECUTE){$.currentTestCase.done()}else if($.currentTestCase.status===u.FINISH){suncom.Test.expect(this.$actions.length).toBe(0);$.currentTestCase=null}};e.prototype.$onWebSocketSendData=function(e){for(var t=0;t<this.$actions.length;t++){var n=this.$actions[t];if(n.kind===s.WS_PROTOCAL){var r=n.cfg;if(r.waitName===e&&r.waitTimes>0&&r.waitCount<r.waitTimes){r.waitCount++}break}}};e.prototype.$addAction=function(e,t){var n={kind:e,cfg:t};this.$actions.push(n)};e.prototype.$addWait=function(e){var t=$.waitMap[e.id]||null;if(t===null){t=$.waitMap[e.id]=[]}var n=-1;for(var r=0;r<t.length;r++){if(t[r]===e){n=r;break}}if(n===-1){t.push(e)}};e.prototype.$notifyProtocalPacket=function(e){if(this.$notYet(e)===true){return a.NOT_YET}this.facade.sendNotification(T.PREPARE_PROTOCAL_PACKET,e);this.facade.sendNotification(T.TEST_WEBSOCKET_PROTOCAL,[e.replyName,e.data]);if(e.repeatTimes===1){return a.COMPLETE}e.repeatTimes--;e.waitCount=0;delete e.createTime;return a.SUSPEND};e.prototype.$notifyStatePacket=function(e){var t={name:e.connName,state:n.DISCONNECTED};this.facade.sendNotification(T.GET_WEBSOCKET_INFO,t);if(t.state===n.DISCONNECTED){return a.NOT_YET}if(this.$notYet(e)===true){return a.NOT_YET}if(t.state===n.CONNECTING){suncom.Test.assertTrue(e.state===r.CONNECTED||e.state===r.ERROR,"当前网络正在连接，仅允许下行CONNECTED或ERROR状态")}else if(t.state===n.CONNECTED){suncom.Test.assertTrue(e.state===r.CLOSE||e.state===r.ERROR,"当前网络己连接，仅允许下行CLOSE或ERROR状态")}this.facade.sendNotification(T.TEST_WEBSOCKET_STATE,e.state);return a.COMPLETE|a.SUSPEND};e.prototype.$notYet=function(e){if(e.waitName!==null&&e.waitCount<e.waitTimes){return true}if(e.createTime===void 0){e.createTime=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM)}if(e.createTime+e.delay>suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM)){return true}if(e.asNewMsg===true&&e.createTime===suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM)){return true}return false};e.prototype.$doClick=function(e){if(e.actTime===void 0){if($.buttonMap[e.id]===void 0){return a.NOT_YET}e.actTime=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM);this.facade.sendNotification(T.DO_CLICK,e);return a.NONE}else if(e.done===true){return a.COMPLETE}else{return a.NOT_YET}};e.prototype.$doEmit=function(e){if(e.done===true){return a.COMPLETE}if(e.actTime===void 0){e.actTime=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM);this.facade.sendNotification(T.DO_EMIT,e)}else{return a.NOT_YET}return a.NONE};e.prototype.$doWait=function(e){if(e.done===true){return a.COMPLETE}if(e.actTime===void 0){e.actTime=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM);this.$addWait(e)}else{return a.NOT_YET}return a.NONE};return e}(suncore.BaseService);e.MicroService=t;var h=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){if(e.data===null){return}for(var t=0;t<e.hashFileds.length;t++){this.$setFieldValue(e.data,e.hashFileds[t],suncom.Common.createHashId())}for(var t=0;t<e.timeFields.length;t++){var n=e.timeFields[t];var r=(new Date).valueOf()+$.timeDiff+n.arg1;this.$setFieldValue(e.data,n.arg2,dcodeIO.Long.fromNumber(r))}};t.prototype.$setFieldValue=function(e,t,n){var r=t.split(".");while(r.length>1){e=e[r.shift()]}e[r.shift()]=n};return t}(puremvc.SimpleCommand);e.PrepareProtocalPacketCommand=h;var p=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,n){suncom.Test.expect(t).anything();suncom.Test.expect($.buttonMap[e]).toBeUndefined();var r={button:t,once:n};$.buttonMap[e]=r};return t}(puremvc.SimpleCommand);e.RegButtonCommand=p;var m=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$initializePacket=function(e){if(e.delay===void 0){e.delay=0}if(e.connName===void 0){e.connName="default"}if(e.asNewMsg===void 0){e.asNewMsg=true}if(e.waitName===void 0){e.waitName=null}if(e.waitTimes===void 0){e.waitTimes=1}e.waitCount=0;suncom.Test.expect(e.delay).interpret("消息下行延时必须大于或等于0").toBeGreaterOrEqualThan(0);suncom.Test.expect(e.waitTimes).interpret("消息上行等待次数必须大于0").toBeGreaterThan(0)};t.prototype.$initializePacketDefaultValue=function(e,t,n){if(t===void 0){t=[]}if(n===void 0){n=[]}if(e.data===null){return}e.hashFileds=n;e.timeFields=[];for(var r=0;r<t.length;r++){var o=this.$getFieldValue(e.data,t[r],0);e.timeFields.push({arg1:o,arg2:t[r]})}};t.prototype.$getFieldValue=function(e,t,n){var r=t.split(".");while(r.length>0){e=e[r.shift()]}return e===void 0?n:e};return t}(puremvc.SimpleCommand);e.SerializeWebSocketPacketCommand=m;var E=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,n){this.$initializePacket(e);if(e.data===void 0){e.data=null}if(e.replyName===void 0){e.replyName=null}if(e.repeatTimes===void 0){e.repeatTimes=1}this.$initializePacketDefaultValue(e,t,n);suncom.Test.expect(e.repeatTimes).interpret("消息的下行次数必须大于或等于1").toBeGreaterOrEqualThan(1);this.facade.sendNotification(T.ADD_ACTION,[s.WS_PROTOCAL,e])};return t}(m);e.SerializeWebSocketProtocalPacketCommand=E;var y=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){this.$initializePacket(e);suncom.Test.expect(e.state).interpret("必须指定WebSocket状态包的状态值").not.toBeUndefined();this.facade.sendNotification(T.ADD_ACTION,[s.WS_STATE,e])};return t}(m);e.SerializeWebSocketStatePacketCommand=y;var v=function(n){__extends(e,n);function e(e){var t=n.call(this,0)||this;t.$status=u.PREPARE;t.$caseId=e;$.currentTestCase=t;suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,suncom.Handler.create(t,t.$doPrepare));return t}e.prototype.done=function(){this.$afterAll();this.$status=u.FINISH};e.prototype.$doPrepare=function(){this.$status=u.EXECUTE;this.$beforeAll()};e.prototype.$addTest=function(e,t,n){if(n===void 0){n=o.APPEND}var r={tcId:e,taskCls:t};if(n===o.APPEND){$.tccQueue.push(r)}else{$.tccQueue.unshift(r)}};e.prototype.$describe=function(e){suncom.Logger.log(suncom.DebugMode.TDD,e)};e.prototype.$beforeAll=function(){};e.prototype.$afterAll=function(){};e.prototype.$emit=function(e,t,n){if(n===void 0){n=0}this.facade.sendNotification(T.EMIT,[e,t,true,n])};e.prototype.$wait=function(e,t,n,r){if(t===void 0){t=null}if(n===void 0){n=true}if(r===void 0){r=true}if(n===true){r=true}else{suncom.Test.expect(t).interpret("当参数line为false时必须指定handler").toBeInstanceOf(suncom.Handler)}this.facade.sendNotification(T.WAIT,[e,t,n,r])};e.prototype.$click=function(e){this.facade.sendNotification(T.CLICK,e)};e.prototype.$cancel=function(e){this.facade.sendNotification(T.CANCEL,e)};e.prototype.$serializeWebSocketStatePacket=function(e){this.facade.sendNotification(T.SERIALIZE_WEBSOCKET_STATE_PACKET,e)};e.prototype.$serializeWebSocketProtocalPacket=function(e,t,n,r){e.data=t;this.facade.sendNotification(T.SERIALIZE_WEBSOCKET_PROTOCAL_PACKET,[e,n,r])};Object.defineProperty(e.prototype,"status",{get:function(){return this.$status},enumerable:true,configurable:true});return e}(puremvc.Notifier);e.TestCase=v;var g=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,n,r){var o={id:e,handler:t,line:n,once:r};if(n===true){this.facade.sendNotification(T.ADD_ACTION,[s.SIGNAL_WAIT,o])}else{this.facade.sendNotification(T.ADD_WAIT,o)}};return t}(puremvc.SimpleCommand);e.WaitCommand=g;var $;(function(e){e.timeDiff=0;e.currentSignalId=0;e.currentTestCase=null;e.tccQueue=[];e.waitMap={};e.buttonMap={}})($=e.M||(e.M={}));var T;(function(e){e.EMIT="suntdd.NotifyKey.EMIT";e.WAIT="suntdd.NotifyKey.WAIT";e.DO_EMIT="suntdd.NotifyKey.DO_EMIT";e.CANCEL="suntdd.NotifyKey.CANCEL";e.CLICK="suntdd.NotifyKey.CLICK";e.DO_CLICK="suntdd.NotifyKey.DO_CLICK";e.REG_BUTTON="suntdd.NotifyKey.REG_BUTTON";e.ADD_WAIT="suntdd.NotifyKey.ADD_WAIT";e.ADD_ACTION="suntdd.NotifyKey.ADD_ACTION";e.GET_WEBSOCKET_INFO="suntdd.NotifyKey.GET_WEBSOCKET_INFO";e.TEST_WEBSOCKET_STATE="suntdd.NotifyKey.TEST_WEBSOCKET_STATE";e.TEST_WEBSOCKET_PROTOCAL="suntdd.NotifyKey.TEST_WEBSOCKET_PROTOCAL";e.TEST_WEBSOCKET_SEND_DATA="suntdd.NotifyKey.TEST_WEBSOCKET_SEND_DATA";e.PREPARE_PROTOCAL_PACKET="suntdd.NotifyKey.PREPARE_PROTOCAL_PACKET";e.SERIALIZE_WEBSOCKET_STATE_PACKET="suntdd.NotifyKey.SERIALIZE_WEBSOCKET_STATE_PACKET";e.SERIALIZE_WEBSOCKET_PROTOCAL_PACKET="suntdd.NotifyKey.SERIALIZE_WEBSOCKET_PROTOCAL_PACKET"})(T=e.NotifyKey||(e.NotifyKey={}));var S;(function(e){function t(e,t,n){if(n===void 0){n=0}puremvc.Facade.getInstance().sendNotification(T.EMIT,[e,t,false,n])}e.emit=t;function n(e,t,n){if(n===void 0){n=true}puremvc.Facade.getInstance().sendNotification(T.REG_BUTTON,[e,t,n])}e.regButton=n})(S=e.Test||(e.Test={}))})(suntdd||(suntdd={}));var sunui;(function(n){var i;(function(e){e[e["NONE"]=0]="NONE";e[e["YES"]=1]="YES";e[e["NO"]=2]="NO";e[e["CANCEL"]=3]="CANCEL"})(i=n.ConfirmOptionValueEnum||(n.ConfirmOptionValueEnum={}));var l;(function(e){e[e["NONE"]=0]="NONE";e[e["SIMPLY"]=1]="SIMPLY";e[e["TRANSPARENT"]=2]="TRANSPARENT";e[e["MOUSE_THROUGH"]=4]="MOUSE_THROUGH";e[e["SYNC_FADE_TIME"]=8]="SYNC_FADE_TIME"})(l=n.PopupFlagEnum||(n.PopupFlagEnum={}));var t;(function(e){e[e["NONE"]=0]="NONE";e[e["HIGH"]=131072]="HIGH";e[e["MID"]=32768]="MID";e[e["LOW"]=8192]="LOW"})(t=n.ResourceDownloadSpeedEnum||(n.ResourceDownloadSpeedEnum={}));var u;(function(e){e[e["AUTO"]=16]="AUTO";e[e["CONFIRM"]=32]="CONFIRM";e[e["TERMINATE"]=64]="TERMINATE"})(u=n.RetryMethodEnum||(n.RetryMethodEnum={}));var c;(function(e){e[e["NONE"]=0]="NONE";e[e["BACKGROUND"]=1]="BACKGROUND";e[e["SCENE"]=2]="SCENE";e[e["PANEL"]=3]="PANEL";e[e["FLOAT"]=4]="FLOAT";e[e["GOLD_TIPS"]=5]="GOLD_TIPS";e[e["HIGH_GOLD_TIPS"]=6]="HIGH_GOLD_TIPS";e[e["NOTICE"]=7]="NOTICE";e[e["BIGWINNER"]=8]="BIGWINNER";e[e["MINI_GAME"]=9]="MINI_GAME";e[e["POPUP"]=10]="POPUP";e[e["WAITINGBOX"]=11]="WAITINGBOX";e[e["LOADING"]=12]="LOADING";e[e["LAMP_TIPS"]=13]="LAMP_TIPS";e[e["TIPS"]=14]="TIPS";e[e["TOP"]=15]="TOP";e[e["DEBUG"]=16]="DEBUG"})(c=n.UILevel||(n.UILevel={}));var e=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$makeProps=function(e){if(e.x===void 0&&e.left===void 0&&e.right===void 0){e.centerX=0}if(e.y===void 0&&e.top===void 0&&e.bottom===void 0){e.centerY=0}};t.prototype.$applyShowProps=function(e,t,n){if(t.x!==void 0){e.x=t.x}if(t.y!==void 0){e.y=t.y}if(t.centerX!==void 0){e.centerX=t.centerX}if(t.centerY!==void 0){e.centerY=t.centerY}if(n===0||t.flags&l.SIMPLY){if(t.left!==void 0){e.left=t.left}if(t.right!==void 0){e.right=t.right}if(t.top!==void 0){e.top=t.top}if(t.bottom!==void 0){e.bottom=t.bottom}if(t.scaleX!==void 0){e.scaleX=t.scaleX}if(t.scaleY!==void 0){e.scaleY=t.scaleY}}else{if(t.left!==void 0){e.left=-e.width}if(t.right!==void 0){e.right=-e.width}if(t.top!==void 0){e.top=-e.height}if(t.bottom!==void 0){e.bottom=-e.height}if(t.left===void 0&&t.right===void 0&&t.top===void 0&&t.bottom===void 0){e.alpha=0;e.scaleX=0;e.scaleY=0;t.alpha=1;if(t.scaleX===void 0){t.scaleX=1}if(t.scaleY===void 0){t.scaleY=1}}N.get(e,t.mod).to(t,n,t.ease)}};t.prototype.$applyCloseProps=function(e,t,n){if(n>0&&(t.flags&l.SIMPLY)===l.NONE){if(t.left!==void 0){t.left=-e.width}if(t.right!==void 0){t.right=-e.width}if(t.top!==void 0){t.top=-e.height}if(t.bottom!==void 0){t.bottom=-e.height}if(t.left===void 0&&t.right===void 0&&t.top===void 0&&t.bottom===void 0){t.alpha=0;t.scaleX=0;t.scaleY=0}N.get(e,t.mod).to(t,n)}};return t}(puremvc.SimpleCommand);n.AbstractPopupCommand=e;var r=function(r){__extends(e,r);function e(e,t){var n=r.call(this)||this;n.$info=null;n.$info=e;n.$data=t;return n}return e}(suncore.AbstractTask);n.AbstractSceneTask=r;var o=function(r){__extends(e,r);function e(e,t){var n=r.call(this)||this;n.$loading=false;n.$complete=null;n.$url=null;n.$loaders=[];n.$doneCount=0;n.$url=e;n.$complete=t;G.lock(n.$url);return n}e.prototype.destroy=function(){if(this.$destroyed===true){return}r.prototype.destroy.call(this);for(var e=0;e<this.$loaders.length;e++){this.$loaders[e].destroy()}G.unlock(this.$url)};e.prototype.load=function(){if(this.$loading===false&&this.$destroyed===false){this.$loading=true;this.$doLoad()}};e.prototype.$loadAssets=function(e){this.$doneCount=this.$loaders.length;for(var t=0;t<e.length;t++){this.$loaders.push(new L(e[t],suncom.Handler.create(this,this.$onLoadAsset)))}};e.prototype.$onLoadAsset=function(e){if(e===false){this.$onAssetsLoaded(false)}else{this.$doneCount++;if(this.$doneCount===this.$loaders.length){this.$onAssetsLoaded(true)}}};e.prototype.$onComplete=function(e){if(this.$destroyed===false){this.$complete.runWith(e)}this.destroy();this.$loading=false};return e}(puremvc.Notifier);n.AssetLoader=o;var f=function(r){__extends(e,r);function e(e,t){var n=r.call(this)||this;n.$url=null;n.$complete=null;n.$loader=null;n.$retryer=new E(u.TERMINATE,suncom.Handler.create(n,n.$onRetryConfirmed),"资源加载失败，点击确定重新尝试！");G.lock(e);n.$url=e;n.$complete=t;n.$doLoad();return n}e.prototype.destroy=function(){if(this.$destroyed===true){return}r.prototype.destroy.call(this);this.$retryer.cancel();this.$loader!==null&&this.$loader.destroy();G.unlock(this.$url)};e.prototype.$doLoad=function(){var e=suncom.Handler.create(this,this.$onLoad);if(G.isRes3dUrl(this.$url)===true){this.$loader=new p(this.$url,e)}else if(suncom.Common.getFileExtension(this.$url)==="sk"){this.$loader=new T(this.$url,e)}else{this.$loader=new M(this.$url,e)}this.$loader.load()};e.prototype.$onLoad=function(e){if(e===true){this.$complete.runWith(this.$url)}else{this.$retryer.run(1e3,suncom.Handler.create(this,this.$doLoad),2)}this.$loader=null};e.prototype.$onRetryConfirmed=function(e){if(e===i.NO){this.$retryer.reset();suncom.Logger.warn(suncom.DebugMode.ANY,"失败："+this.$url);this.facade.sendNotification(Y.ON_ASSET_SAFETY_LOADER_FAILED);this.facade.registerObserver(Y.ASSET_SAFETY_LOADER_RETRY,this.$onAssetSafetyLoaderRetry,this,true)}else{this.facade.sendNotification(suncore.NotifyKey.SHUTDOWN)}};e.prototype.$onAssetSafetyLoaderRetry=function(){if(this.$destroyed===false){suncom.Logger.warn(suncom.DebugMode.ANY,"重试："+this.$url);this.$doLoad()}};Object.defineProperty(e.prototype,"complete",{get:function(){return this.$complete},enumerable:true,configurable:true});return e}(puremvc.Notifier);n.AssetSafetyLoader=f;var s=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,n){var r=B.viewLayer.getInfoByView(e);if(r===null){suncom.Logger.error(suncom.DebugMode.ANY,e+"["+(e&&e.name)+"]'s infomation is not exist.");return}if(n!==void 0){r.keepNode=!n}if(r.closed===true){return}r.closed=true;B.viewLayer.onViewClose(e);this.facade.sendNotification(Y.ON_POPUP_CLOSED,e);if((r.props.flags&l.TRANSPARENT)===l.NONE){var o=N.get(r.mask,r.props.mod);if(t>200&&(r.props.flags&l.SYNC_FADE_TIME)===l.NONE){o.wait(t-200).to({alpha:0},200)}else{o.to({alpha:0},t)}}this.$applyCloseProps(e,r.props,t);var i=suncom.Handler.create(this,this.$onCloseFinish,[e]);suncore.System.addTrigger(r.props.mod,t,i)};t.prototype.$onCloseFinish=function(e){B.viewLayer.removeStackInfoByView(e)};return t}(e);n.ClosePopupCommand=s;var a=function(r){__extends(e,r);function e(e,t){var n=r.call(this)||this;n.$relieved=false;n.$command=e;n.$condition=t;n.facade.registerObserver(e,n.$onCommandCallback,n,false,suncom.EventPriorityEnum.HIGHEST);return n}e.prototype.destroy=function(){if(this.$destroyed===true){return}r.prototype.destroy.call(this);this.facade.removeObserver(this.$command,this.$onCommandCallback,this)};Object.defineProperty(e.prototype,"command",{get:function(){return this.$command},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"relieved",{get:function(){return this.$relieved},enumerable:true,configurable:true});return e}(puremvc.Notifier);n.GUILogicInterceptor=a;var d=function(n){__extends(e,n);function e(e){if(e===void 0){e=true}var t=n.call(this)||this;t.$hashId=suncom.Common.createHashId();t.$timerId=0;t.$commands=[];t.$autoDestroy=false;t.$autoDestroy=e;t.facade.registerObserver(Y.NEXT_LOGIC_COMMAND,t.$onNextLogicCommand,t);t.facade.registerObserver(Y.DESTROY_LOGIC_RUNNABLE,t.$onDestroyLogicRunnable,t);t.facade.registerObserver(Y.DESTROY_ALL_LOGIC_RUNNABLE,t.$onDestroyAllLogicRunnable,t);return t}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);this.facade.removeObserver(Y.NEXT_LOGIC_COMMAND,this.$onNextLogicCommand,this);this.facade.removeObserver(Y.DESTROY_LOGIC_RUNNABLE,this.$onDestroyAllLogicRunnable,this);this.facade.removeObserver(Y.DESTROY_ALL_LOGIC_RUNNABLE,this.$onDestroyAllLogicRunnable,this);for(var e=0;e<this.$commands.length;e++){this.$commands[e].destroy()}};e.prototype.$onDestroyAllLogicRunnable=function(){this.destroy()};e.prototype.$onDestroyLogicRunnable=function(e){if(this.$autoDestroy===false&&this.$hashId===e){this.destroy()}};e.prototype.$onNextLogicCommand=function(e){var t=-1;for(var n=0;n<this.$commands.length;n++){if(this.$commands[n]===e){t=n;break}}if(t===-1){return}t++;this.facade.notifyCancel();if(t<this.$commands.length){var r=this.$commands[t];if(r.running===false){r.run()}}else if(this.$autoDestroy===true){this.destroy()}};e.prototype.$addCommand=function(e,t,n){this.$commands.push(new x(e,t,n));if(this.$commands[0].running===false){this.$commands[0].run()}};Object.defineProperty(e.prototype,"hashId",{get:function(){return this.$hashId},enumerable:true,configurable:true});return e}(puremvc.Notifier);n.GUILogicRunnable=d;var h=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){for(var t=0;t<e.length;t++){var n=e[t];k.regScene(n)}};return t}(puremvc.SimpleCommand);n.RegisterScenesCommand=h;var p=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){var e=G.getRes3dJsonUrl(this.$url);var t=Laya.loader.getRes(this.$url)===void 0?false:true;if(suncom.Common.getFileExtension(this.$url)==="ls"||t===true){this.$loadAssets([e])}else{this.$loaders.push(new L(e,suncom.Handler.create(this,this.$onUrlLoaded)))}};t.prototype.$onUrlLoaded=function(e,t){if(e===true){var n=B.cacheMap[this.$url]||null;if(n===null){this.$loadAssets([this.$url])}else{this.$onAssetsLoaded(true)}}else{this.$onComplete(false)}};t.prototype.$onAssetsLoaded=function(e){if(suncom.Common.getFileExtension(this.$url)==="ls"){this.$onComplete(e)}else{var t=B.cacheMap[this.$url]||null;if(t===null){t=B.cacheMap[this.$url]=Laya.loader.getRes(this.$url)}this.$onComplete(e)}};return t}(o);n.Res3dLoader=p;var m=function(t){__extends(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.$undoList=[];e.$loadingList=[];e.$isRetryPrompting=false;return e}r.prototype.$onRun=function(){this.facade.registerObserver(Y.ON_URL_SAFETY_LOADER_CREATED,this.$onUrlSafetyLoaderCreated,this);this.facade.registerObserver(Y.ON_URL_SAFETY_LOADER_COMPLETE,this.$onUrlSafetyLoaderComplete,this);this.facade.registerObserver(Y.ON_ASSET_SAFETY_LOADER_FAILED,this.$onAssetSafetyLoaderFailed,this)};r.prototype.$onStop=function(){this.facade.removeObserver(Y.ON_URL_SAFETY_LOADER_CREATED,this.$onUrlSafetyLoaderCreated,this);this.facade.removeObserver(Y.ON_URL_SAFETY_LOADER_COMPLETE,this.$onUrlSafetyLoaderComplete,this);this.facade.removeObserver(Y.ON_ASSET_SAFETY_LOADER_FAILED,this.$onAssetSafetyLoaderFailed,this)};r.prototype.$onUrlSafetyLoaderCreated=function(e){this.$undoList.unshift(e);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"create loader for url "+e.url+", loading list length:"+this.$loadingList.length+", undo list length:"+this.$undoList.length)}this.$next()};r.prototype.$onUrlSafetyLoaderComplete=function(e){var t=this.$loadingList.indexOf(e);suncom.Test.expect(t).toBeGreaterOrEqualThan(0);this.$loadingList.splice(t,1);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"remove loader for url "+e.url+", loading list length:"+this.$loadingList.length+", undo list length:"+this.$undoList.length)}this.$next()};r.prototype.$next=function(){while(this.$undoList.length>0&&this.$loadingList.length<r.MAX_LOAD_COUNT){var e=false;for(var t=this.$undoList.length-1;t>-1;t--){var n=this.$undoList[t];if(n.destroyed===true){this.$undoList.splice(t,1);continue}if(this.$isUrlInLoading(n.url)===true){continue}if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"load next url "+n.url+", loading list length:"+this.$loadingList.length+" + 1")}e=true;n.load();this.$loadingList.push(n);break}if(e===false){break}}};r.prototype.$isUrlInLoading=function(e){for(var t=0;t<this.$loadingList.length;t++){var n=this.$loadingList[t];if(n.url===e){return true}}return false};r.prototype.$onAssetSafetyLoaderFailed=function(){if(this.$isRetryPrompting===false){this.$isRetryPrompting=true;this.facade.sendNotification(Y.RETRY_CONFIRM,[suncore.ModuleEnum.SYSTEM,"资源加载失败，点击确定重新尝试！",[i.YES,"确定",i.NO,"取消"],suncom.Handler.create(this,this.$onRetryConfirmed)])}};r.prototype.$onRetryConfirmed=function(e){if(e===i.YES){this.facade.sendNotification(Y.ASSET_SAFETY_LOADER_RETRY)}else{this.facade.sendNotification(suncore.NotifyKey.SHUTDOWN)}this.$isRetryPrompting=false};r.MAX_LOAD_COUNT=5;return r}(suncore.BaseService);n.ResourceService=m;var E=function(a){__extends(e,a);function e(e,t,n){if(t===void 0){t=null}if(n===void 0){n=null}var r=[];for(var o=3;o<arguments.length;o++){r[o-3]=arguments[o]}var i=a.call(this,suncore.MsgQModEnum.MMI)||this;i.$options=[];i.$currentRetries=0;i.$retryHandler=null;i.$retryTimerId=0;i.$prompting=false;if((e&u.CONFIRM)===u.CONFIRM){i.$method=u.CONFIRM}else if((e&u.TERMINATE)===u.TERMINATE){i.$method=u.TERMINATE}else{i.$method=u.AUTO}var s=e&=15;if(e===suncore.ModuleEnum.CUSTOM||e===suncore.ModuleEnum.TIMELINE){i.$mod=e}else{i.$mod=suncore.ModuleEnum.SYSTEM}i.$prompt=n;i.$options=r;i.$confirmHandler=t;return i}e.prototype.run=function(e,t,n){if(n===void 0){n=2}if(this.$method===u.AUTO||this.$currentRetries<n){if(this.$retryTimerId===0){this.$retryHandler=t;this.$retryTimerId=suncore.System.addTimer(suncore.ModuleEnum.SYSTEM,e,this.$onRetryTimer,this)}else{suncom.Logger.warn(suncom.DebugMode.ANY,"己忽略的重试请求 method:"+suncom.Common.getMethodName(t.method,t.caller)+", caller:"+suncom.Common.getQualifiedClassName(t.caller))}}else{if(this.$prompting===false){this.$prompting=true;if(this.$method===u.TERMINATE){var r=suncom.Handler.create(this,this.$onConfirmReplied,[i.NO]);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,r)}else{var o=suncom.Handler.create(this,this.$onConfirmReplied);this.facade.sendNotification(Y.RETRY_CONFIRM,[this.$mod,this.$prompt,this.$options,o])}}else{suncom.Logger.warn(suncom.DebugMode.ANY,"己忽略的重试的询问请求 prompt:"+this.$prompt)}}};e.prototype.$onConfirmReplied=function(e){if(this.$prompting===true){this.$prompting=false;if(this.$confirmHandler!==null){this.$confirmHandler.runWith(e)}}};e.prototype.$onRetryTimer=function(){this.$retryTimerId=0;this.$currentRetries++;this.$retryHandler.run()};e.prototype.cancel=function(){this.$prompting=false;this.$retryTimerId=suncore.System.removeTimer(this.$retryTimerId)};e.prototype.reset=function(){this.$currentRetries=0};Object.defineProperty(e.prototype,"currentRetries",{get:function(){return this.$currentRetries},enumerable:true,configurable:true});return e}(puremvc.Notifier);n.Retryer=E;var y=function(r){__extends(e,r);function e(e,t){var n=r.call(this,e,t)||this;n.facade.registerObserver(Y.ENTER_SCENE,n.$onEnterScene,n,true,suncom.EventPriorityEnum.EGL);return n}e.prototype.$onEnterScene=function(){};return e}(r);n.SceneIniClass=y;var v=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$ready=true;e.$sceneName=0;e.$scene2d=null;e.$scene3d=null;e.$data=null;e.facade.registerObserver(Y.ENTER_SCENE,e.$onEnterScene,e,false,suncom.EventPriorityEnum.OSL);return e}e.prototype.$enterScene=function(e,t){var n=k.getConfigByName(e);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,suncom.Handler.create(this,this.$beforeLoadScene,[n,t]));suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,suncom.Handler.create(this,this.$loadScene,[n]))};e.prototype.$beforeLoadScene=function(e,t){this.$data=t;this.$sceneName=e.name;this.facade.sendNotification(Y.BEFORE_LOAD_SCENE);e.iniCls&&suncore.System.addTask(suncore.ModuleEnum.SYSTEM,0,new e.iniCls(e,t))};e.prototype.$loadScene=function(e){this.facade.sendNotification(suncore.NotifyKey.START_TIMELINE,[suncore.ModuleEnum.CUSTOM,true]);e.scene3d=e.scene3d||null;this.facade.sendNotification(Y.LOAD_SCENE,e)};e.prototype.$onEnterScene=function(e,t){this.$ready=true;this.$scene2d=e||null;this.$scene3d=t||null;this.facade.sendNotification(suncore.NotifyKey.START_TIMELINE,[suncore.ModuleEnum.CUSTOM,false])};e.prototype.$exitScene=function(){this.facade.sendNotification(Y.EXIT_SCENE,this.$sceneName);this.facade.sendNotification(suncore.NotifyKey.PAUSE_TIMELINE,[suncore.ModuleEnum.CUSTOM,true]);var e=k.getConfigByName(this.$sceneName);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,suncom.Handler.create(this,this.$onLeaveScene,[e]))};e.prototype.$onLeaveScene=function(e){e.uniCls&&suncore.System.addTask(suncore.ModuleEnum.SYSTEM,0,new e.uniCls(e,this.$data));this.facade.sendNotification(Y.DESTROY_ALL_LOGIC_RUNNABLE);this.facade.sendNotification(Y.LEAVE_SCENE);this.facade.sendNotification(Y.UNLOAD_SCENE,[this.$scene2d,this.$scene3d]);e.scene2d!==null&&G.clearResByUrl(e.scene2d);suncore.System.addTask(suncore.ModuleEnum.SYSTEM,0,new suncore.SimpleTask(suncom.Handler.create(this,this.$onExitScene)))};e.prototype.$onExitScene=function(){this.$sceneName=0};e.prototype.enterScene=function(e,t){if(this.$ready===false){return false}this.$ready=false;this.$sceneName!=0&&this.$exitScene();this.$enterScene(e,t);U.addHistory(e,t);return true};e.prototype.exitScene=function(){if(this.$ready===false){return}this.$ready=false;this.$sceneName!=0&&this.$exitScene();U.removeHistory(this.$sceneName);var e=U.getLastestSceneInfo();e!==null&&this.$enterScene(e.name,e.data)};e.prototype.replaceScene=function(e,t){var n=U.getLastestSceneInfo();if(this.enterScene(e,t)===true){n!==null&&U.removeHistory(n.name)}};e.prototype.deleteHistories=function(e){U.deleteHistories(e)};Object.defineProperty(e.prototype,"scene2d",{get:function(){return this.$scene2d},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"scene3d",{get:function(){return this.$scene3d},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sceneName",{get:function(){return this.$ready===false?0:this.$sceneName},enumerable:true,configurable:true});return e}(puremvc.Notifier);n.SceneLayer=v;var g=function(r){__extends(e,r);function e(e,t){var n=r.call(this,e,t)||this;n.facade.registerObserver(Y.LEAVE_SCENE,n.$onLeaveScene,n,true,suncom.EventPriorityEnum.EGL);return n}e.prototype.$onLeaveScene=function(){};return e}(r);n.SceneUniClass=g;var $=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,n){if(B.viewLayer.getInfoByView(e)!==null){suncom.Logger.error(suncom.DebugMode.ANY,e+"["+e.name+"] is already popup.");return}if(n.mod===void 0){n.mod=suncore.ModuleEnum.CUSTOM}if(n.ease===void 0){n.ease=Laya.Ease.backOut}if(n.flags===void 0){n.flags=l.NONE}if(n.keepNode===void 0){n.keepNode=false}var r=n.args;var o=n.level||e.zOrder||c.POPUP;var i=n.keepNode;delete n.args;delete n.level;delete n.keepNode;this.$makeProps(n);if(n.trans===true&&(n.flags&l.TRANSPARENT)===l.NONE){suncom.Logger.warn(suncom.DebugMode.ANY,"ViewFacade：props的trans属性己弃用，请使用flags代替！！！");n.flags|=l.TRANSPARENT}var s=B.viewLayer.createMask(e,n);s.name="Mask$"+e.name;s.zOrder=e.zOrder=o;var a={view:e,mask:s,props:n,closed:false,keepNode:i,displayed:false,duration:t,cancelAllowed:false};B.viewLayer.addToStack(a);B.viewLayer.addChild(s);B.viewLayer.addChild(e);suncom.Test.expect(e["pivot"]).anything();e["pivot"](e.width*.5,e.height*.5);B.viewLayer.onViewCreate(e,r);if((n.flags&l.TRANSPARENT)===l.NONE){if(n.flags&l.SYNC_FADE_TIME){N.get(s,a.props.mod).from({alpha:0},t)}else{N.get(s,a.props.mod).from({alpha:0},t>200?200:t)}}this.$applyShowProps(e,n,t);var u=suncom.Handler.create(this,this.$onPopupFinish,[e]);suncore.System.addTrigger(a.props.mod,t,u)};t.prototype.$onPopupFinish=function(e){var t=B.viewLayer.getInfoByView(e);if(t!==null&&t.closed===false){t.displayed=true;B.viewLayer.onViewOpen(e)}};return t}(e);n.ShowPopupCommand=$;var T=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){this.$loadAssets([this.$url,suncom.Common.replacePathExtension(this.$url,"png")])};t.prototype.$onAssetsLoaded=function(e){if(e===true){var t=B.cacheMap[this.$url]||null;if(t===null){t=B.cacheMap[this.$url]=new Laya.Templet;t.loadAni(this.$url)}var n=suncom.Handler.create(this,this.$onTempletCreated);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,n);G.lock(this.$url)}else{this.$onComplete(false)}};t.prototype.$onTempletCreated=function(){if(this.destroyed===false){var e=B.cacheMap[this.$url];this.$onComplete(true)}G.unlock(this.$url)};return t}(o);n.SkeletonLoader=T;var S=function(a){__extends(e,a);function e(e,t,n){var r=a.call(this)||this;r.$id=0;r.$handler=null;r.$doneList=[];r.$loaders=[];r.$id=e;r.$handler=n;t=G.checkLoadList(t);suncom.Test.expect(t.length).toBeGreaterThan(0);while(t.length>0){var o=t.shift();var i=suncom.Handler.create(r,r.$onResourceCreated);var s=new f(o,i);r.$loaders.push(s)}return r}e.prototype.destroy=function(){if(this.$destroyed===true){return}a.prototype.destroy.call(this);var e=suncom.Handler.create(this,this.$releaseAllResources);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,e)};e.prototype.$onResourceCreated=function(e){this.$doneList.push(e);if(this.$doneList.length<this.$loaders.length){return}if(this.$destroyed===true){return}this.$handler.runWith([this.$id])};e.prototype.$releaseAllResources=function(){for(var e=0;e<this.$loaders.length;e++){this.$loaders[e].destroy()}};return e}(puremvc.Notifier);n.Templet=S;var N=function(r){__extends(n,r);function n(e,t){var n=r.call(this)||this;n.$infos=[];n.$props=null;n.$mod=t;n.$item=e;if(suncore.System.isModuleStopped(t)===false){n.facade.sendNotification(Y.REGISTER_TWEEN_OBJECT,n)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加缓动，但时间轴己停止，mod:"+suncore.ModuleEnum[t])}return n}n.prototype.cancel=function(){this.$props=null;this.$infos.length=0;return this};n.prototype.to=function(e,t,n,r){if(n===void 0){n=null}if(r===void 0){r=null}var o=Object.keys(e);var i=this.$props===null?this.$item:this.$props;this.$createTweenInfo(o,i,e,t,n,e.update||null,r);return this};n.prototype.from=function(e,t,n,r){if(n===void 0){n=null}if(r===void 0){r=null}var o=Object.keys(e);var i=this.$props===null?this.$item:this.$props;this.$createTweenInfo(o,e,i,t,n,e.update||null,r);return this};n.prototype.by=function(e,t,n,r){if(n===void 0){n=null}if(r===void 0){r=null}var o=Object.keys(e);var i=this.$props===null?this.$item:this.$props;for(var s=0;s<o.length;s++){var a=o[s];if(this.$props===null||this.$props[a]===void 0){e[a]+=this.$item[a]}else{e[a]+=i[a]}}this.to(e,t,n,r);return this};n.prototype.$createTweenInfo=function(e,t,n,r,o,i,s){this.$props=this.$props||{};var a=[];for(var u=0;u<e.length;u++){var l=e[u];if(l==="update"){continue}var c={prop:l,from:t[l],to:n[l]};if(c.from===void 0){c.from=this.$item[l]}a.push(c);this.$props[l]=n[l];if(this.$infos.length===0){this.$item[c.prop]=c.from}}var f={ease:o,actions:a,update:i,handler:s,time:suncore.System.getModuleTimestamp(this.$mod),duration:r};this.$infos.push(f)};n.prototype.wait=function(e,t){if(t===void 0){t=null}var n={ease:null,actions:[],update:null,handler:t,time:suncore.System.getModuleTimestamp(this.$mod),duration:e};this.$infos.push(n);return this};n.prototype.doAction=function(){var e=suncore.System.getModuleTimestamp(this.$mod);var t=this.$infos[0];if(this.$item.destroyed===true){this.cancel();return 0}var n=false;var r=0;var o=e-t.time;if(o>t.duration){n=true;r=o-t.duration;o=t.duration}var i=t.ease||this.$easeNone;for(var s=0;s<t.actions.length;s++){var a=t.actions[s];if(n===true){this.$item[a.prop]=a.to}else{this.$item[a.prop]=i(o,a.from,a.to-a.from,t.duration)}}if(t.update!==null){t.update.run()}if(n===false){return 0}this.$infos.shift();if(this.$infos.length>0){this.$infos[0].time=suncore.System.getModuleTimestamp(this.$mod)}t.handler!==null&&t.handler.run();return r};n.prototype.$easeNone=function(e,t,n,r){var o=e/r;if(o>1){o=1}return o*n+t};Object.defineProperty(n.prototype,"mod",{get:function(){return this.$mod},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"canceled",{get:function(){return this.$infos.length===0},enumerable:true,configurable:true});n.get=function(e,t){if(t===void 0){t=suncore.ModuleEnum.CUSTOM}return new n(e,t)};return n}(puremvc.Notifier);n.Tween=N;var C=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$tweens=[false];return e}e.prototype.$onRun=function(){this.facade.registerObserver(Y.REGISTER_TWEEN_OBJECT,this.$onAddTweenObject,this);this.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this,false,suncom.EventPriorityEnum.EGL);this.facade.registerObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onTimelinePause,this,false,suncom.EventPriorityEnum.EGL)};e.prototype.$onStop=function(){this.facade.removeObserver(Y.REGISTER_TWEEN_OBJECT,this.$onAddTweenObject,this);this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this);this.facade.removeObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onTimelinePause,this)};e.prototype.$onEnterFrame=function(){this.$tweens[0]=true;var e=this.$tweens;for(var t=suncore.ModuleEnum.MIN;t<suncore.ModuleEnum.MAX;t++){if(suncore.System.isModulePaused(t)===false){var n=e.length;for(var r=0;r<n;r++){var o=e[r];if(o.mod===t){var i=1;while(i>0&&o.canceled===false){i=o.doAction()}}}}}for(var r=this.$tweens.length-1;r>0;r--){var o=this.$tweens[r];if(o.canceled===true){e.splice(r,1)}}this.$tweens[0]=false};e.prototype.$onTimelinePause=function(e,t){if(t===true){for(var n=1;n<this.$tweens.length;n++){var r=this.$tweens[n];if(r.mod===e){r.cancel()}}}};e.prototype.$onAddTweenObject=function(e){if(this.$tweens[0]===true){this.$tweens=this.$tweens.slice(0);this.$tweens[0]=false}this.$tweens.push(e)};return e}(suncore.BaseService);n.TweenService=C;var _=function(t){__extends(e,t);function e(){var e=t.call(this)||this;B.sceneLayer=new v;if(Laya.Scene3D===void 0){B.viewLayer=new D}else{B.viewLayer=new P}suncom.DBService.put(-1,new C).run();suncom.DBService.put(-1,new m).run();e.facade.registerCommand(Y.SHOW_POPUP,$,suncom.EventPriorityEnum.OSL);e.facade.registerCommand(Y.CLOSE_POPUP,s,suncom.EventPriorityEnum.OSL);return e}e.getInstance=function(){if(e.$inst===null){e.$inst=new e}return e.$inst};e.prototype.enterScene=function(e,t){puremvc.MutexLocker.backup(this);B.sceneLayer.enterScene(e,t);puremvc.MutexLocker.restore()};e.prototype.exitScene=function(){puremvc.MutexLocker.backup(this);B.sceneLayer.exitScene();puremvc.MutexLocker.restore()};e.prototype.replaceScene=function(e,t){puremvc.MutexLocker.backup(this);B.sceneLayer.replaceScene(e,t);puremvc.MutexLocker.restore()};e.prototype.deleteHistories=function(e){B.sceneLayer.deleteHistories(e)};e.prototype.removeView=function(e){B.viewLayer.removeStackInfoByView(e)};Object.defineProperty(e.prototype,"scene2d",{get:function(){return B.sceneLayer.scene2d},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"scene3d",{get:function(){return B.sceneLayer.scene3d},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sceneName",{get:function(){return B.sceneLayer.sceneName},enumerable:true,configurable:true});e.$inst=null;return e}(puremvc.Notifier);n.UIManager=_;var O=function(r){__extends(e,r);function e(e,t){var n=r.call(this)||this;n.$url=null;n.$data=null;n.$handler=null;n.$totalSize=0;n.$currentSize=0;n.$priority=0;n.$url=e;n.$handler=t;n.$priority=suncom.Mathf.random(0,6);if(Laya.loader.getRes(e)!==void 0){n.$totalSize=-1}B.downloadLimiters.push(n);return n}e.prototype.destroy=function(){if(this.$destroyed===true){return}r.prototype.destroy.call(this);var e=B.downloadLimiters.indexOf(this);if(e<0){throw Error("加载限制器不存在：index:"+e)}B.downloadLimiters.splice(e,1);this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)};e.prototype.updateDownloadSize=function(e){if(e===null||this.$totalSize===-1){this.$totalSize=1}else if(suncom.Common.getFileExtension(this.$url)==="atlas"){var t=Laya.loader.getRes(suncom.Common.replacePathExtension(this.$url,"png"))||null;var n=(t===null?0:t["gpuMemory"])||1;this.$totalSize=n+this.$getStringSize(Laya.loader.getRes(this.$url)||null)}else if(suncom.Common.getFileExtension(this.$url)==="png"||suncom.Common.getFileExtension(this.$url)==="jpg"){var t=Laya.loader.getRes(suncom.Common.replacePathExtension(this.$url,"png"))||null;this.$totalSize=(t===null?0:t.bitmap["gpuMemory"])||1}else if(suncom.Common.getFileExtension(this.$url)==="json"){this.$totalSize=this.$getStringSize(Laya.loader.getRes(this.$url)||null)}else if(suncom.Common.getFileExtension(this.$url)==="sk"){var r=e;this.$totalSize=r.byteLength}else if(suncom.Common.getFileExtension(this.$url)==="lh"){var o=Laya.loader.getRes(suncom.Common.replacePathExtension(this.$url,"json"));var i=G.getAssetUrlsByRes3dJson(o);for(var s=0;s<i.length;s++){var a=i[s];var u=Laya.loader.getRes(a)||null;if(u["gpuMemory"]>0){this.$totalSize+=u["gpuMemory"]}else{try{this.$totalSize+=this.$getStringSize(u)}catch(e){this.$totalSize+=1}}}}else{this.$totalSize=1}this.$data=e;this.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)};e.prototype.$onEnterFrame=function(){this.$currentSize+=this.$getDowloadSpeed()*(10-this.$priority)/10;if(this.$totalSize>0&&this.$currentSize>this.$totalSize){suncom.Logger.log(suncom.DebugMode.DEBUG,"[100%] "+this.$url+":{"+this.$currentSize+":"+this.$totalSize+"}");this.$handler.runWith(this.$data);this.destroy()}else{if(this.$totalSize>0){suncom.Logger.log(suncom.DebugMode.DEBUG,"["+Math.floor(this.$currentSize/this.$totalSize*100)+"%] "+this.$url+":{"+this.$currentSize+":"+this.$totalSize+"}")}else{suncom.Logger.log(suncom.DebugMode.DEBUG,"[0%] "+this.$url+":{"+this.$currentSize+":"+this.$totalSize+"}")}}};e.prototype.$getDowloadSpeed=function(){if(B.downloadLimiters.length<=1){return B.downloadSpeed}else{return B.downloadSpeed/B.downloadLimiters.length}};e.prototype.$getStringSize=function(e){var t=null;var n=0;if(e===null){return 1}if(typeof e==="number"||typeof e==="string"){t=e.toString()}else{t=JSON.stringify(e)}for(var r=0;r<t.length;r++){if(t.charCodeAt(r)<=255){n++}else{n+=2}}return n};return e}(puremvc.Notifier);n.UrlDownloadLimiter=O;var M=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){this.$loadAssets([this.$url])};t.prototype.$onAssetsLoaded=function(e){this.$onComplete(e)};return t}(o);n.UrlLoader=M;var L=function(r){__extends(e,r);function e(e,t){var n=r.call(this)||this;n.$url=null;n.$limiter=null;n.$complete=null;n.$loading=false;n.$url=e;n.$complete=t;n.facade.sendNotification(Y.ON_URL_SAFETY_LOADER_CREATED,n);return n}e.prototype.load=function(){if(this.$loading===false&&this.$destroyed===false){this.$loading=true;F.lock(this.$url);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"load "+this.$url)}if(G.isRes3dUrl(this.$url)===false||G.getRes3dJsonUrl(this.$url)===this.$url){Laya.loader.load(this.$url,Laya.Handler.create(this,this.$onComplete))}else{Laya.loader.create(this.$url,Laya.Handler.create(this,this.$onComplete))}if(B.downloadSpeed!==t.NONE){this.$limiter=new O(this.$url,suncom.Handler.create(this,this.$onDownloaded))}}};e.prototype.$onComplete=function(e){if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"load "+this.$url+" complete")}if(this.$limiter===null){if(this.$destroyed===false){this.$destroyed=true;this.$complete.runWith([e===null?false:true,this.$url])}this.facade.sendNotification(Y.ON_URL_SAFETY_LOADER_COMPLETE,this);F.unlock(this.$url);this.$loading=false}else{this.$limiter.updateDownloadSize(e)}};e.prototype.$onDownloaded=function(e){this.$limiter=null;this.$onComplete(e)};Object.defineProperty(e.prototype,"url",{get:function(){return this.$url},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"destroyed",{get:function(){return this.$destroyed},enumerable:true,configurable:true});return e}(puremvc.Notifier);n.UrlSafetyLoader=L;var b=function(r){__extends(e,r);function e(e,t){var n=r.call(this)||this;n.$closedHandler=null;n.$removedHandler=null;n.$popup=e||null;n.$caller=t||null;if(B.viewLayer.getInfoByView(e)===null){throw Error("找不到"+e.name+"的弹出信息，请确认其为弹出对象")}n.facade.registerObserver(Y.ON_POPUP_CLOSED,n.$onPopupClosed,n,false,suncom.EventPriorityEnum.FWL);n.facade.registerObserver(Y.ON_POPUP_REMOVED,n.$onPopupRemoved,n,false,suncom.EventPriorityEnum.FWL);if(B.viewLayer.getInfoByView(t)!==null){n.facade.registerObserver(Y.ON_POPUP_REMOVED,n.$onCallerDestroy,n,false,suncom.EventPriorityEnum.FWL)}else{n.facade.registerObserver(Y.ON_CALLER_DESTROYED,n.$onCallerDestroy,n,false,suncom.EventPriorityEnum.FWL)}n.facade.registerObserver(Y.LEAVE_SCENE,n.$onLeaveScene,n,false,suncom.EventPriorityEnum.OSL);return n}e.prototype.$onLeaveScene=function(){this.facade.removeObserver(Y.ON_POPUP_CLOSED,this.$onPopupClosed,this);this.facade.removeObserver(Y.ON_POPUP_REMOVED,this.$onPopupRemoved,this);this.facade.removeObserver(Y.LEAVE_SCENE,this.$onCallerDestroy,this);this.facade.removeObserver(Y.ON_POPUP_REMOVED,this.$onCallerDestroy,this);this.facade.removeObserver(Y.ON_CALLER_DESTROYED,this.$onCallerDestroy,this)};e.prototype.$onCallerDestroy=function(e){if(e===this.$caller){this.$onLeaveScene()}};e.prototype.$onPopupClosed=function(e){if(e===this.$popup){if(this.$closedHandler!==null){this.$closedHandler.run();this.$closedHandler=null}}};e.prototype.$onPopupRemoved=function(e){if(e===this.$popup){if(this.$removedHandler!==null){this.$removedHandler.run();this.$removedHandler=null}this.$onCallerDestroy(this.$caller)}};e.prototype.onPopupClosed=function(e,t,n){if(this.$caller!==t){throw Error("caller与执行者不一致")}if(this.$closedHandler===null){this.$closedHandler=suncom.Handler.create(t,e,n)}else{throw Error("重复注册弹框关闭事件")}return this};e.prototype.onPopupRemoved=function(e,t,n){if(this.$caller!==t){throw Error("caller与执行者不一致")}if(this.$removedHandler===null){this.$removedHandler=suncom.Handler.create(t,e,n)}else{throw Error("重复注册弹框移除事件")}return this};return e}(puremvc.Notifier);n.ViewContact=b;var I=function(r){__extends(e,r);function e(e,t){var n=r.call(this)||this;n.$info=null;n.$view=e;if(n.info!==null){n.$duration=n.info.duration}else if(t===void 0){n.$duration=200}else{n.$duration=t}return n}e.prototype.popup=function(e){if(e===void 0){e={}}this.facade.sendNotification(Y.SHOW_POPUP,[this.$view,this.$duration,e]);return this};e.prototype.close=function(e){this.facade.sendNotification(Y.CLOSE_POPUP,[this.$view,this.$duration,e])};Object.defineProperty(e.prototype,"cancelAllowed",{get:function(){return this.info.cancelAllowed},set:function(e){this.info.cancelAllowed=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"info",{get:function(){if(this.$info===null){this.$info=B.viewLayer.getInfoByView(this.$view)}return this.$info},enumerable:true,configurable:true});return e}(puremvc.Notifier);n.ViewFacade=I;var R=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$stack=[];e.facade.registerObserver(Y.UNLOAD_SCENE,e.$onUnloadScene,e,false,suncom.EventPriorityEnum.EGL);return e}e.prototype.$onUnloadScene=function(){var e=this.$stack.concat();for(var t=e.length-1;t>-1;t--){var n=e[t];if(n.props.mod!==suncore.ModuleEnum.SYSTEM){this.removeStackInfo(n)}}};e.prototype.getInfoByView=function(e){for(var t=0;t<this.$stack.length;t++){var n=this.$stack[t];if(n.view===e){return n}}return null};e.prototype.addToStack=function(e){this.$stack.push(e)};e.prototype.removeStackInfo=function(e){var t=this.$stack.indexOf(e);if(t<0){return}this.$stack.splice(t,1);this.onViewRemove(e.view);this.removeChild(e.view);this.removeChild(e.mask);if(e.keepNode===false){this.destroyView(e.view);this.destroyMask(e.mask)}this.facade.sendNotification(Y.ON_POPUP_REMOVED,e.view)};e.prototype.removeStackInfoByView=function(e){for(var t=0;t<this.$stack.length;t++){var n=this.$stack[t];if(n.view===e){this.removeStackInfo(n);break}}};return e}(puremvc.Notifier);n.ViewLayer=R;var A=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.addChild=function(e){var t=e;if(B.sceneLayer.scene2d===null||e.zOrder>=n.UILevel.LOADING){Laya.stage.addChild(t)}else{B.sceneLayer.scene2d.addChild(t)}};t.prototype.removeChild=function(e){var t=e;var n=t.parent||null;if(n===null){throw Error("无法移除显示对象，因为父节点不存在 "+t.name)}n.removeChild(t)};t.prototype.createMask=function(e,t){var n=new Laya.Image("common/mask_b.png");n.left=n.right=n.top=n.bottom=0;n.sizeGrid="1,1,1,1";if(t.flags&l.TRANSPARENT){n.alpha=0}else{n.alpha=1}if((t.flags&l.MOUSE_THROUGH)===l.NONE){n.mouseThrough=false;n.on(Laya.Event.CLICK,this,this.$onMaskClick,[e])}return n};t.prototype.$onMaskClick=function(e){var t=B.viewLayer.getInfoByView(e);if(t!==null&&t.closed===false&&t.cancelAllowed===true){new I(e).close()}};t.prototype.destroyMask=function(e){e.off(Laya.Event.CLICK,this,this.$onMaskClick);e.destroy()};t.prototype.destroyView=function(e){var t=e;t.destroy()};return t}(R);n.ViewLayerLaya=A;var D=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onViewCreate=function(e,t){var n=e;if(n.$onCreate){if(t instanceof Array===false){n.$onCreate.call(n,t)}else{n.$onCreate.apply(n,t)}}};t.prototype.onViewOpen=function(e){var t=e;if(t.$onOpen){t.$onOpen.call(t)}};t.prototype.onViewClose=function(e){var t=e;if(t.$onClose){t.$onClose.call(t)}};t.prototype.onViewRemove=function(e){var t=e;if(t.$onRemove){t.$onRemove.call(t)}};return t}(A);n.ViewLayerLaya2D=D;var P=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onViewCreate=function(e,t){var n=e.getComponents(Laya.Component)||[];for(var r=0;r<n.length;r++){var o=n[r];if(o.$onCreate){if(t instanceof Array===false){o.$onCreate.call(o,t)}else{o.$onCreate.apply(o,t)}}}};t.prototype.onViewOpen=function(e){var t=e.getComponents(Laya.Component)||[];for(var n=0;n<t.length;n++){var r=t[n];if(r.$onOpen){r.$onOpen.call(r)}}};t.prototype.onViewClose=function(e){var t=e.getComponents(Laya.Component)||[];for(var n=0;n<t.length;n++){var r=t[n];if(r.$onClose){r.$onClose.call(r)}}};t.prototype.onViewRemove=function(e){var t=e.getComponents(Laya.Component)||[];for(var n=0;n<t.length;n++){var r=t[n];if(r.$onRemove){r.$onRemove.call(r)}}};return t}(A);n.ViewLayerLaya3D=P;var x=function(o){__extends(e,o);function e(e,t,n){var r=o.call(this,e,t)||this;r.$dataList=[];r.$running=false;r.$dependencies=n;suncom.Test.expect(n.length).toBeGreaterThan(0);r.facade.registerObserver(Y.ON_INTERCEPTOR_RELIEVED,r.$onInterceptorRelieved,r);return r}e.prototype.destroy=function(){if(this.$destroyed===true){return}o.prototype.destroy.call(this);this.facade.removeObserver(Y.ON_INTERCEPTOR_RELIEVED,this.$onInterceptorRelieved,this)};e.prototype.run=function(){suncom.Test.expect(this.$running).toBe(false);for(var e=0;e<this.$dependencies.length;e++){this.$dependencies[e].active=true}this.$running=true};e.prototype.$onInterceptorRelieved=function(e){if(this.$relieved===true){return}if(this.$dependencies.indexOf(e)<0){return}this.facade.notifyCancel();var t=true;for(var n=0;n<this.$dependencies.length;n++){if(this.$dependencies[n].relieved===false){t=false;break}}if(t===true){var r=suncom.Handler.create(this,this.$onCommandRelieved);suncore.System.addMessage(suncore.ModuleEnum.TIMELINE,suncore.MessagePriorityEnum.PRIORITY_0,r)}};e.prototype.$onCommandRelieved=function(){if(this.$destroyed===false&&this.$relieved===false){this.$relieved=true;this.facade.sendNotification(Y.NEXT_LOGIC_COMMAND,this,true);for(var e=0;e<this.$dataList.length;e++){this.facade.sendNotification(this.$command,this.$dataList[e])}}};e.prototype.$onCommandCallback=function(){if(this.$relieved===true){return}var e=[];for(var t=0;t<arguments.length;t++){e.push(arguments[t])}if(this.$condition.runWith(e)===false){return}this.$relieved=true;for(var t=0;t<this.$dependencies.length;t++){if(this.$dependencies[t].relieved===false){this.$relieved=false;break}}if(this.$relieved===false){this.$dataList.push(e);this.facade.notifyCancel()}};Object.defineProperty(e.prototype,"running",{get:function(){return this.$running},enumerable:true,configurable:true});return e}(a);n.GUILogicCommand=x;var w=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$active=false;return e}e.prototype.$onCommandCallback=function(){if(this.$active===true&&this.$relieved===false){var e=[];for(var t=0;t<arguments.length;t++){e.push(arguments[t])}if(this.$condition.runWith(e)===true){this.$relieved=true;this.facade.sendNotification(Y.ON_INTERCEPTOR_RELIEVED,this,true)}}};Object.defineProperty(e.prototype,"active",{get:function(){return this.$active},set:function(e){this.$active=e},enumerable:true,configurable:true});return e}(a);n.GUILogicDependence=w;var B;(function(e){e.downloadSpeed=t.NONE;e.cacheMap={};e.templets={};e.references={};e.downloadLimiters=[]})(B=n.M||(n.M={}));var Y;(function(e){e.RETRY_CONFIRM="sunui.NotifyKey.RETRY_CONFIRM";e.REGISTER_SCENES="sunui.NotifyKey.REGISTER_SCENES";e.BEFORE_LOAD_SCENE="sunui.NotifyKey.BEFORE_LOAD_SCENE";e.LOAD_SCENE="sunui.NotifyKey.LOAD_SCENE";e.UNLOAD_SCENE="sunui.NotifyKey.UNLOAD_SCENE";e.ENTER_SCENE="sunui.NotifyKey.ENTER_SCENE";e.EXIT_SCENE="sunui.NotifyKey.EXIT_SCENE";e.LEAVE_SCENE="sunui.NotifyKey.LEAVE_SCENE";e.SHOW_POPUP="sunui.NotifyKey.SHOW_POPUP";e.CLOSE_POPUP="sunui.NotifyKey.CLOSE_POPUP";e.ON_POPUP_CLOSED="sunui.NotifyKey.ON_POPUP_CLOSED";e.ON_POPUP_REMOVED="sunui.NotifyKey.ON_POPUP_REMOVED";e.ON_CALLER_DESTROYED="sunui.NotifyKey.ON_CALLER_DESTROYED";e.ON_ASSET_SAFETY_LOADER_FAILED="sunui.NotifyKey.ON_ASSET_SAFETY_LOADER_FAILED";e.ON_URL_SAFETY_LOADER_CREATED="sunui.NotifyKey.ON_URL_SAFETY_LOADER_CREATED";e.ON_URL_SAFETY_LOADER_COMPLETE="sunui.NotifyKey.ON_URL_SAFETY_LOADER_COMPLETE";e.ASSET_SAFETY_LOADER_RETRY="sunui.NotifyKey.ASSET_SAFETY_LOADER_RETRY";e.REGISTER_TWEEN_OBJECT="sunui.NotifyKey.REGISTER_TWEEN_OBJECT";e.NEXT_LOGIC_COMMAND="sunui.NotifyKey.NEXT_LOGIC_COMMAND";e.ON_INTERCEPTOR_RELIEVED="sunui.NotifyKey.ON_INTERCEPTOR_RELIEVED";e.DESTROY_LOGIC_RUNNABLE="sunui.NotifyKey.DESTROY_LOGIC_RUNNABLE";e.DESTROY_ALL_LOGIC_RUNNABLE="sunui.NotifyKey.DESTROY_ALL_LOGIC_RUNNABLE"})(Y=n.NotifyKey||(n.NotifyKey={}));var G;(function(i){i.res3dRoot=null;function e(e){B.downloadSpeed=e}i.setDownloadSpeed=e;function t(e){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){if(i.isRes3dUrl(e)===true&&i.getRes3dJsonUrl(e)===e){return}}var t=suncom.Common.getFileExtension(e);var n=e.substr(0,e.length-t.length);var r=[e];if(t==="sk"||t==="atlas"){r.push(n+"png")}else if(i.isRes3dUrl(e)===true){r.push(n+"json")}for(var o=0;o<r.length;o++){F.lock(r[o])}}i.lock=t;function n(e){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){if(i.isRes3dUrl(e)===true&&i.getRes3dJsonUrl(e)===e){return}}var t=suncom.Common.getFileExtension(e);var n=e.substr(0,e.length-t.length);var r=[e];if(t==="sk"||t==="atlas"){r.push(n+"png")}else if(i.isRes3dUrl(e)===true){r.push(n+"json")}for(var o=0;o<r.length;o++){F.unlock(r[o])}}i.unlock=n;function r(e,t,n){var r=null;if(t===null){r=suncom.Handler.create(null,function(e){})}else{r=suncom.Handler.create(n,t)}var o=suncom.Common.createHashId();B.templets[o]=new S(o,e,r);return o}i.prepare=r;function o(e){var t=B.templets[e]||null;if(t!==null){delete B.templets[e];t.destroy()}return 0}i.release=o;function s(e,t){var n=B.cacheMap[e]||null;if(suncom.Common.getFileExtension(e)==="sk"){return n.buildArmature(t)}else if(i.isRes3dUrl(e)===true){if(n===null){n=B.cacheMap[e]=Laya.loader.getRes(e)}return Laya.Sprite3D.instantiate(n)}else{return Laya.loader.getRes(e)}}i.createSync=s;function a(e){return i.createSync(i.getRes3dUrlByName(e))}i.createRes3dSync=a;function u(e){var t=new Laya.Prefab;t.json=Laya.loader.getRes(e);return t.create()}i.createPrefab=u;function l(e){F.clearResByUrl(e)}i.clearResByUrl=l;function c(e){if(i.res3dRoot===null){throw Error("请先指定3D资源目录：sunui.Resource.res3dRoot=")}return i.res3dRoot+"/LayaScene_"+e+"/Conventional/"}i.getRes3dPackRoot=c;function f(e){return e.indexOf(i.res3dRoot)===0}i.isRes3dUrl=f;function d(e){return suncom.Common.replacePathExtension(e,"json")}i.getRes3dJsonUrl=d;function h(e){if(suncom.Common.getFileExtension(e)===null){e+=".lh"}return i.getRes3dPackRoot(suncom.Common.getFileName(e))+e}i.getRes3dUrlByName=h;function p(e){var t=[];var n=i.getRes3dPackRoot(e.pack);for(var r=0;r<e.files.length;r++){t.push(n+e.files[r])}for(var r=0;r<e.resources.length;r++){t.push(n+e.resources[r])}return t}i.getAssetUrlsByRes3dJson=p;function m(e){i.removeUnnecessaryResources(e,"sk","png","龙骨预加载无需指定PNG资源");i.removeUnnecessaryResources(e,"atlas","png","图集预加载无需指定PNG资源");return i.removeDuplicateResources(e)}i.checkLoadList=m;function E(e){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){var t=[];for(var n=0;n<e.length;n++){var r=e[n];if(t.indexOf(r)===-1){t.push(r)}else{suncom.Logger.error(suncom.DebugMode.ANY,"重复的预加载资源文件 "+r)}}return t}return e}i.removeDuplicateResources=E;function y(e,t,n,r){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){var o=[];for(var i=0;i<e.length;i++){var s=e[i];if(suncom.Common.getFileExtension(s)===t){o.push(s)}}for(var i=0;i<o.length;i++){var s=o[i];var a=s.substring(0,s.length-t.length)+n;do{var u=e.indexOf(a);if(u===-1){break}e.splice(u,1);suncom.Logger.error(suncom.DebugMode.ANY,r+" "+s)}while(true)}}}i.removeUnnecessaryResources=y})(G=n.Resource||(n.Resource={}));var U;(function(e){var r=[];function n(e){for(var t=r.length-1;t>-1;t--){if(r[t].name===e){return t}}return-1}function t(e,t){var n={name:e,data:t};r.push(n)}e.addHistory=t;function o(e){var t=n(e);if(t>-1){r.splice(t,1)}return t>-1}e.removeHistory=o;function i(e){return n(e)>-1}e.hasHistory=i;function s(){if(r.length>0){return r[r.length-1]}return null}e.getLastestSceneInfo=s;function a(e){var t=n(e);if(t>-1){return r[t]}return null}e.getLastestSceneInfoByName=a;function u(e){while(r.length>1&&e>0){r.pop();e--}}e.deleteHistories=u})(U=n.SceneHeap||(n.SceneHeap={}));var k;(function(e){var r=[];function t(e){for(var t=0;t<r.length;t++){if(r[t].name===e.name){throw Error("重复注册场景")}}r.push(e)}e.regScene=t;function n(e){for(var t=0;t<r.length;t++){var n=r[t];if(n.name===e){return n}}throw Error("场景配置不存在")}e.getConfigByName=n})(k=n.SceneManager||(n.SceneManager={}));var F;(function(r){function e(e){var t=B.references[e]||0;if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"reference:"+t+", lock:"+e)}B.references[e]=t+1}r.lock=e;function t(e){var t=B.references[e]||0;if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"reference:"+t+", unlock:"+e)}suncom.Test.expect(t).interpret("尝试解锁不存在的资源 url："+e).toBeGreaterThan(0);if(t>1){B.references[e]=t-1}else{delete B.references[e];o(e)}}r.unlock=t;function n(e){if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"clearResUrl:"+e)}var t=B.cacheMap[e]||null;if(t!==null){t.dispose&&t.dispose();t.destroy&&t.destroy();delete B.cacheMap[e]}var n=Laya.loader.getRes(e)||null;if(n===null){Laya.loader.cancelLoadByUrl(e)}else{n.dispose&&n.dispose();n.destroy&&n.destroy();Laya.loader.clearRes(e)}var r=suncom.Common.getFileExtension(e);if(r==="ani"){Laya.Animation.clearCache(e)}else if(r==="sk"){Laya.Templet.TEMPLET_DICTIONARY[e]&&Laya.Templet.TEMPLET_DICTIONARY[e].destroy();delete Laya.Templet.TEMPLET_DICTIONARY[e]}}r.clearResByUrl=n;function o(e){if(G.isRes3dUrl(e)===true&&G.getRes3dJsonUrl(e)===e){var t=G.getAssetUrlsByRes3dJson(Laya.loader.getRes(e));for(var n=0;n<t.length;n++){r.clearResByUrl(t[n])}}r.clearResByUrl(e)}})(F=n.UrlLocker||(n.UrlLocker={}));function K(e,t){var n=e.split("/");while(t!=null&&n.length>0){var r=n.shift();t=t.getChildByName(r)}return t}n.find=K})(sunui||(sunui={}));var sunnet;(function(e){var t;(function(e){e[e["OK"]=0]="OK";e[e["IO_ERROR"]=-1]="IO_ERROR";e[e["PARSE_ERROR"]=-2]="PARSE_ERROR"})(t=e.HttpResStatus||(e.HttpResStatus={}));var s;(function(e){e[e["NSL_SEND_DATA"]=1]="NSL_SEND_DATA";e[e["NSL_RECV_DATA"]=2]="NSL_RECV_DATA"})(s=e.MsgQIdEnum||(e.MsgQIdEnum={}));var i;(function(e){e[e["CONNECTED"]=0]="CONNECTED";e[e["CONNECTING"]=1]="CONNECTING";e[e["DISCONNECTED"]=2]="DISCONNECTED"})(i=e.NetConnectionStateEnum||(e.NetConnectionStateEnum={}));var o;(function(e){e[e["RESET"]=0]="RESET";e[e["UPDATE"]=1]="UPDATE"})(o=e.ServerTimeUpdateFlagEnum||(e.ServerTimeUpdateFlagEnum={}));var a;(function(e){e[e["NONE"]=0]="NONE";e[e["GOOD"]=1]="GOOD";e[e["BAD"]=2]="BAD";e[e["UNSTABLE"]=3]="UNSTABLE"})(a=e.VirtualNetworkLevelEnum||(e.VirtualNetworkLevelEnum={}));var n=function(n){__extends(e,n);function e(e){var t=n.call(this,suncore.MsgQModEnum.NSL)||this;t.$hashId=0;t.$socket=null;t.$pipeline=null;t.$state=i.DISCONNECTED;t.$closedByError=false;t.$ping=0;t.$latency=0;t.$srvTime=0;t.$clientTime=0;t.$dispatcher=new suncom.EventSystem;t.$name=e;t.$pipeline=new l(t);N.connetionMap[e]=t;t.facade.registerObserver(suntdd.NotifyKey.GET_WEBSOCKET_INFO,t.$onGetWebSocketInfo,t);t.facade.registerObserver(suntdd.NotifyKey.TEST_WEBSOCKET_STATE,t.$onTestWebSocketState,t);t.facade.registerObserver(suntdd.NotifyKey.TEST_WEBSOCKET_PROTOCAL,t.$onTestWebSocketPacket,t);return t}e.prototype.$onGetWebSocketInfo=function(e){var t=N.connetionMap[e.name]||null;if(t===null){return}if(t.state===i.CONNECTED){e.state=suntdd.MSWSConnectionStateEnum.CONNECTED}else if(t.state===i.CONNECTING){e.state=suntdd.MSWSConnectionStateEnum.CONNECTING}else{e.state=suntdd.MSWSConnectionStateEnum.DISCONNECTED}};e.prototype.$onTestWebSocketState=function(e){this.testChangeState(e)};e.prototype.$onTestWebSocketPacket=function(e,t){this.testProtocal(e,t)};e.prototype.connect=function(e,t,n){var r=n===false?false:this.$closedByError;this.close(r);this.$ip=e;this.$port=t;this.$state=i.CONNECTING;this.$socket=new Laya.Socket;this.$socket.endian=Laya.Byte.LITTLE_ENDIAN;this.$socket.on(Laya.Event.OPEN,this,this.$onOpen);this.$socket.on(Laya.Event.CLOSE,this,this.$onClose);this.$socket.on(Laya.Event.ERROR,this,this.$onError);this.$socket.on(Laya.Event.MESSAGE,this,this.$onMessage);this.$hashId=suncom.Common.createHashId();if(suncom.Global.debugMode&suncom.DebugMode.TDD){}else{this.$socket.connectByUrl("ws://"+e+":"+t)}if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){suncom.Logger.log(suncom.DebugMode.ANY,"Netconnection=> 请求连接 ws://"+this.$ip+":"+this.$port)}this.addEventListener(S.CLOSE_CONNECT_BY_VIRTUAL,this.$onError,this);this.facade.sendNotification(_.SOCKET_STATE_CHANGE,[this.$name,this.$state,false])};e.prototype.close=function(e){if(e===void 0){e=false}if(e===false){this.$closedByError=false}else if(this.$state===i.CONNECTED){this.$closedByError=true;this.dispatchEvent(S.CLEAR_REQUEST_DATA)}if(this.$socket!==null){if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){suncom.Logger.log(suncom.DebugMode.ANY,"Netconnection=> 关闭连接 ws://"+this.$ip+":"+this.$port)}this.$socket.off(Laya.Event.OPEN,this,this.$onOpen);this.$socket.off(Laya.Event.CLOSE,this,this.$onClose);this.$socket.off(Laya.Event.ERROR,this,this.$onError);this.$socket.off(Laya.Event.MESSAGE,this,this.$onMessage);this.$socket.close();this.$socket=null;this.$hashId=0}if(this.$state!==i.DISCONNECTED){this.dispatchEvent(S.SOCKET_DISCONNECTED,e)}if(e===false){this.dispatchEvent(S.KILL_WATCH_DOG)}if(this.$state!==i.DISCONNECTED){this.$state=i.DISCONNECTED;this.facade.sendNotification(_.SOCKET_STATE_CHANGE,[this.$name,this.$state,e])}};e.prototype.send=function(e){if(this.$state===i.CONNECTED){this.$socket.send(e)}else{suncom.Logger.error(suncom.DebugMode.ANY,"NetConnection=> 网络未连接，发送数据失败！！！")}};e.prototype.sendBytes=function(e,t,n,r){if(t===void 0){t=null}if(n===void 0){n=null}if(r===void 0){r=0}this.$pipeline.send(e,t,n,r)};e.prototype.flush=function(){this.$socket.flush()};e.prototype.testChangeState=function(e){if(suncom.Global.debugMode&suncom.DebugMode.TDD){var t=suncom.Handler.create(this,this.$onTestChangeState,[this.$hashId,e]);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,t)}};e.prototype.$onTestChangeState=function(e,t){if(this.$hashId===e){if(t===suntdd.MSWSStateEnum.CONNECTED){this.$onOpen()}else if(t===suntdd.MSWSStateEnum.CLOSE){this.$onClose()}else if(t===suntdd.MSWSStateEnum.ERROR){this.$onError()}}};e.prototype.testPacket=function(e){if(suncom.Global.debugMode&suncom.DebugMode.TDD){var t=suncom.Handler.create(this,this.$onTestPacket,[this.$hashId,e]);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,t)}};e.prototype.$onTestPacket=function(e,t){if(this.$hashId===e){var n=p.getInstance().getProtocalByCommand(t);this.facade.sendNotification(suntdd.NotifyKey.TEST_WEBSOCKET_SEND_DATA,n&&n.Name)}};e.prototype.testProtocal=function(e,t){if(suncom.Global.debugMode&suncom.DebugMode.TDD){var n=suncom.Handler.create(this,this.$onTestProtocal,[this.$hashId,e,t]);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,n)}};e.prototype.$onTestProtocal=function(e,t,n){if(this.$hashId===e){var r=p.getInstance().getProtocalByName(t);this.$pipeline.recv(r.Id,0,null,n)}};e.prototype.logMsgIsSent=function(e,t,n,r){var o=p.getInstance().getProtocalByCommand(e);var i=o===null?null:p.getInstance().decode("msg."+o.Name,t);if(e===T.HEARTBEAT_REQUEST_COMMAND){if(suncom.Global.debugMode&suncom.DebugMode.NETWORK_HEARTBEAT){suncom.Logger.log(suncom.DebugMode.ANY,"发送心跳 name:"+o.Name+", data:"+JSON.stringify(i))}}else if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){suncom.Logger.log(suncom.DebugMode.ANY,"发送消息 name:"+o.Name+", data:"+JSON.stringify(i))}};e.prototype.dispatchCancel=function(){this.$dispatcher.dispatchCancel()};e.prototype.dispatchEvent=function(e,t,n){this.$dispatcher.dispatchEvent(e,t,n)};e.prototype.addEventListener=function(e,t,n,r,o){this.$dispatcher.addEventListener(e,t,n,r,o)};e.prototype.removeEventListener=function(e,t,n){this.$dispatcher.removeEventListener(e,t,n)};e.prototype.$onOpen=function(){this.$state=i.CONNECTED;if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){suncom.Logger.log(suncom.DebugMode.ANY,"Netconnection=> 网络连接成功！")}this.dispatchEvent(S.SOCKET_CONNECTED);this.dispatchEvent(S.CACHE_SEND_BYTES,false);this.dispatchEvent(S.FLUSH_CACHED_BYTES);this.$closedByError=false;this.facade.sendNotification(_.SOCKET_STATE_CHANGE,[this.$name,this.$state,false])};e.prototype.$onClose=function(){if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){suncom.Logger.log(suncom.DebugMode.ANY,"Netconnection=> 连接异常关闭！")}this.close(true)};e.prototype.$onError=function(){if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){suncom.Logger.log(suncom.DebugMode.ANY,"Netconnection=> 连接异常断开！")}this.close(true)};e.prototype.$onMessage=function(e){this.$pipeline.recv(0,0,null,void 0)};Object.defineProperty(e.prototype,"name",{get:function(){return this.$name||null},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"ip",{get:function(){return this.$ip||null},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"port",{get:function(){return this.$port||0},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"state",{get:function(){return this.$state},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"input",{get:function(){if(this.$socket===null){return null}else{return this.$socket.input||null}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"output",{get:function(){if(this.$socket===null){return null}else{return this.$socket.output||null}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"ping",{get:function(){return this.$ping},set:function(e){this.$ping=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"latency",{get:function(){return this.$latency},set:function(e){this.$latency=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"srvTime",{get:function(){return this.$srvTime},set:function(e){this.$srvTime=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"clientTime",{get:function(){return this.$clientTime},set:function(e){this.$clientTime=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"pipeline",{get:function(){return this.$pipeline},enumerable:true,configurable:true});return e}(puremvc.Notifier);e.NetConnection=n;var r=function(n){__extends(e,n);function e(e){var t=n.call(this,suncore.MsgQModEnum.NSL)||this;t.$connection=null;t.$connection=e;t.$connection.addEventListener(S.SOCKET_CONNECTED,t.$onConnected,t,false,suncom.EventPriorityEnum.FWL);t.$connection.addEventListener(S.SOCKET_DISCONNECTED,t.$onDisconnected,t,false,suncom.EventPriorityEnum.FWL);return t}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);this.$connection.removeEventListener(S.SOCKET_CONNECTED,this.$onConnected,this);this.$connection.removeEventListener(S.SOCKET_DISCONNECTED,this.$onDisconnected,this);this.$connection=null};e.prototype.$onConnected=function(){};e.prototype.$onDisconnected=function(e){};e.prototype.send=function(e,t,n,r){return[e,t,n,r]};e.prototype.recv=function(e,t,n,r){return[e,t,n,r]};return e}(puremvc.Notifier);e.NetConnectionInterceptor=r;var u=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$trackers=[];return e}e.prototype.$onConnected=function(){this.$trackers.length=0};e.prototype.send=function(e,t,n,r){if(this.$isReliableProtocal(e)===true){var o={rsp:e,rep:this.$getProtocalReplyCommand(e),time:(new Date).valueOf()};this.$trackers.push(o)}return[e,t,n,r]};e.prototype.recv=function(e,t,n,r){if(this.$trackers.length>0){var o=this.$trackers[0];if(o.rep===e){this.$trackers.shift();this.$connection.ping=(new Date).valueOf()-o.time;this.$dealRecvData(e,r)}}return[e,t,n,r]};e.prototype.$updateServerTimestamp=function(e,t){var n=Math.ceil(this.$connection.ping/2);if(t===o.RESET||n<this.$connection.latency){this.$connection.srvTime=e;this.$connection.latency=n;this.$connection.clientTime=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM)}if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){var r=this.$connection.srvTime+suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM)-this.$connection.clientTime;suncom.Logger.log(suncom.DebugMode.ANY,"服务器时间："+suncom.Common.formatDate("yy-MM-dd hh:mm:ss MS",r)+"，Ping："+this.$connection.ping+"，时间推算延延："+this.$connection.latency)}};return e}(r);e.NetConnectionPing=u;var l=function(n){__extends(e,n);function e(e){var t=n.call(this)||this;t.$items=[];t.$connection=e;return t}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);while(this.$items.length>0){var e=this.$items.shift();e.interceptor.destroy()}};e.prototype.add=function(e,t){var n=new c;n.type=typeof e==="string"?e:null;n.interceptor=typeof e!=="string"?new e(this.$connection):new t(this.$connection);this.$items.push(n)};e.prototype.remove=function(e){for(var t=0;t<this.$items.length;t++){var n=this.$items[t].interceptor;if(n instanceof e){this.$items.splice(t,1);n.destroy();break}}};e.prototype.recv=function(e,t,n,r){var o=[e,t,n,r];for(var i=0;i<this.$items.length;i++){var s=this.$items[i];if(s.type==="send"){continue}var a=s.interceptor;o=a.recv.apply(a,o);if(o===null){return}}if(o[3]===void 0){suncom.Logger.warn(suncom.DebugMode.ANY,"NetConnectionPipeline=> decode 意外的指令 cmd:"+o[0].toString()+", buff:"+(o[1]?"[Object]":"null"))}};e.prototype.send=function(e,t,n,r){for(var o=this.$items.length-1;o>-1;o--){var i=this.$items[o];if(i.type==="recv"){continue}var s=i.interceptor;var a=s.send.call(s,e,t,n,r);if(a===null){return null}}return null};return e}(puremvc.Notifier);e.NetConnectionPipeline=l;var c=function(){function e(){}return e}();e.NetConnectionPipelineItem=c;var f=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.recv=function(e,t,n,r){if(r!==void 0){return[e,t,n,r]}var o=this.$decode(e,n);if(o===null){return[e,t,n,r]}if(o===n){throw Error("请勿返回未处理的消息！！！")}var i={id:e,name:null,data:o};if(T.VIRTUAL_NETWORK_LEVEL===a.NONE){suncore.MsgQ.send(suncore.MsgQModEnum.NSL,s.NSL_RECV_DATA,i)}else{this.$connection.dispatchEvent(S.SOCKET_MESSAGE_DECODED,i)}return[e,t,n,o]};return t}(r);e.NetConnectionProtobufDecoder=f;var d=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$datas=[];e.$currentSeconds=0;e.$isNetworkWaving=false;e.$lastConnectedTimestamp=0;e.$currentConnectionReliableTime=0;return e}e.prototype.$onConnected=function(){this.$lastConnectedTimestamp=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM);this.$currentConnectionReliableTime=this.$getReliableTimeOfConnection()*1e3;this.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this);this.$connection.addEventListener(S.SOCKET_MESSAGE_DECODED,this.$onSocketMessageDecoded,this)};e.prototype.$onDisconnected=function(e){this.$datas.length=0;this.$currentSeconds=0;this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this);this.$connection.removeEventListener(S.SOCKET_MESSAGE_DECODED,this.$onSocketMessageDecoded,this)};e.prototype.$onEnterFrame=function(){var e=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM);if(this.$lastConnectedTimestamp>0&&e>this.$lastConnectedTimestamp+this.$currentConnectionReliableTime){this.$connection.dispatchEvent(S.CLOSE_CONNECT_BY_VIRTUAL);return}var t=Math.floor(e/1e3);if(this.$currentSeconds!==t){this.$currentSeconds=t;this.$isNetworkWaving=suncom.Mathf.random(0,100)<this.$getProbabilyOfNetworkWave()}if(this.$datas.length>0){var n=this.$datas[0];if(e>n.time+n.delay){suncore.MsgQ.send(suncore.MsgQModEnum.NSL,s.NSL_RECV_DATA,this.$datas.shift().msg)}}};e.prototype.$onSocketMessageDecoded=function(e){var t={msg:e,time:suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM),delay:this.$calculateMessageDelayTime()};this.$datas.push(t)};e.prototype.$getReliableTimeOfConnection=function(){if(T.VIRTUAL_NETWORK_LEVEL===a.UNSTABLE){return suncom.Mathf.random(180,300)}else{return 1440*30}};e.prototype.$getProbabilyOfNetworkWave=function(){if(T.VIRTUAL_NETWORK_LEVEL===a.BAD){return 10}else if(T.VIRTUAL_NETWORK_LEVEL===a.UNSTABLE){return 25}else{return 0}};e.prototype.$calculateMessageDelayTime=function(){if(T.VIRTUAL_NETWORK_LEVEL===a.GOOD){return suncom.Mathf.random(60,150)}else if(T.VIRTUAL_NETWORK_LEVEL===a.BAD){if(this.$isNetworkWaving===false){return suncom.Mathf.random(200,800)}else{return suncom.Mathf.random(1e3,2e3)}}else if(T.VIRTUAL_NETWORK_LEVEL===a.UNSTABLE){if(this.$isNetworkWaving===false){return suncom.Mathf.random(1e3,2500)}else{return suncom.Mathf.random(3e3,8e3)}}else{return 0}};return e}(r);e.NetConnectionVirtualNetwork=d;var h=function(n){__extends(e,n);function e(e){var t=n.call(this,e)||this;t.$retryer=null;t.$retryer=new sunui.Retryer(sunui.RetryMethodEnum.TERMINATE,suncom.Handler.create(t,t.$onConnectFailed,[e.name]));t.$connection.addEventListener(S.KILL_WATCH_DOG,t.$onKillWatchDog,t);return t}e.prototype.destroy=function(){if(this.$destroyed===true){return}this.$connection.removeEventListener(S.KILL_WATCH_DOG,this.$onKillWatchDog,this);n.prototype.destroy.call(this)};e.prototype.$onConnected=function(){this.$retryer.cancel();this.$retryer.reset()};e.prototype.$onDisconnected=function(e){if(e===true){if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){suncom.Logger.log(suncom.DebugMode.ANY,"NetConnectionWatchDog=> 网络连接异常，"+T.TCP_RETRY_DELAY+"毫秒后重连！")}this.$ip=this.$connection.ip;this.$port=this.$connection.port;this.$retryer.run(T.TCP_RETRY_DELAY,suncom.Handler.create(this,this.$doConnect),T.TCP_MAX_RETRIES)}};e.prototype.$onKillWatchDog=function(){this.$retryer.cancel()};e.prototype.$doConnect=function(){if(this.$connection.state===i.DISCONNECTED){this.$connection.connect(this.$ip,this.$port,true)}else if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){suncom.Logger.log(suncom.DebugMode.ANY,"检测狗不能正常工作，因为 state:"+i[this.$connection.state])}};e.prototype.$onConnectFailed=function(e){this.$retryer.reset();this.facade.sendNotification(_.SOCKET_CONNECT_FAILED,e)};return e}(r);e.NetConnectionWatchDog=h;var p=function(){function e(){this.$proto=null;this.$commands=null;this.$protocals=null}e.getInstance=function(){return e.instance};e.prototype.buildProto=function(e){var t=new Laya.Browser.window.protobuf.Root;var n=Laya.loader.getRes(e);Laya.Browser.window.protobuf.parse(n,t,{keepCase:true});this.$proto=t};e.prototype.buildProtocal=function(e){var t=Laya.loader.getRes(e);this.$commands=Object.keys(t.data);this.$protocals=t.data};e.prototype.buildProtocalJson=function(e){this.$commands=Object.keys(e);this.$protocals=e};e.prototype.getProtocalByCommand=function(e){return this.$protocals[e]||null};e.prototype.getProtocalByName=function(e){for(var t=0;t<this.$commands.length;t++){var n=this.$commands[t];var r=this.getProtocalByCommand(n);if(r===null){continue}if(r.Name===e){return r}}return null};e.prototype.getProtoClass=function(e){return this.$proto.lookup(e)};e.prototype.getProtoEnum=function(e){return this.getProtoClass(e).values};e.prototype.encode=function(e,t){if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){if(e==="msg.Common_Heartbeat"){if(suncom.Global.debugMode&suncom.DebugMode.NETWORK_HEARTBEAT){suncom.Logger.log(suncom.DebugMode.ANY,"打包心跳成功 ==> "+JSON.stringify(t))}}else if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){suncom.Logger.log(suncom.DebugMode.ANY,"打包数据成功 ==> "+JSON.stringify(t))}}return this.getProtoClass(e).encode(t).finish()};e.prototype.decode=function(e,t){var n=this.getProtoClass(e).decode(t);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){if(e==="msg.Common_Heartbeat"){if(suncom.Global.debugMode&suncom.DebugMode.NETWORK_HEARTBEAT){suncom.Logger.log(suncom.DebugMode.ANY,"解析心跳成功 ==> "+JSON.stringify(n))}}else if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){suncom.Logger.log(suncom.DebugMode.ANY,"解析数据成功 ==> "+JSON.stringify(n))}}return n};e.instance=new e;return e}();e.ProtobufManager=p;var m=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$hashId=suncom.Common.createHashId();e.$destroyed=false;e.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,e.$onEnterFrameCB,e,false,suncom.EventPriorityEnum.FWL);return e}e.prototype.release=function(){if(this.$destroyed===true){return}this.$destroyed=true;this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrameCB,this)};e.prototype.$onEnterFrameCB=function(){if(this.$destroyed===false){this.$onEnterFrame()}};Object.defineProperty(e.prototype,"hashId",{get:function(){return this.$hashId},enumerable:true,configurable:true});return e}(puremvc.Notifier);e.SequentialSlice=m;var E=function(r){__extends(e,r);function e(e,t){if(t===void 0){t="default"}var n=r.call(this)||this;n.$connection=null;n.$srvCreateTime=0;n.$lifeTime=0;n.$pastTime=0;n.$killedTime=0;n.$timeMultiple=1;n.$chaseMultiple=1;n.$lifeTime=e;n.$connection=N.connetionMap[t]||null;n.$srvCreateTime=O(t);return n}e.prototype.updateCreateTime=function(e,t,n){if(e===void 0){e=0}if(t===void 0){t=0}if(n===void 0){n=1}this.$pastTime=t;this.$chaseMultiple=n;this.$srvCreateTime=e>0?e:this.$srvCreateTime;this.$onEnterFrame()};e.prototype.$onEnterFrame=function(){if(this.$timeMultiple<0){suncom.Logger.error(suncom.DebugMode.ANY,"当前时间流逝倍率不允许小于0");return}var e=suncore.System.getDelta()*this.$timeMultiple;if(e<suncore.System.getDelta()){this.$killedTime+=suncore.System.getDelta()-e}if(this.$timeMultiple===0){return}this.$pastTime+=e;var t=O(this.$connection.name)-(this.$srvCreateTime+this.$pastTime+this.$killedTime);if(t>0){e*=this.$chaseMultiple;if(e>t){e=t}this.$pastTime+=e}if(this.$pastTime>this.$lifeTime){this.$pastTime=this.$lifeTime}this.$frameLoop();if(this.$pastTime>=this.$lifeTime){this.$onTimeup()}};Object.defineProperty(e.prototype,"timeLen",{get:function(){return this.$lifeTime},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"pastTime",{get:function(){return this.$pastTime},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"timeMultiple",{get:function(){return this.$timeMultiple},set:function(e){this.$timeMultiple=e},enumerable:true,configurable:true});return e}(m);e.SequentialTimeSlice=E;var y=function(n){__extends(e,n);function e(e){var t=n.call(this,e)||this;t.$datas=[];t.$cacheSendBytes=false;t.$connection.addEventListener(S.CACHE_SEND_BYTES,t.$onCacheSendBytes,t);t.$connection.addEventListener(S.FLUSH_CACHED_BYTES,t.$onFlushCachedBytes,t);t.$connection.addEventListener(S.CLEAR_REQUEST_DATA,t.$onClearRequestData,t);return t}e.prototype.destroy=function(){if(this.$destroyed===true){return}this.$connection.removeEventListener(S.CACHE_SEND_BYTES,this.$onCacheSendBytes,this);this.$connection.removeEventListener(S.FLUSH_CACHED_BYTES,this.$onFlushCachedBytes,this);this.$connection.removeEventListener(S.CLEAR_REQUEST_DATA,this.$onClearRequestData,this);n.prototype.destroy.call(this)};e.prototype.$onCacheSendBytes=function(e){this.$cacheSendBytes=e};e.prototype.$onFlushCachedBytes=function(){while(this.$datas.length>0&&this.$connection.state===i.CONNECTED){var e=this.$datas.shift();this.$connection.sendBytes(e.cmd,e.bytes,e.ip,e.port)}};e.prototype.$onClearRequestData=function(){this.$datas.length=0};e.prototype.$needCreate=function(e,t){if(e===null||t===0){return false}if(this.$connection.state===i.DISCONNECTED){return true}if(this.$connection.state===i.CONNECTED){if(this.$connection.ip!==e||this.$connection.port!==t){return true}}return false};e.prototype.send=function(e,t,n,r){if(this.$needCreate(n,r)==true){this.$connection.connect(n,r,false);this.$cacheSendBytes=true}if(this.$connection.state===i.CONNECTED){return[e,t,n,r]}else if(this.$cacheSendBytes===true){var o={cmd:e,bytes:t,ip:n,port:r};this.$datas.push(o)}return null};return e}(r);e.NetConnectionCreator=y;var v=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.recv=function(e,t,n,r){var o=false;if(suncom.Global.debugMode&suncom.DebugMode.TDD){if(r!==null){var i=p.getInstance().getProtocalByCommand(e);n=p.getInstance().encode("msg."+i.Name,r)}o=true;r=void 0}if(o===false){var s=this.$connection.input||null;if(s===null){suncom.Logger.error(suncom.DebugMode.ANY,"Decoder 网络己断开！！！");return null}e=s.getUint16();t=s.getUint16();var a=s.buffer.slice(s.pos);s.pos+=a.byteLength;o=true;n=new Uint8Array(a)}return[e,t,n,r]};return t}(r);e.NetConnectionDecoder=v;var g=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.send=function(e,t,n,r){if(suncom.Global.debugMode&suncom.DebugMode.TDD){this.$connection.testPacket(e);this.$connection.logMsgIsSent(e,t,n,r);return null}var o=this.$connection.output||null;if(o===null){suncom.Logger.error(suncom.DebugMode.ANY,"Encoder 网络己断开！！！");return null}o.writeUint16(e);o.writeUint16(0);t!==null&&o.writeArrayBuffer(t);this.$connection.flush();this.$connection.logMsgIsSent(e,t,n,r);return null};return t}(r);e.NetConnectionEncoder=g;var $=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$onConnected=function(){this.$lastRecvTime=this.$lastSendTime=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM);this.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)};t.prototype.$onDisconnected=function(){this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)};t.prototype.$onEnterFrame=function(){var e=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM);if(this.$lastRecvTime<this.$lastSendTime){if(e-this.$lastSendTime>T.HEARTBEAT_TIMEOUT_MILLISECONDS){this.$lastRecvTime=this.$lastSendTime;this.$connection.close(true)}}else if(e-this.$lastSendTime>T.HEARTBEAT_INTERVAL_MILLISECONDS){if(suncom.Global.debugMode&suncom.DebugMode.NETWORK_HEARTBEAT){suncom.Logger.log(suncom.DebugMode.ANY,"heartbeat=> current timestamp:"+suncom.Common.formatDate("hh:mm:ss MS",(new Date).valueOf()))}var t=p.getInstance().encode("msg.Common_Heartbeat",{Cnt:1});this.$connection.sendBytes(T.HEARTBEAT_REQUEST_COMMAND,t)}};t.prototype.send=function(e,t,n,r){if(T.HEARTBEAT_FIXED_FREQUENCY===false||e===T.HEARTBEAT_REQUEST_COMMAND){if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){if(e===T.HEARTBEAT_REQUEST_COMMAND){if(suncom.Global.debugMode&suncom.DebugMode.NETWORK_HEARTBEAT){suncom.Logger.log(suncom.DebugMode.ANY,"send heartbeat=> current timestamp:"+suncom.Common.formatDate("hh:mm:ss MS",(new Date).valueOf()))}}else if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){suncom.Logger.log(suncom.DebugMode.ANY,"send bytes=> current timestamp:"+suncom.Common.formatDate("hh:mm:ss MS",(new Date).valueOf()))}}this.$lastSendTime=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM)}return[e,t,n,r]};t.prototype.recv=function(e,t,n,r){if(T.HEARTBEAT_FIXED_FREQUENCY===false||e===T.HEARTBEAT_RESPONSE_COMMAND){if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){if(e===T.HEARTBEAT_RESPONSE_COMMAND){if(suncom.Global.debugMode&suncom.DebugMode.NETWORK_HEARTBEAT){suncom.Logger.log(suncom.DebugMode.ANY,"recv heartbeat=> current timestamp:"+suncom.Common.formatDate("hh:mm:ss MS",(new Date).valueOf()))}}else if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){suncom.Logger.log(suncom.DebugMode.ANY,"recv bytes=> current timestamp:"+suncom.Common.formatDate("hh:mm:ss MS",(new Date).valueOf()))}}this.$lastRecvTime=suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM)}return[e,t,n,r]};return t}(r);e.NetConnectionHeartbeat=$;var T;(function(e){e.TCP_RETRY_DELAY=20*1e3;e.TCP_MAX_RETRIES=10;e.HEARTBEAT_REQUEST_COMMAND=-1;e.HEARTBEAT_RESPONSE_COMMAND=-1;e.HEARTBEAT_TIMEOUT_MILLISECONDS=3e3;e.HEARTBEAT_INTERVAL_MILLISECONDS=5e3;e.HEARTBEAT_FIXED_FREQUENCY=false;e.VIRTUAL_NETWORK_LEVEL=a.NONE})(T=e.Config||(e.Config={}));var S;(function(e){e.SOCKET_CONNECTED="sunnet.EventKey.SOCKET_CONNECTED";e.SOCKET_DISCONNECTED="sunnet.EventKey.SOCKET_DISCONNECTED";e.SOCKET_CONNECTING="sunnet.EventKey.SOCKET_CONNECTING";e.SOCKET_CONNECT_FAILED="sunnet.EventKey.SOCKET_CONNECT_FAILED";e.KILL_WATCH_DOG="sunnet.EventKey.KILL_WATCH_DOG";e.CACHE_SEND_BYTES="sunnet.EventKey.CACHE_SEND_BYTES";e.FLUSH_CACHED_BYTES="sunnet.EventKey.FLUSH_CACHED_BYTES";e.CLEAR_REQUEST_DATA="sunnet.EventKey.CLEAR_REQUEST_DATA";e.SOCKET_MESSAGE_DECODED="sunnet.EventKey.SOCKET_MESSAGE_DECODED";e.CLOSE_CONNECT_BY_VIRTUAL="sunnet.EventKey.CLOSE_CONNECT_BY_VIRTUAL"})(S=e.EventKey||(e.EventKey={}));var N;(function(e){e.HEAD_LENGTH=28;e.connetionMap={}})(N=e.M||(e.M={}));var C;(function(e){var o=new suncom.EventSystem;function t(e,t,n){if(e==="msg.Common_Heartbeat"){if(suncom.Global.debugMode&suncom.DebugMode.NETWORK_HEARTBEAT){suncom.Logger.log(suncom.DebugMode.ANY,"响应心跳")}}else{if(suncom.Global.debugMode&suncom.DebugMode.NETWORK){suncom.Logger.log(suncom.DebugMode.ANY,"响应消息 name:"+e+", data:"+JSON.stringify(t))}}o.dispatchEvent(e,t,n)}e.notify=t;function n(e,t,n,r){o.addEventListener(e,t,n,false,r)}e.register=n;function r(e,t,n){o.removeEventListener(e,t,n)}e.unregister=r})(C=e.MessageNotifier||(e.MessageNotifier={}));var _;(function(e){e.SOCKET_STATE_CHANGE="sunnet.NotifyKey.SOCKET_STATE_CHANGE";e.SOCKET_CONNECT_FAILED="sunnet.NotifyKey.SOCKET_CONNECT_FAILED";e.SEQUENTIAL_SLICE_RELEASED="sunnet.NotifyKey.SEQUENTIAL_SLICE_RELEASED";e.GUI_SEQUENTIAL_NOTIFICATION="sunnet.NotifyKey.GUI_SEQUENTIAL_NOTIFICATION"})(_=e.NotifyKey||(e.NotifyKey={}));function O(e){if(e===void 0){e="default"}var t=N.connetionMap[e]||null;if(t===null){return 0}return t.srvTime+suncore.System.getModuleTimestamp(suncore.ModuleEnum.SYSTEM)-t.clientTime}e.getCurrentServerTimestamp=O})(sunnet||(sunnet={}));var world2d;(function(g){var o;(function(e){e[e["CIRCLE"]=0]="CIRCLE";e[e["POLYGON"]=1]="POLYGON"})(o=g.ColliderShapEnum2D||(g.ColliderShapEnum2D={}));var s;(function(e){e[e["DEFAULT"]=1]="DEFAULT";e[e["FISH"]=2]="FISH";e[e["BULLET"]=4]="BULLET";e[e["POLYGON"]=8]="POLYGON";e[e["CIRCLE"]=16]="CIRCLE";e[e["RECTANLE"]=32]="RECTANLE";e[e["FISH_2"]=64]="FISH_2";e[e["BULLET_2"]=128]="BULLET_2"})(s=g.CollisionLayerEnum||(g.CollisionLayerEnum={}));var y;(function(e){e[e["CIRCLE"]=0]="CIRCLE";e[e["POLYGON"]=1]="POLYGON";e[e["RECTANGLE"]=2]="RECTANGLE"})(y=g.CollisionShapEnum2D||(g.CollisionShapEnum2D={}));var a;(function(e){e[e["COLLISION_ENTER"]=0]="COLLISION_ENTER";e[e["COLLISION_STAY"]=1]="COLLISION_STAY";e[e["COLLISION_EXIT"]=2]="COLLISION_EXIT"})(a=g.CollisionType||(g.CollisionType={}));var $;(function(e){e[e["NONE"]=0]="NONE";e[e["CROSS"]=1]="CROSS";e[e["CROSS_2"]=2]="CROSS_2";e[e["OVERLAP"]=3]="OVERLAP"})($=g.CrossTypeEnum||(g.CrossTypeEnum={}));var T;(function(e){e[e["ANY"]=0]="ANY";e[e["CLOSEST"]=1]="CLOSEST";e[e["ALL"]=2]="ALL";e[e["ALL_CLOSEST"]=3]="ALL_CLOSEST"})(T=g.RaycastTypeEnum||(g.RaycastTypeEnum={}));var v=function(){function e(){}e.prototype.updateBounds=function(e,t,n,r){this.left=e;this.right=t;this.top=n;this.bottom=r};return e}();g.Bounds=v;var e=function(){function e(e){this.$shap=e}Object.defineProperty(e.prototype,"shap",{get:function(){return this.$shap},enumerable:true,configurable:true});return e}();g.Collider2D=e;var t=function(n){__extends(e,n);function e(e){var t=n.call(this,o.CIRCLE)||this;t.radius=e;return t}e.prototype.clone=function(){return new e(this.radius)};return e}(e);g.ColliderCircle2D=t;var n=function(n){__extends(r,n);function r(e){var t=n.call(this,o.POLYGON)||this;t.vertexs=e;return t}r.prototype.clone=function(){var e=[];for(var t=0;t<this.vertexs.length;t++){e.push(this.vertexs[t].copy())}return new r(e)};return r}(e);g.ColliderPolygon2D=n;var r=function(){function e(e){this.bounds=new v;this.$shap=e}Object.defineProperty(e.prototype,"shap",{get:function(){return this.$shap},enumerable:true,configurable:true});return e}();g.Collision2D=r;var i=function(n){__extends(e,n);function e(e){var t=n.call(this,y.CIRCLE)||this;t.radius=e;return t}e.prototype.updateBounds=function(){this.bounds.updateBounds(this.x-this.radius,this.x+this.radius,this.y-this.radius,this.y+this.radius)};return e}(r);g.CollisionCircle2D=i;var u=function(){function e(e,t){this.useBox2d=false;this.$testAABB=true;this.$touching=false;if(e.collision.shap===y.CIRCLE){this.$a=e;this.$b=t;if(t.collision.shap===y.CIRCLE){this.$testFunc=this.$c2c;this.$testAABB=false}else if(t.collision.shap===y.RECTANGLE){this.$testFunc=this.$c2r}else{this.$testFunc=this.$c2p}}else if(e.collision.shap===y.RECTANGLE){if(t.collision.shap===y.CIRCLE){this.$a=t;this.$b=e;this.$testFunc=this.$c2r}else if(t.collision.shap===y.RECTANGLE){this.$a=e;this.$b=t;this.$testFunc=this.$r2r;this.$testAABB=false}else{this.$a=e;this.$b=t;this.$testFunc=this.$r2p}}else{this.$a=t;this.$b=e;if(t.collision.shap===y.CIRCLE){this.$testFunc=this.$c2p}else if(t.collision.shap===y.RECTANGLE){this.$testFunc=this.$r2p}else{this.$testFunc=this.$p2p}}}e.prototype.test=function(){var e=this.$a;var t=this.$b;if(e.enabled===false||t.enabled===false){return}var n,r;if(e.rigidbody!==null){n=e;r=t}else{n=t;r=e}if(n.rigidbody.target!==null&&n.rigidbody.target!==r){return}var o=this.$testAABB===false?true:_.bounds2Bounds(e.collision.bounds,t.collision.bounds);if(o===true){o=this.$testFunc.call(this,e.collision,t.collision)}if(o===true){if(this.$touching===false){this.$touching=true;this.doCollide(a.COLLISION_ENTER)}else{this.doCollide(a.COLLISION_STAY)}}else if(this.$touching===true){this.$touching=false;this.doCollide(a.COLLISION_EXIT)}};e.prototype.doCollide=function(e){var t=this.$a;var n=this.$b;if(e===a.COLLISION_ENTER){t.hitNum++;n.hitNum++;t.entity.onCollisionEnter(n.entity);n.entity.onCollisionEnter(t.entity)}else if(e===a.COLLISION_EXIT){t.hitNum--;n.hitNum--;t.entity.onCollisionExit(n.entity);n.entity.onCollisionExit(t.entity)}else{t.entity.onCollisionStay(n.entity);n.entity.onCollisionStay(t.entity)}};e.prototype.$c2c=function(e,t){return _.circle2Circle(e,t)};e.prototype.$c2r=function(e,t){return _.circle2Polygin(e,t)};e.prototype.$c2p=function(e,t){return _.circle2Polygin(e,t)};e.prototype.$r2r=function(){return _.bounds2Bounds(this.$a.collision.bounds,this.$b.collision.bounds)};e.prototype.$r2p=function(e,t){return _.polygon2Vertexs(t,e.vertexs)};e.prototype.$p2p=function(e,t){return _.polygon2Vertexs(e,t.vertexs)&&_.polygon2Vertexs(t,e.vertexs)};Object.defineProperty(e.prototype,"a",{get:function(){return this.$a},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"b",{get:function(){return this.$b},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"touching",{get:function(){return this.$touching},enumerable:true,configurable:true});return e}();g.CollisionContact2D=u;var l=function(o){__extends(e,o);function e(e){var t=o.call(this,y.POLYGON)||this;t.$tempVertexs=null;t.vertexs=[];t.segments=[];for(var n=0;n<e.vertexs.length;n++){var r=e.vertexs[n];t.vertexs.push(r.copy());t.segments.push(new S)}return t}e.prototype.updateBounds=function(){p.calculateBoundsForVertexs(this.vertexs,this.bounds)};e.prototype.updateVertexs=function(e){this.$tempVertexs=e};e.prototype.prepareVertexs=function(){for(var e=0;e<this.$tempVertexs.length;e++){var t=this.vertexs[e];var n=this.$tempVertexs[e];t.assign(n.x,n.y)}this.$tempVertexs=null};e.prototype.prepareSegments=function(){for(var e=0;e<this.vertexs.length;e++){var t=this.segments[e];t.a=this.vertexs[e];t.b=e>0?this.vertexs[e-1]:this.vertexs[this.vertexs.length-1];var n=this.vertexs[e];var r=e>0?this.vertexs[e-1]:this.vertexs[this.vertexs.length-1];this.segments[e].assign(n,r)}};Object.defineProperty(e.prototype,"modified",{get:function(){return this.$tempVertexs!==null},enumerable:true,configurable:true});return e}(r);g.CollisionPolygon2D=l;var c=function(n){__extends(e,n);function e(){var e=n.call(this,y.RECTANGLE)||this;e.vertexs=[];e.segments=[];for(var t=0;t<4;t++){e.vertexs.push(new N(0,0));e.segments.push(new S)}return e}e.prototype.updateBounds=function(){p.calculateBoundsForVertexs(this.vertexs,this.bounds)};e.prototype.prepareVertexs=function(){this.vertexs[0].assign(this.bounds.left,this.bounds.bottom);this.vertexs[1].assign(this.bounds.right,this.bounds.bottom);this.vertexs[2].assign(this.bounds.right,this.bounds.top);this.vertexs[3].assign(this.bounds.left,this.bounds.top)};e.prototype.prepareSegments=function(){for(var e=0;e<this.vertexs.length;e++){var t=this.segments[e];var n=this.vertexs[e];var r=e>0?this.vertexs[e-1]:this.vertexs[this.vertexs.length-1];t.assign(n,r)}};return e}(r);g.CollisionRectangle2D=c;var f=function(){function e(){}e.testPoint=function(e,t){if(t===void 0){t=0}var n=C.inst.transforms.slice(0);for(var r=0;r<n.length;r++){var o=n[r];var i=o.collision;if(t>0&&(o.layer&t)===0){continue}if(o.collision.shap===y.CIRCLE){if(_.pointInCircle(e,i)){return o}}else if(o.collision.shap===y.RECTANGLE){if(_.pointInRectangle(e,o.collision.bounds)){return o}}else{if(_.pointInPolygon(e,o.collision)){return o}}}return null};e.raycast=function(e,t,n,r,o){if(r===void 0){r=0}if(o===void 0){o=T.CLOSEST}var i=t.copy().normalize().mul(n).add(e);g.World2D.DEBUG===true&&O.drawLine(e,i,"#FF0000");var s=new S;s.assign(e,i);var a=new v;a.updateBounds(suncom.Mathf.min(e.x,i.x),suncom.Mathf.max(e.x,i.x),suncom.Mathf.min(e.y,i.y),suncom.Mathf.max(e.y,i.y));var u=C.inst.transforms;var l=null;var c=[];for(var f=0;f<u.length;f++){u[f].hitNum=0}for(var f=0;f<u.length;f++){var d=u[f];if(r>0&&(d.layer&r)===0){continue}if(_.bounds2Bounds(a,d.collision.bounds)===false){continue}if(l===null){l={type:$.NONE,transform:null,p1:new N(0,0),p2:new N(0,0),normal:null,distance:0}}if(d.collision.shap===y.CIRCLE){_.line2Circle(s,d.collision,l)}else{_.line2Polygon(s,d.collision,o,l)}if(l.type===$.NONE){continue}l.transform=d;d.hitNum=1;if(o===T.CLOSEST){if(c.length===1){c[0].transform.hitNum=0}c[0]=l;a.updateBounds(suncom.Mathf.min(e.x,l.p1.x),suncom.Mathf.max(e.x,l.p1.x),suncom.Mathf.min(e.y,l.p1.y),suncom.Mathf.max(e.y,l.p1.y))}else{c.push(l)}if(o===T.ANY){break}else if(o===T.CLOSEST||o===T.ALL_CLOSEST){l.distance=l.p1.distanceTo(e)}l=null}if(o===T.ALL_CLOSEST&&c.length>1){var h=[];while(c.length>1){var p=c[0];var m=0;for(var f=1;f<c.length;f++){var E=c[f];if(p===null||E.distance<p.distance){p=E;m=f}}c.splice(m,1);h.push(p)}h.push(c[0]);c=h}return c};return e}();g.Physics2D=f;var d=function(){function e(){this.$torque=180;this.target=null;this.moveSpeed=0}e.prototype.update=function(e){if(this.moveSpeed===0){return}if(this.target!==null&&this.target.enabled===false){this.target=null}var t=suncom.Pool.getItemByClass("world2d.Vector2D",N,[0,0]);if(this.target!==null){t.assign(this.target.x-this.transform.x,this.target.y-this.transform.y);var n=t.angle();if(this.$torque===180){this.transform.rotateTo(n)}else{var r=this.transform.rotation-suncom.Mathf.PI;var o=this.transform.rotation+suncom.Mathf.PI;if(n<r){n+=suncom.Mathf.PI2}else if(n>o){n-=suncom.Mathf.PI2}var i=n-this.transform.rotation;var s=suncom.Mathf.clamp(this.$torque*e*10,0,suncom.Mathf.PI);if(i<-s){this.transform.rotateBy(-s)}else if(i>s){this.transform.rotateBy(s)}else{this.transform.rotateBy(i)}}}t.assign(this.moveSpeed,0).rotate(this.transform.rotation);this.transform.moveBy(t.x*e,t.y*e);suncom.Pool.recover("world2d.Vector2D",t)};Object.defineProperty(e.prototype,"torque",{get:function(){return suncom.Mathf.r2d(this.$torque)},set:function(e){this.$torque=suncom.Mathf.d2r(e)},enumerable:true,configurable:true});return e}();g.Rigidbody2D=d;var S=function(){function e(){this.a=null;this.b=null;this.ab=new N(0,0)}e.prototype.assign=function(e,t){this.a=e;this.b=t;this.ab.assign(t.x-e.x,t.y-e.y);return this};return e}();g.Segment2D=S;var h=function(i){__extends(e,i);function e(e,t,n,r){var o=i.call(this)||this;o.$x=0;o.$y=0;o.$scaleTo=1;o.$rotateTo=0;o.$rotation=0;o.$enabled=true;o.$entity=null;o.$rigidbody=null;o.hitNum=0;o.$entity=e;o.$collider=t;o.$rigidbody=n;o.$collision=r;if(n!==null){n.transform=o}return o}e.prototype.transform=function(e){if(this.$rigidbody!==null){this.$rigidbody.update(e)}var t=this.$needUpdate();var n=this.$isModifiedByExtern();if(t===false&&n===false){return}this.$scale=this.$scaleTo;this.$radian=this.$rotateTo;this.$collision.x=this.$x;this.$collision.y=this.$y;if(n===false){this.$applyScale();this.$applyRotate();this.$applyPosition()}else{var r=this.$collision;r.prepareVertexs()}this.$updateCollision()};e.prototype.moveBy=function(e,t){this.$x+=e;this.$y+=t};e.prototype.moveTo=function(e,t){this.$x=e;this.$y=t};e.prototype.scaleBy=function(e){this.$scaleTo*=e};e.prototype.scaleTo=function(e){this.$scaleTo=e};e.prototype.rotateBy=function(e){this.$updateRadian(this.$rotateTo+e)};e.prototype.rotateTo=function(e){this.$updateRadian(e)};e.prototype.$updateRadian=function(e){if(e<0){e%=suncom.Mathf.PI2;e+=suncom.Mathf.PI2}else if(e>=suncom.Mathf.PI2){e%=suncom.Mathf.PI2}if(this.$rotateTo!==e){this.$rotateTo=e;this.$rotation=suncom.Mathf.r2d(e)}};e.prototype.$updateCollision=function(){this.$collision.updateBounds();if(this.$collision.shap===y.POLYGON){var e=this.$collision;e.prepareSegments()}else if(this.$collision.shap===y.RECTANGLE){var e=this.$collision;e.prepareVertexs();e.prepareSegments()}};e.prototype.$applyPosition=function(){if(this.$collider.shap!==o.CIRCLE){var e=this.$collision;for(var t=0;t<e.vertexs.length;t++){var n=e.vertexs[t];n.x+=this.$x;n.y+=this.$y}}};e.prototype.$applyRotate=function(){if(this.$collider.shap===o.POLYGON){var e=this.$collision;for(var t=0;t<e.vertexs.length;t++){var n=e.vertexs[t];n.rotate(this.$radian)}}};e.prototype.$applyScale=function(){if(this.$collision.shap===y.CIRCLE){var e=this.$collider;var t=this.$collision;t.radius=e.radius*this.$scale}else{var e=this.$collider;var t=this.$collision;for(var n=0;n<e.vertexs.length;n++){var r=e.vertexs[n];var o=t.vertexs[n];o.assign(r.x,r.y).mul(this.$scale)}}};e.prototype.$needUpdate=function(){if(this.$scale!==this.$scaleTo){return true}else if(this.$radian!==this.$rotateTo){return true}else if(this.$x!==this.$collision.x||this.$y!==this.$collision.y){return true}else{return false}};e.prototype.$isModifiedByExtern=function(){if(this.$collision.shap===y.POLYGON){var e=this.$collision;return e.modified}return false};e.prototype.getRotation=function(){return this.$rotation};e.prototype.setRotation=function(e){this.rotateTo(suncom.Mathf.d2r(e))};e.prototype.disabled=function(){this.$enabled=false};Object.defineProperty(e.prototype,"layer",{get:function(){return this.$layer},set:function(e){this.$layer=e;this.dispatchEvent(C.TRANSFORM_LAYER_CHANGED,this)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"x",{get:function(){return this.$x},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return this.$y},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"scale",{get:function(){return this.$scaleTo},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"rotation",{get:function(){return this.$rotateTo},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"enabled",{get:function(){return this.$enabled},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"entity",{get:function(){return this.$entity},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"collider",{get:function(){return this.$collider},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"collision",{get:function(){return this.$collision},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"rigidbody",{get:function(){return this.$rigidbody},enumerable:true,configurable:true});return e}(suncom.EventSystem);g.Transform2D=h;var N=function(){function n(e,t){this.x=e;this.y=t}n.prototype.assign=function(e,t){this.x=e;this.y=t;return this};n.prototype.add=function(e){this.x+=e.x;this.y+=e.y;return this};n.prototype.sub=function(e){this.x-=e.x;this.y-=e.y;return this};n.prototype.mul=function(e){this.x*=e;this.y*=e;return this};n.prototype.dot=function(e){return this.x*e.x+this.y*e.y};n.prototype.cross=function(e){return this.x*e.y-this.y*e.x};n.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};n.prototype.rotate=function(e){var t=this.x;var n=this.y;var r=Math.cos(e);var o=Math.sin(e);this.x=t*r-n*o;this.y=t*o+n*r;return this};n.prototype.angle=function(){var e=Math.atan2(this.y,this.x);if(e<0){return e+2*Math.PI}else{return e}};n.prototype.zero=function(){this.x=this.y=0;return this};n.prototype.normal=function(){return new n(this.y,-this.x)};n.prototype.normalize=function(){var e=this.length();if(e<1e-9){return this}this.x/=e;this.y/=e;return this};n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y};n.prototype.distanceTo=function(e){var t=this.x-e.x;var n=this.y-e.y;return Math.sqrt(t*t+n*n)};n.prototype.distanceToSquared=function(e){var t=this.x-e.x;var n=this.y-e.y;return t*t+n*n};n.prototype.copy=function(){return new n(this.x,this.y)};n.prototype.toString=function(){return"{"+this.x+","+this.y+"}"};n.add=function(e,t){return new n(e.x+t.x,e.y+t.y)};n.sub=function(e,t){return new n(t.x-e.x,t.y-e.y)};n.normal=function(e,t){return new n(t.y-e.y,e.x-t.x)};n.angle=function(e,t){var n=e.length();var r=t.length();if(n<=1e-9||r<1e-9){return 0}return Math.acos(e.dot(t)/(n*r))};return n}();g.Vector2D=N;var C=function(){function i(e){this.$detectors=[];this.$contacts=[];this.$transforms=[];i.inst=this;O.graphics=e;this.addDetector(s.DEFAULT,s.DEFAULT)}i.prototype.update=function(e){for(var t=0;t<this.$transforms.length;t++){this.$transforms[t].transform(e)}for(var t=0;t<this.$contacts.length;t++){this.$contacts[t].test()}i.DEBUG===true&&O.draw(this.$transforms)};i.prototype.addTransform=function(e,t){if(t===void 0){t=s.DEFAULT}e.layer=t;e.addEventListener(i.TRANSFORM_LAYER_CHANGED,this.$onTransformLayerChanged,this);for(var n=0;n<this.$transforms.length;n++){var r=this.$transforms[n];if(this.$shouldCollide(e.layer,r.layer)===true){var o=new u(e,r);this.$contacts.push(o)}}this.$transforms.push(e)};i.prototype.removeTransform=function(e){var t=this.$transforms.indexOf(e);if(t<0){return}e.disabled();this.$transforms.splice(t,1);e.removeEventListener(i.TRANSFORM_LAYER_CHANGED,this.$onTransformLayerChanged,this);for(var n=this.$contacts.length-1;n>-1;n--){var r=this.$contacts[n];if(r.a===e||r.b===e){if(r.touching===true){r.doCollide(a.COLLISION_EXIT)}this.$contacts.splice(n,1)}}};i.prototype.$onTransformLayerChanged=function(e){this.removeTransform(e);this.addTransform(e,e.layer)};i.prototype.addDetector=function(e,t){if(e>t){var n=e;e=t;t=n}if(this.$detectors[e]===void 0){this.$detectors[e]=[]}this.$detectors[e][t]=true};i.prototype.$shouldCollide=function(e,t){if(e>t){var n=e;e=t;t=n}if(this.$detectors[e]!==void 0&&this.$detectors[e][t]===true){return true}return false};Object.defineProperty(i.prototype,"transforms",{get:function(){return this.$transforms},enumerable:true,configurable:true});i.DEBUG=false;i.TRANSFORM_LAYER_CHANGED="world2d.TRANSFORM_LAYER_CHANGED";return i}();g.World2D=C;var _;(function(e){function t(e,t){return e.distanceToSquared(t)<=t.radius*t.radius}e.pointInCircle=t;function n(e,t){return e.x>=t.left&&e.x<=t.right&&e.y>=t.top&&e.y<=t.bottom}e.pointInRectangle=n;function u(e,t){var n=t.vertexs;var r=0;for(var o=0;o<n.length;o++){var i=n[o];var s=o===0?n[n.length-1]:n[o-1];if(i.x===s.x&&i.y===s.y){continue}r+=N.angle(N.sub(i,e),N.sub(s,e))}return suncom.Mathf.abs(suncom.Mathf.r2d(r)-360)<.01}e.pointInPolygon=u;function r(e,t){if(e.left>t.right||t.left>e.right||e.top>t.bottom||t.top>e.bottom){return false}return true}e.bounds2Bounds=r;function o(e,t){var n=t.x-e.x;var r=t.y-e.y;var o=e.radius+t.radius;if(n*n+r*r>o*o){return false}return true}e.circle2Circle=o;function i(e,t,n){var r=e.a.distanceToSquared(t);var o=e.b.distanceToSquared(t);var i=t.radius*t.radius;if(r<=i&&o<=i){n.p1.assign(e.a.x,e.a.y);n.type=$.CROSS}else{}return false}function s(e,t){var n=t.vertexs;var r=e.radius*e.radius;var o=null;var i=suncom.Mathf.MAX_SAFE_INTEGER;var s=false;for(var a=0;a<n.length;a++){var u=n[a];var l=u.distanceToSquared(e);if(l<=r){s=true;break}if(l<i){o=u;i=l}}if(s===true){return true}var c=new N(e.x,e.y);var f=o.copy();var d=new N(f.x-c.x,f.y-c.y);var h=d.normal();var p=d.copy().normalize().mul(e.radius).add(c);if(v([p],n,h)===false){return false}var m=[c,f];var E=t.segments;for(var a=0;a<E.length;a++){var y=E[a];if(y.ab.length()===0){continue}h.assign(y.ab.y,-y.ab.x).normalize().mul(e.radius);c.assign(e.x,e.y).add(h);f.assign(e.x,e.y).sub(h);if(v(m,n,y.ab)===false){return false}}return true}e.circle2Polygin=s;function v(e,t,n){var r=n.y/n.x;var o=n.x/n.y;var i=suncom.Mathf.MAX_SAFE_INTEGER;var s=suncom.Mathf.MIN_SAFE_INTEGER;var a=suncom.Mathf.MAX_SAFE_INTEGER;var u=suncom.Mathf.MIN_SAFE_INTEGER;var l=0,c=0;var f=false;if(r<-1||r>1){while(l<e.length||c<t.length){if(l<e.length){var d=e[l];var h=d.x-o*d.y;if(i>h){i=h}if(s<h){s=h}l++}if(c<t.length){var d=t[c];var h=d.x-o*d.y;if(a>h){a=h}if(u<h){u=h}c++}if((s<a||i>u)===false){f=true;break}}}else{while(l<e.length||c<t.length){if(l<e.length){var d=e[l];var h=d.y-r*d.x;if(i>h){i=h}if(s<h){s=h}l++}if(c<t.length){var d=t[c];var h=d.y-r*d.x;if(a>h){a=h}if(u<h){u=h}c++}if((s<a||i>u)===false){f=true;break}}}return f}function a(e,t){var n=e.vertexs;var r=e.segments;for(var o=0;o<r.length;o++){var i=r[o];if(i.ab.length()===0){continue}if(v(n,t,r[o].ab)===false){return false}}return true}e.polygon2Vertexs=a;function l(e,t,n){var r=t.radius*t.radius;var o=e.a.distanceToSquared(t);var i=e.b.distanceToSquared(t);if(o<=r&&i<=r){n.p1.assign(e.a.x,e.a.y);n.type=$.CROSS;return true}var s=e.ab.normal().normalize().mul(t.radius);var a=new N(t.x,t.y).add(s);var u=new N(t.x,t.y).sub(s);var l={p:new N(0,0),type:$.NONE};m(e.a,e.ab,a,u,l);if(l.type===$.NONE){return false}l.type=$.NONE;var c=l.p.copy().sub(t).lengthSquared();var f=Math.sqrt(r-c);s.assign(e.ab.x,e.ab.y).normalize().mul(f);a=l.p.copy().add(s);u=l.p.copy().sub(s);var d=E(a.x,e.a.x,e.b.x)&&E(a.y,e.a.y,e.b.y);var h=E(u.x,e.a.x,e.b.x)&&E(u.y,e.a.y,e.b.y);if(d&&h){p(e.a,a,u,n);n.type=$.CROSS_2}else if(d){n.p1=a;n.type=$.CROSS}else if(h){n.p1=u;n.type=$.CROSS}else{return false}}e.line2Circle=l;function c(e,t,n,r){var o=t.segments;var i={p:new g.Vector2D(0,0),type:$.NONE};for(var s=0;s<o.length;s++){var a=o[s];if(n===T.ANY||n===T.ALL){if(f(e.ab,e.a,e.b,a.ab,a.a,a.b,null)){r.type=$.CROSS;break}}else{f(e.ab,e.a,e.b,a.ab,a.a,a.b,i);if(i.type===$.CROSS){if(r.type===$.NONE){r.type=$.CROSS;r.p1.assign(i.p.x,i.p.y)}else{r.type=$.CROSS_2;r.p2.assign(i.p.x,i.p.y)}if(r.type===$.CROSS_2){break}i.type=$.NONE}}}if(r.type===$.NONE){if(u(e.a,t)&&u(e.b,t)){r.p1.assign(e.a.x,e.a.y);r.type=$.CROSS}}else if(r.type===$.CROSS_2){p(e.a,r.p1,r.p2,r)}return r.type!==$.NONE}e.line2Polygon=c;function p(e,t,n,r){if(n.distanceToSquared(e)<t.distanceToSquared(e)){r.p1=n;r.p2=t}else{r.p1=t;r.p2=n}}function f(e,t,n,r,o,i,s){var a;if(e.x===0&&r.x===0){if(t.x===o.x&&(E(t.y,o.y,i.y)||E(n.y,o.y,i.y)||E(o.y,t.y,n.y)||E(i.y,t.y,n.y))){a=$.OVERLAP}else{a=$.NONE}}else if(e.y===0&&r.y===0){if(t.y===o.y&&(E(t.x,o.x,i.x)||E(n.x,o.x,i.x)||E(o.x,t.x,n.x)||E(i.x,t.x,n.x))){a=$.OVERLAP}else{a=$.NONE}}else if(m(o,r,t,n,s)&&m(t,e,o,i,s)){a=$.CROSS}else{a=$.NONE}if(s!==null&&s.type!==a){s.type=a}return a!==$.NONE}e.line2Line=f;function m(e,t,n,r,o){if(t.x===0){return E(e.x,n.x,r.x)&&h(e.x,e.x,n.y,r.y,o)}else if(t.y===0){return E(e.y,n.y,r.y)&&h(n.x,r.x,e.y,e.y,o)}else{var i=t.y/t.x;if(i>-1&&i<1){var s=e.y-i*e.x;var a=n.y-i*n.x;var u=r.y-i*r.x;return E(s,a,u)&&y(s,a,u,n,r,o)}else{var l=t.x/t.y;var c=e.x-l*e.y;var f=n.x-l*n.y;var d=r.x-l*r.y;return E(c,f,d)&&y(c,f,d,n,r,o)}}}e.isLineBetweenPoints=m;function E(e,t,n){if(t<n){return t<=e&&e<=n}else{return n<=e&&e<=t}}e.isInRange=E;function h(e,t,n,r,o){if(o!==null&&o.type===$.NONE&&e===t&&n===r){o.p.assign(e,n);o.type=$.CROSS}return true}function y(e,t,n,r,o,i){if(i!==null&&i.type===$.NONE){i.p=new N(o.x-r.x,o.y-r.y).mul((e-t)/(n-t)).add(r);i.type=$.CROSS}return true}})(_=g.CollisionResolution2D||(g.CollisionResolution2D={}));var O;(function(a){function e(){a.graphics.clear()}a.clear=e;function t(e){for(var t=0;t<e.length;t++){var n=e[t];var r=n.collision.bounds;a.drawRect(r.left,r.top,r.right-r.left,r.bottom-r.top,"#FF0000")}for(var t=0;t<e.length;t++){var n=e[t];if(n.collision.shap===y.CIRCLE){var o=n.collision;a.drawCircle(n.x,n.y,o.radius,"#FF0000")}else if(n.collision.shap===y.POLYGON){var o=n.collision;a.drawPolygon(0,0,o.vertexs,"#FF0000")}else{var o=n.collision;a.drawPolygon(0,0,o.vertexs,"#FF0000")}}for(var t=0;t<e.length;t++){var n=e[t];var i=n.hitNum===0?"#0000FF":"#00FF00";if(n.collision.shap===y.CIRCLE){var o=n.collision;a.drawCircle(n.x,n.y,o.radius,i)}else if(n.collision.shap===y.POLYGON){var o=n.collision;a.drawPolygon(0,0,o.vertexs,i)}else{var r=n.collision.bounds;a.drawRect(r.left,r.top,r.right-r.left,r.bottom-r.top,i)}}}a.draw=t;function n(e,t,n){a.graphics.drawLine(e.x,e.y,t.x,t.y,n)}a.drawLine=n;function r(e,t){var n=e.copy().normalize().mul(1e3);a.graphics.drawLine(e.x,e.y,-e.x,-e.y,t)}a.drawNormal=r;function o(e,t,n,r,o){a.graphics.drawRect(e,t,n,r,void 0,o)}a.drawRect=o;function i(e,t,n,r){a.graphics.drawCircle(e,t,n,void 0,r)}a.drawCircle=i;function s(e,t,n,r){for(var o=0;o<n.length;o++){var i=n[o];var s=o===0?n[n.length-1]:n[o-1];a.graphics.drawLine(i.x+e,i.y+t,s.x+e,s.y+t,r)}}a.drawPolygon=s})(O=g.DrawAPI2D||(g.DrawAPI2D={}));var p;(function(e){function t(e,t){var n=e[0];var r=n.x;var o=n.x;var i=n.y;var s=n.y;for(var a=1;a<e.length;a++){var u=e[a];if(r>u.x){r=u.x}else if(o<u.x){o=u.x}if(i>u.y){i=u.y}else if(s<u.y){s=u.y}}t.updateBounds(r,o,i,s)}e.calculateBoundsForVertexs=t})(p=g.Helper2D||(g.Helper2D={}))})(world2d||(world2d={}));